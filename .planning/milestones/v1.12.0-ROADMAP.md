# Milestone v1.12.0: Codebase Intelligence

**Status:** ✅ SHIPPED 2026-02-18
**Goal:** Automatic codebase knowledge capture, storage, and consumption across all Kata agent workflows. Agents receive architecture, conventions, and dependency knowledge in their context windows.
**Phases:** 54-59
**Total Plans:** 19

## Overview

Kata agents historically had no awareness of project conventions, architecture, or naming patterns unless the user manually provided context. v1.12.0 closes this gap with a full codebase intelligence pipeline:

1. **Capture** — `scan-codebase.cjs` extracts imports, exports, naming conventions, and directory patterns from source files
2. **Index** — `generate-intel.js` compresses raw data into `.planning/intel/` (index.json, conventions.json, summary.md)
3. **Consume** — Planner, executor, and verifier agents receive `summary.md` injected into their context at spawn time
4. **Maintain** — Staleness detection triggers incremental re-scans; brownfield auto-refresh via mapper agent

## Phases

### Phase 54: Knowledge Architecture & Consumption

**Goal:** Agents receive codebase knowledge when spawned. Storage schema exists. Summary.md is the compressed entry point.
**Depends on:** None
**Plans:** 4 plans

Plans:
- [x] 54-01: generate-intel.js script + summary template + kata-map-codebase wiring — completed 2026-02-15
- [x] 54-02: planner integration (read + inject intel summary) — completed 2026-02-15
- [x] 54-03: executor integration (read + inject intel summary) — completed 2026-02-15
- [x] 54-04: verifier integration + KATA-STYLE.md documentation — completed 2026-02-15

**Requirements:** ARCH-01, ARCH-02, INTEG-01, INTEG-02, INTEG-03, INTEG-04, INTEG-05, INTEG-06

### Phase 55: Codebase Capture & Indexing

**Goal:** System scans code files, extracts exports/imports, detects naming conventions and directory patterns, builds dependency graph. All artifacts include freshness metadata.
**Depends on:** Phase 54
**Plans:** 3 plans

Plans:
- [x] 55-01: scan-codebase.cjs script (import/export extraction, naming detection, directory mapping, freshness metadata) — completed 2026-02-16
- [x] 55-02: tests and fixtures for scan-codebase.cjs (84 unit + integration tests) — completed 2026-02-16
- [x] 55-03: generate-intel.js freshness metadata + kata-map-codebase and kata-execute-phase integration — completed 2026-02-16

**Requirements:** CAP-02, CAP-03, CAP-04, CAP-05, MAINT-04

### Phase 56: Greenfield Integration

**Goal:** New projects get intel scaffolded at creation time. Smart scan gate prevents redundant scanning during phase execution.
**Depends on:** Phase 55
**Plans:** 2 plans

Plans:
- [x] 56-01: scaffold-intel.cjs + kata-new-project wiring — completed 2026-02-16
- [x] 56-02: smart scan gate in step 7.25 + update-intel-summary.cjs — completed 2026-02-16

**Requirements:** CAP-01, ARCH-03

### Phase 57: Knowledge Maintenance

**Goal:** Staleness detection, convention enforcement, and unified scan decision tree for all project types.
**Depends on:** Phase 56
**Plans:** 3 plans

Plans:
- [x] 57-01: staleness detection + convention enforcement scripts — completed 2026-02-16
- [x] 57-02: orchestrator integration (staleness detection + convention checking in step 7.25) — completed 2026-02-16
- [x] 57-03: unified scan decision tree (SCAN_RAN guard, brownfield/greenfield paths) — completed 2026-02-16

**Requirements:** MAINT-01, MAINT-02, MAINT-03

### Phase 58: Brownfield Doc Auto-Refresh

**Goal:** When brownfield codebase docs are stale (30%+ source files changed since Analysis Date), auto-spawn mapper agent to refresh them.
**Depends on:** Phase 57
**Plans:** 4 plans

Plans:
- [x] 58-01: detectBrownfieldDocStaleness() function — completed 2026-02-17
- [x] 58-02: brownfield staleness tests (backdated git commits, 10 source files/repo) — completed 2026-02-17
- [x] 58-03: brownfield auto-refresh path via mapper agent in kata-execute-phase — completed 2026-02-17
- [x] 58-04: build validation (167/167 tests pass) — completed 2026-02-17

### Phase 59: Brownfield Intel Gap Closure

**Goal:** Close 4 gaps identified in milestone audit: oldest-commit fallback, brownfield guard removal, v2 schema migration, Phase 55 verification report.
**Depends on:** Phase 58
**Plans:** 3 plans

Plans:
- [x] 59-01: oldest-commit fallback in detectBrownfieldDocStaleness (GAP-1) — completed 2026-02-18
- [x] 59-02: remove brownfield guard from update-intel-summary.cjs + v2 schema migration (GAP-2 + schema gap) — completed 2026-02-18
- [x] 59-03: 55-VERIFICATION.md creation from 8/8 UAT results; e2e confirmation (GAP-3) — completed 2026-02-18

---

## Milestone Summary

**Key Decisions:**

- `summary.md` as the entry point (~80-150 lines) with progressive disclosure to deeper `codebase/` docs
- Regex-based scanning (not AST/tree-sitter) — covers 80% of use cases, zero native dependencies
- Graceful degradation: if `.planning/intel/` doesn't exist, agents proceed without error
- SCAN_RAN flag gates summary update to prevent unconditional regeneration every plan
- Incremental merge: scan-codebase.cjs merges new scan results into existing index.json
- v2 index schema with camelCase stats (totalFiles, byType, byLayer) for consistency

**Issues Resolved:**

- GAP-1: detectBrownfieldDocStaleness() silently returned no_commit_at_date for predated Analysis Date → oldest-commit fallback
- GAP-2: update-intel-summary.cjs blocked by codebase-dir guard, scan v2 data never surfaced → guard removed, conditional source label added
- Schema inconsistency: generate-intel.js emitted v1 schema with snake_case stats → migrated to v2 camelCase
- Missing VERIFICATION.md for Phase 55 → 55-VERIFICATION.md created from 8/8 UAT results
- generate-intel.js catastrophic-backtracking regex in extractPathCandidates → replaced with simple grab-and-filter pattern

**Issues Deferred:**

- Cross-repository intelligence (multi-repo awareness)
- Vector embedding / semantic search
- AST parsing via tree-sitter
- Full git history mining

**Technical Debt:**

- npm test fails in phase-54 worktree due to pre-existing broad deletion of skills/* files (infrastructure issue, not regression)
- If scan-codebase.cjs fails silently (uses || true), update-intel-summary.cjs also silently returns early — by design but reduces debugging observability

---

*For current project status, see .planning/ROADMAP.md*

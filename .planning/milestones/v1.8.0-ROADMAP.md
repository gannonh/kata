# Milestone Archive: v1.8.0 Adaptive Workflows

**Status:** ✅ SHIPPED
**Date:** 2026-02-08
**Phases:** 37-39
**Total Plans:** 7

## Goal

Enable project-specific workflow customization through preferences storage, progressive capture, template overrides, and config-driven workflow variants.

---

## Phase Details

### Phase 37: Preferences Infrastructure & Progressive Capture

**Goal:** Establish preferences infrastructure with accessor scripts and reduce onboarding through progressive capture pattern.

**Plans:**
- [x] 37-01: Accessor & Utility Scripts — Create `read-pref.sh`, `has-pref.sh`, `set-config.sh` with resolution chain
- [x] 37-02: Skill Modifications — Reduce onboarding to 5 questions, wire check-or-ask pattern for deferred preferences

**Key deliverables:**
- `read-pref.sh` — Four-level resolution chain: preferences.json → config.json → DEFAULTS table → fallback
- `has-pref.sh` — Detects whether user has expressed a preference (for check-or-ask pattern)
- `set-config.sh` — Atomic JSON writes with type coercion (boolean, number, string)
- Onboarding reduced from 11 to 5 questions
- `model_profile` deferred to first `/kata-plan-phase` via check-or-ask

**Commits:** f126a8e, e6b7eb0, 12cfe8a

### Phase 38: Template Overrides

**Goal:** Extract inline templates to standalone files with project-override-first resolution.

**Plans:**
- [x] 38-01: Template Extraction — Extract 3 inline templates, add schema comments to all 5 templates
- [x] 38-02: Resolution Wiring & Drift Detection — Create resolve-template.sh, template drift SessionStart hook, wire into orchestrators

**Key deliverables:**
- 5 standalone template files with `kata-template-schema` HTML comments
- `resolve-template.sh` — Project-override-first resolution (`.planning/templates/` → plugin default)
- `kata-template-drift.js` — SessionStart hook detecting missing required fields
- Template resolution wired into 4 orchestrator skills

**Commits:** f1c5eb6, c22ce42, 099d59b, 3ad100f

### Phase 39: Config Workflow Variants & Settings

**Goal:** Add workflow config schema with per-skill keys and rewrite settings skill.

**Plans:**
- [x] 39-01: Config Schema & Validator — Add 6 workflow config keys to DEFAULTS, create SessionStart validator hook
- [x] 39-02: Workflow Config Wiring — Wire config into kata-execute-phase, kata-verify-work, kata-complete-milestone
- [x] 39-03: Settings Skill Rewrite — Rewrite kata-configure-settings with three sections using accessor scripts

**Key deliverables:**
- 6 workflow config keys in DEFAULTS table (23 total entries)
- `kata-config-validator.js` — SessionStart hook warning on unknown keys, erroring on invalid types
- `kata-execute-phase` reads `post_task_command` config
- `kata-verify-work` reads `extra_verification_commands` config
- `kata-complete-milestone` reads `version_files` config
- Settings skill rewritten with preferences, session, workflow config sections

**Commits:** f8f0b7c, 81f5ba9, 77b31de, 632b5b4, e8eb5fe, 1eee765

---

## Milestone Summary

### Requirements Delivered

20 requirements across 4 categories:
- Preferences Infrastructure (PREF): 5/5
- Progressive Capture (CAP): 5/5
- Template Overrides (TMPL): 4/4
- Config Workflow Variants (WKFL): 6/6

### Key Decisions

| Decision | Rationale |
|----------|-----------|
| Flat preferences.json with dot-notation keys | Simpler than nested structure, easier to query and update |
| Heredoc node invocation in scripts | Avoids bash escaping issues with complex JSON operations |
| DEFAULTS table in read-pref.sh | Single source of truth for all known preference keys |
| Templates in owning skill's references/ | Self-contained skills, no cross-skill dependencies |
| kata-template-schema comment format | Machine-parseable for drift detection, human-readable |
| parallelization kept in KNOWN_KEYS | Backward compat for existing configs during transition |

### Tech Debt

- Phase 37: Ambiguous "5 questions" success criterion (implemented as 5 base + conditional follow-ups)

### Issues Resolved

- None filed during milestone

---

*Archived: 2026-02-08 as part of v1.8.0 milestone completion*

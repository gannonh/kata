# Requirements Archive: v1.11.0 Phase-Level Worktrees

**Archived:** 2026-02-14
**Status:** ✅ SHIPPED

This is the archived requirements specification for v1.11.0.

---

## v1.11.0 Requirements

### Phase Worktree Lifecycle

- [x] **WT-01**: `create-phase-branch.sh` creates a worktree at project root instead of running `git checkout -b` inside `main/`
- [x] **WT-02**: Phase worktree directory named `{branch-type}-v{milestone}-{phase-num}-{slug}` as sibling to `main/`
- [x] **WT-03**: Script handles resumption: if worktree and branch already exist, outputs path without error
- [x] **WT-04**: Script outputs `WORKTREE_PATH` and `BRANCH` variables for orchestrator consumption
- [x] **WT-05**: `manage-worktree.sh` gains `cleanup-phase` subcommand to remove phase worktree and branch

### Merge Target

- [x] **MT-01**: `manage-worktree.sh` `cmd_merge` merges plan branch into phase worktree directory (not `main/`)
- [x] **MT-02**: `resolve_base_branch` removed; base branch always passed explicitly by caller
- [x] **MT-03**: `cmd_create` defaults base branch to the phase branch passed by caller

### Orchestrator

- [x] **OR-01**: `phase-execute.md` creates phase worktree before any plan execution
- [x] **OR-02**: `<working_directory>` injected into agent prompts points to phase worktree (when `worktree.enabled=false`) or plan worktree (when `worktree.enabled=true`)
- [x] **OR-03**: Plan worktree creation passes phase branch explicitly to `manage-worktree.sh`
- [x] **OR-04**: Plan worktree merge passes phase branch to `manage-worktree.sh`
- [x] **OR-05**: After all waves complete, phase branch becomes PR against main (or local merge if `pr_workflow=false`)

### Documentation

- [x] **DOC-01**: `setup-worktrees.sh` README template reflects workspace architecture (`workspace/` as persistent working directory, `main/` as read-only)
- [x] **DOC-02**: `git-integration.md` branch flow diagram updated for two-tier worktree model

### Invariant

- [x] **INV-01**: `main/` is always on the `main` branch. `git -C main branch --show-current` returns `main` at all times during and after phase execution.

## Out of Scope

- **Nested worktrees** — Git worktrees cannot nest. Plan worktrees remain siblings at project root.
- **New config options** — `worktree.enabled` still controls plan-level worktrees only. Phase worktrees are always created (they replace `git checkout -b`).
- **Changes to execute-plan.md** — Executor agents work from injected `<working_directory>`, agnostic to worktree structure.
- **Changes to checkpoints.md, tdd.md, summary-template.md** — Directory-agnostic, no changes needed.

## Traceability

| Requirement | Phase | Status | Description |
|-------------|-------|--------|-------------|
| WT-01 | 49 | Complete | create-phase-branch.sh creates worktree at project root |
| WT-02 | 49 | Complete | Phase worktree directory naming convention |
| WT-03 | 49 | Complete | Resumption handling for existing worktree/branch |
| WT-04 | 49 | Complete | Script outputs WORKTREE_PATH and BRANCH variables |
| WT-05 | 49 | Complete | cleanup-phase subcommand in manage-worktree.sh |
| MT-01 | 49 | Complete | cmd_merge targets phase worktree, not main/ |
| MT-02 | 49 | Complete | resolve_base_branch removed; explicit base branch |
| MT-03 | 49 | Complete | cmd_create defaults to phase branch from caller |
| OR-01 | 50 | Complete | phase-execute.md creates phase worktree before plans |
| OR-02 | 50 | Complete | working_directory injection for agent prompts |
| OR-03 | 50 | Complete | Plan worktree creation passes phase branch |
| OR-04 | 50 | Complete | Plan worktree merge passes phase branch |
| OR-05 | 50 | Complete | Phase branch becomes PR or local merge after waves |
| INV-01 | 50 | Complete | main/ stays on main branch at all times |
| DOC-01 | 51 | Complete | setup-worktrees.sh README template reflects workspace architecture |
| DOC-02 | 51 | Complete | git-integration.md branch flow diagram updated |

## Milestone Summary

**Shipped:** 16 of 16 requirements
**Adjusted:** None
**Dropped:** None

---
*Archived: 2026-02-14 as part of v1.11.0 milestone completion*

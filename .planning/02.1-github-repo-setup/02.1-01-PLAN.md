---
phase: 02.1-github-repo-setup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/kata-starting-projects/SKILL.md
  - tests/skills/starting-projects.test.js
autonomous: true

must_haves:
  truths:
    - "When user enables GitHub tracking during project init, skill checks for existing GitHub remote"
    - "If no remote exists and GitHub enabled, user is prompted to create repo"
    - "If user creates repo, GitHub operations proceed normally"
    - "If user declines repo creation, github.enabled is set to false in config.json"
  artifacts:
    - path: "skills/kata-starting-projects/SKILL.md"
      provides: "Remote detection and repo creation flow in Phase 5"
      contains: "git remote -v"
    - path: "tests/skills/starting-projects.test.js"
      provides: "Test for GitHub remote detection behavior"
      contains: "remote"
  key_links:
    - from: "kata-starting-projects Phase 5"
      to: "gh repo create"
      via: "Conditional AskUserQuestion after GitHub Tracking selection"
      pattern: "gh repo create --source=."
---

<objective>

Add GitHub remote detection and repository creation flow to `/kata:starting-projects`.

**Purpose:** When a user enables GitHub tracking during project initialization but has no GitHub remote configured, the skill should detect this gap and offer to create a repository. This prevents downstream failures when `/kata:starting-milestones` attempts `gh api /repos/:owner/:repo/milestones` without a remote.

**Output:**
- Modified `kata-starting-projects/SKILL.md` with remote detection in Phase 5
- Test verifying GitHub remote flow is present

</objective>

<execution_context>
@./references/execute-plan.md
@./references/summary-template.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

Phase research:
@.planning/phases/02.1-github-repo-setup/02.1-RESEARCH.md

Skill to modify:
@skills/kata-starting-projects/SKILL.md

Existing tests:
@tests/skills/starting-projects.test.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add remote detection and repo creation flow to kata-starting-projects</name>
  <files>skills/kata-starting-projects/SKILL.md</files>
  <action>
Modify Phase 5 (Workflow Preferences) to add GitHub remote detection AFTER the GitHub Tracking question but BEFORE config.json creation.

Insert after line ~317 (after the Issue Creation follow-up question block) and before the config.json creation:

```markdown
**GitHub Repository Check (conditional):**

**If GitHub Tracking = Yes:**

After confirming GitHub preferences, check for existing remote:

```bash
# Check if gh CLI is authenticated
GH_AUTH=$(gh auth status &>/dev/null && echo "true" || echo "false")

# Check for GitHub remote
HAS_GITHUB_REMOTE=$(git remote -v 2>/dev/null | grep -q 'github\.com' && echo "true" || echo "false")
```

**If `HAS_GITHUB_REMOTE=false` and user selected GitHub Tracking = Yes:**

Use AskUserQuestion:
- header: "GitHub Repository"
- question: "GitHub tracking enabled, but no GitHub repository is linked. Create one now?"
- options:
  - "Create public repo" — Run `gh repo create --source=. --public --push`
  - "Create private repo" — Run `gh repo create --source=. --private --push`
  - "Skip for now" — Disable GitHub tracking (can enable later with `gh repo create`)

**If "Create public repo":**
```bash
if [ "$GH_AUTH" = "true" ]; then
  gh repo create --source=. --public --push && echo "GitHub repository created" || echo "Warning: Failed to create repository"
else
  echo "Warning: GitHub CLI not authenticated. Run 'gh auth login' first, then 'gh repo create --source=. --public --push'"
fi
```
Continue with `github.enabled: true`.

**If "Create private repo":**
```bash
if [ "$GH_AUTH" = "true" ]; then
  gh repo create --source=. --private --push && echo "GitHub repository created" || echo "Warning: Failed to create repository"
else
  echo "Warning: GitHub CLI not authenticated. Run 'gh auth login' first, then 'gh repo create --source=. --private --push'"
fi
```
Continue with `github.enabled: true`.

**If "Skip for now":**
- Set `github.enabled: false` in config.json (override user's earlier selection)
- Display note: "GitHub tracking disabled — no repository configured. Run `gh repo create --source=. --public` to enable later, then update `.planning/config.json`."

**If `HAS_GITHUB_REMOTE=true`:**
- Proceed normally with user's GitHub preferences
- No additional prompts needed
```

Also update the GitHub Tracking conditional logic section (around line 408-423) to clarify the flow order:

```markdown
**GitHub Tracking conditional logic:**

**If GitHub Tracking = Yes:**
- Ask the Issue Creation follow-up question
- Check for GitHub remote (see above)
- Set `github.enabled` based on final state (true if remote exists or was created, false if skipped)
- Set `github.issueMode` based on Issue Creation choice
- Display note based on outcome
```

Key constraints:
- Use the remote detection pattern from research: `git remote -v 2>/dev/null | grep -q 'github\.com'`
- Error handling: gh CLI failures warn but do not block project initialization
- Config.json github.enabled reflects FINAL state after repo decision, not just initial question
  </action>
  <verify>Read the modified SKILL.md and verify:
1. `git remote -v` check appears in Phase 5 after GitHub Tracking question
2. AskUserQuestion with three repo options (public, private, skip) is present
3. `gh repo create --source=.` commands are present for both visibility options
4. Skip option sets `github.enabled: false`
5. Flow handles both authenticated and unauthenticated gh CLI states</verify>
  <done>SKILL.md contains remote detection logic that runs when GitHub Tracking enabled, offers repo creation with three options, and correctly sets github.enabled based on outcome</done>
</task>

<task type="auto">
  <name>Task 2: Add test for GitHub remote detection flow</name>
  <files>tests/skills/starting-projects.test.js</files>
  <action>
Add a new test case to verify the GitHub remote detection flow is present in the skill.

Add after the existing `it('includes GitHub integration questions in config'` test:

```javascript
import { readFileSync } from 'node:fs';

// ... in the describe block ...

it('includes GitHub remote detection in workflow', () => {
  // This test verifies the skill content includes the remote detection pattern
  // Actual remote detection happens during interactive execution

  const skillPath = join(testDir, '.claude', 'skills', 'kata-starting-projects', 'SKILL.md');
  const skillContent = readFileSync(skillPath, 'utf8');

  // Verify remote detection pattern exists
  const hasRemoteCheck = skillContent.includes('git remote -v') ||
                          skillContent.includes('HAS_GITHUB_REMOTE');

  if (!hasRemoteCheck) {
    throw new Error('Expected skill to include GitHub remote detection pattern');
  }

  // Verify repo creation option exists
  const hasRepoCreate = skillContent.includes('gh repo create');

  if (!hasRepoCreate) {
    throw new Error('Expected skill to include gh repo create command');
  }

  // Verify skip option that disables github.enabled
  const hasSkipOption = skillContent.includes('Skip for now') ||
                         skillContent.includes('github.enabled: false');

  if (!hasSkipOption) {
    throw new Error('Expected skill to include skip option that disables GitHub');
  }
});
```

Note: Add `readFileSync` to the existing import if not already present (check line 12).
  </action>
  <verify>Run `node --test tests/skills/starting-projects.test.js` and verify the new test passes</verify>
  <done>Test file contains new test case that verifies remote detection pattern exists in skill</done>
</task>

</tasks>

<verification>
After completing both tasks:

1. Run the test suite for starting-projects:
   ```bash
   node --test tests/skills/starting-projects.test.js
   ```
   Expected: All tests pass including the new remote detection test

2. Read the modified SKILL.md and verify the flow:
   - Remote check happens after GitHub Tracking = Yes
   - Three options presented (public, private, skip)
   - Skip sets github.enabled = false
   - Remote exists case proceeds normally
</verification>

<success_criteria>
- [ ] SKILL.md contains `git remote -v` check in Phase 5
- [ ] SKILL.md contains AskUserQuestion with repo creation options
- [ ] SKILL.md contains `gh repo create --source=.` commands
- [ ] SKILL.md sets `github.enabled: false` when user skips repo creation
- [ ] Test verifies remote detection pattern exists
- [ ] All existing tests still pass
</success_criteria>

<output>
After completion, create `.planning/phases/02.1-github-repo-setup/02.1-01-SUMMARY.md`
</output>

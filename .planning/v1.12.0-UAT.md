---
milestone: v1.12.0
source: [54-01-SUMMARY.md, 54-02-SUMMARY.md, 54-03-SUMMARY.md, 54-04-SUMMARY.md, 55-01-SUMMARY.md, 55-02-SUMMARY.md, 55-03-SUMMARY.md, 56-01-SUMMARY.md, 56-02-SUMMARY.md, 57-01-SUMMARY.md, 57-02-SUMMARY.md, 57-03-SUMMARY.md]
started: 2026-02-16T23:50:00Z
status: complete
---

# v1.12.0 Codebase Intelligence — UAT

## Internal Verification (Claude performed)

| Check | Result | Notes |
|-------|--------|-------|
| `npm run build:plugin` | ✅ Pass | Plugin builds cleanly |
| `npm test` (44 tests) | ✅ Pass | 44/44 |
| `npm run test:scripts` (160 tests) | ✅ Pass | 160/160 |
| `detect-stale-intel.cjs` on this project | ✅ Pass | 0 stale files, 60 fresh |
| `check-conventions.cjs` on recent changes | ✅ Pass | 0 violations |
| `scan-codebase.cjs` invocation | ✅ Pass | 60 files indexed, camelCase detected |

## Deliverables Overview

**User-facing deliverables (user experiences through Kata commands):**

1. **Greenfield intel scaffolding** — `/kata-new-project` automatically creates `.planning/intel/` (CAP-01, ARCH-03)
2. **Execution intel scans** — `/kata-execute-phase` step 7.25 runs scans, detects staleness, checks conventions (CAP-02, MAINT-01, MAINT-02, MAINT-03)
3. **Brownfield mapping** — `/kata-map-codebase` generates `.planning/intel/` from code analysis (ARCH-01, ARCH-02)
4. **Planner context** — `/kata-plan-phase` planner receives `<codebase_intelligence>` in prompt (INTEG-01)
5. **Executor context** — `/kata-execute-phase` executor receives conventions in prompt (INTEG-02)

**Internal deliverables (verified above):**

- `scan-codebase.cjs` script (import/export extraction, naming detection)
- `detect-stale-intel.cjs` script (staleness detection via git)
- `check-conventions.cjs` script (convention enforcement)
- `scaffold-intel.cjs` script (greenfield init)
- `update-intel-summary.cjs` script (summary regeneration)

## UAT Batches

### Batch 1: Intel Artifacts Review (in this project)

**Status:** complete

| Scenario | Expected | Result | Notes |
|----------|----------|--------|-------|
| S1: .planning/intel/summary.md exists and is ~80-150 lines | 124 lines, contains Stack/Architecture/Conventions sections | ❌ FAIL | File exists and has correct schema, but content reflects January GSD-era architecture (commands/, agents/, gsd: prefix). Content is misleading and harmful to agents consuming it. |
| S2: .planning/intel/index.json is v2 with recent commit hash | v2, 60 files, hash from 2026-02-16 | ✅ PASS | |
| S3: .planning/intel/conventions.json shows camelCase naming | camelCase pattern, confidence >= 0.70 | ✅ PASS | |

### Batch 2: Greenfield New Project Test

**Status:** pending

| Scenario | Expected | Result | Notes |
|----------|----------|--------|-------|
| S4: /kata-new-project creates .planning/intel/ | Three files created with v2 schema, totalFiles==0 | pending | Requires test project |
| S5: First /kata-execute-phase populates intel | step 7.25 runs full scan, index.json shows >0 files | pending | Requires test project |
| S6: Planner context references codebase intelligence | Planner's conversation mentions codebase conventions | pending | Requires test project |

## Issues Found

### GAP-1: detectBrownfieldDocStaleness() silent no-op when Analysis Date predates git history

**Severity:** High
**Category:** flows (Phase 58 auto-refresh does not trigger for this project)

**Scenario:** S1 (Batch 1) — confirmed during audit conversation
**Root cause:** Phase 58 implemented brownfield staleness detection by parsing `Analysis Date` from `.planning/codebase/` docs and running `git log --until $analysisDate`. When the Analysis Date predates the repo's earliest commit, `git log` returns empty and the function returns `{ brownfieldDocStale: false, reason: 'no_commit_at_date' }`. Auto-refresh never triggers.

**Confirmed on kata-orchestrator:**
- Analysis Date in codebase docs: `2026-01-16`
- Earliest git commit: `2026-01-18`
- `detect-stale-intel.cjs` output: `brownfieldDocStale: false, reason: "no_commit_at_date"`
- summary.md reflects GSD-era January 2026 state (wrong stack, wrong conventions, mentions deprecated directories)

**Fix:** When `no_commit_at_date`, fall back to repo's first commit as baseline. Diff source files from that commit to HEAD. If change percentage exceeds 30%, treat brownfield docs as stale. File: `skills/kata-map-codebase/scripts/detect-stale-intel.cjs`.

---

### GAP-2: update-intel-summary.cjs codebase-dir guard blocks brownfield summary enrichment

**Severity:** Medium
**Category:** flows (code-scan convention data never reaches summary.md for brownfield projects)

**Root cause:** `update-intel-summary.cjs` line 54: `if (dirExists(codebaseDir)) return`. For brownfield projects, this exits early regardless of whether a code scan just ran. scan-codebase.cjs v2 naming convention confidence scores and per-file data are in `index.json`/`conventions.json` but never surface in `summary.md`. File: `skills/kata-execute-phase/scripts/update-intel-summary.cjs`.

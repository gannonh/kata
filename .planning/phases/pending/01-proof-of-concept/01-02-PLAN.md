---
phase: 01-proof-of-concept
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/kata-execute-phase/references/executor-instructions.md
  - skills/kata-execute-phase/SKILL.md
  - skills/kata-execute-phase/references/phase-execute.md
  - skills/kata-execute-phase/references/execute-plan.md
autonomous: true

must_haves:
  truths:
    - "kata-execute-phase spawns general-purpose subagents with executor instructions inlined"
    - "All reference files in kata-execute-phase use general-purpose subagent type"
    - "Executor instructions file contains the full body content from agents/kata-executor.md (no frontmatter)"
  artifacts:
    - path: "skills/kata-execute-phase/references/executor-instructions.md"
      provides: "Executor agent instructions as skill resource"
      min_lines: 770
    - path: "skills/kata-execute-phase/SKILL.md"
      provides: "Updated orchestrator using general-purpose subagent"
      contains: "subagent_type=\"general-purpose\""
    - path: "skills/kata-execute-phase/references/phase-execute.md"
      provides: "Updated reference with general-purpose subagent type"
    - path: "skills/kata-execute-phase/references/execute-plan.md"
      provides: "Updated reference with general-purpose subagent type"
  key_links:
    - from: "skills/kata-execute-phase/SKILL.md"
      to: "skills/kata-execute-phase/references/executor-instructions.md"
      via: "Read tool to inline instructions into Task prompt"
      pattern: "executor.instructions"
    - from: "skills/kata-execute-phase/SKILL.md"
      to: "Task() wave calls"
      via: "agent-instructions wrapper in prompt"
      pattern: "agent-instructions"
---

<objective>
Migrate kata-executor from custom subagent to skill resource with inlined instructions.

Purpose: Second half of the POC. Converts the executor agent path from implicit system prompt (custom agent lookup) to explicit prompt content (inlined from skill resource). Covers POC-02 and POC-04.
Output: `executor-instructions.md` skill resource + updated `kata-execute-phase` SKILL.md and reference files
</objective>

<execution_context>
<!-- Executor agent has built-in instructions for plan execution and summary creation -->
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/pending/01-proof-of-concept/01-RESEARCH.md

Source files:
@agents/kata-executor.md
@skills/kata-execute-phase/SKILL.md
@skills/kata-execute-phase/references/phase-execute.md
@skills/kata-execute-phase/references/execute-plan.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract executor instructions to skill resource</name>
  <files>skills/kata-execute-phase/references/executor-instructions.md</files>
  <action>
Read `agents/kata-executor.md`. Extract everything AFTER the closing `---` of the YAML frontmatter (line 7 onward). The frontmatter block is lines 1-6 (the `---`, name, description, tools, color, `---`). Copy lines 7+ verbatim into `skills/kata-execute-phase/references/executor-instructions.md`.

Do NOT include the frontmatter. Do NOT restructure, rewrite, or improve the content. Verbatim copy of the body.

Verify the new file does NOT start with `---` and does NOT contain `tools:`, `color:`, or `model:` YAML fields.
  </action>
  <verify>
1. `head -1 skills/kata-execute-phase/references/executor-instructions.md` does NOT start with `---`
2. `wc -l skills/kata-execute-phase/references/executor-instructions.md` shows ~773+ lines
3. File starts with `<role>` tag
  </verify>
  <done>executor-instructions.md exists with full agent body content (no frontmatter), starting with `<role>` tag</done>
</task>

<task type="auto">
  <name>Task 2: Update kata-execute-phase SKILL.md and reference files</name>
  <files>skills/kata-execute-phase/SKILL.md, skills/kata-execute-phase/references/phase-execute.md, skills/kata-execute-phase/references/execute-plan.md</files>
  <action>
**Step A: Update SKILL.md wave_execution section**

The `<wave_execution>` section (lines ~660-679) has 3 Task() calls at lines 671-673. Each currently looks like:

```
Task(prompt="Execute plan at {plan_01_path}\n\n<plan>\n{plan_01_content}\n</plan>\n\n<project_state>\n{state_content}\n</project_state>", subagent_type="kata-executor", model="{executor_model}")
```

Update each to:

```
Task(prompt="<agent-instructions>\n{executor_instructions_content}\n</agent-instructions>\n\nExecute plan at {plan_01_path}\n\n<plan>\n{plan_01_content}\n</plan>\n\n<project_state>\n{state_content}\n</project_state>", subagent_type="general-purpose", model="{executor_model}")
```

Changes per line:
1. Prepend `<agent-instructions>\n{executor_instructions_content}\n</agent-instructions>\n\n` to the prompt
2. Change `subagent_type="kata-executor"` to `subagent_type="general-purpose"`

Add a read instruction to the `<wave_execution>` section's "Read these files" list: include reading `references/executor-instructions.md` (relative to skill base directory) and store as `executor_instructions_content`.

**Step B: Update references/phase-execute.md**

Two occurrences to update:
- Line ~318: `Task(prompt="{subagent-task-prompt}", subagent_type="kata-executor", model="{executor_model}")`
- Line ~357: `subagent_type="kata-executor",`

Change both to use `subagent_type="general-purpose"` and show the `<agent-instructions>` wrapper in the prompt examples.

**Step C: Update references/execute-plan.md**

Two occurrences to update:
- Line ~240: `Use Task tool with subagent_type="kata-executor" and model="{executor_model}":`
- Line ~392: `Spawn Task tool with subagent_type="kata-executor" and model="{executor_model}":`

Change both references from `kata-executor` to `general-purpose`.

Do NOT change model selection logic. Do NOT change any other sections of any file.
  </action>
  <verify>
1. `grep -r 'subagent_type="kata-executor"' skills/kata-execute-phase/` returns empty
2. `grep -c 'subagent_type="general-purpose"' skills/kata-execute-phase/SKILL.md` returns 3
3. `grep -c 'agent-instructions' skills/kata-execute-phase/SKILL.md` returns at least 3
4. `grep 'kata-executor' skills/kata-execute-phase/references/phase-execute.md` returns empty
5. `grep 'kata-executor' skills/kata-execute-phase/references/execute-plan.md` returns empty
6. `npm run build:plugin` succeeds
  </verify>
  <done>
- All 3 Task() calls in SKILL.md use subagent_type="general-purpose" with inlined instructions
- phase-execute.md and execute-plan.md reference files updated to general-purpose
- Zero remaining references to "kata-executor" subagent type in skills/kata-execute-phase/
- Build passes
  </done>
</task>

</tasks>

<verification>
- `grep -r 'subagent_type="kata-executor"' skills/kata-execute-phase/` returns empty (no stale references)
- `grep -r 'subagent_type="general-purpose"' skills/kata-execute-phase/` returns 5+ matches (SKILL.md + reference files)
- `grep 'agent-instructions' skills/kata-execute-phase/SKILL.md` returns 3+ matches
- executor-instructions.md starts with `<role>` (first tag in agent body)
- `npm run build:plugin` succeeds without errors
</verification>

<success_criteria>
1. `skills/kata-execute-phase/references/executor-instructions.md` exists with ~773 lines of agent instructions
2. `skills/kata-execute-phase/` directory contains zero references to `kata-executor` subagent type
3. All wave execution Task() calls use general-purpose with inlined instructions
4. Reference files (phase-execute.md, execute-plan.md) updated consistently
5. Plugin build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/pending/01-proof-of-concept/01-02-SUMMARY.md`
</output>

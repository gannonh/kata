---
phase: 01-proof-of-concept
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/kata-plan-phase/references/planner-instructions.md
  - skills/kata-plan-phase/SKILL.md
autonomous: true

must_haves:
  truths:
    - "kata-plan-phase spawns a general-purpose subagent with planner instructions inlined"
    - "Both standard and revision mode Task() calls include agent-instructions wrapper"
    - "Planner instructions file contains the full body content from agents/kata-planner.md (no frontmatter)"
  artifacts:
    - path: "skills/kata-plan-phase/references/planner-instructions.md"
      provides: "Planner agent instructions as skill resource"
      min_lines: 1400
    - path: "skills/kata-plan-phase/SKILL.md"
      provides: "Updated orchestrator using general-purpose subagent"
      contains: "subagent_type=\"general-purpose\""
  key_links:
    - from: "skills/kata-plan-phase/SKILL.md"
      to: "skills/kata-plan-phase/references/planner-instructions.md"
      via: "Read tool to inline instructions into Task prompt"
      pattern: "planner.instructions"
    - from: "skills/kata-plan-phase/SKILL.md"
      to: "Task() call"
      via: "agent-instructions wrapper in prompt"
      pattern: "agent-instructions"
---

<objective>
Migrate kata-planner from custom subagent to skill resource with inlined instructions.

Purpose: First half of the POC. Converts the planner agent path from implicit system prompt (custom agent lookup) to explicit prompt content (inlined from skill resource). Covers POC-01 and POC-03.
Output: `planner-instructions.md` skill resource + updated `kata-plan-phase` SKILL.md
</objective>

<execution_context>
<!-- Executor agent has built-in instructions for plan execution and summary creation -->
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/pending/01-proof-of-concept/01-RESEARCH.md

Source files:
@agents/kata-planner.md
@skills/kata-plan-phase/SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract planner instructions to skill resource and update SKILL.md</name>
  <files>skills/kata-plan-phase/references/planner-instructions.md, skills/kata-plan-phase/SKILL.md</files>
  <action>
**Step A: Create planner-instructions.md**

Read `agents/kata-planner.md`. Extract everything AFTER the closing `---` of the YAML frontmatter (line 7 onward). The frontmatter block is lines 1-6 (the `---`, name, description, tools, color, `---`). Copy lines 7+ verbatim into `skills/kata-plan-phase/references/planner-instructions.md`.

Do NOT include the frontmatter. Do NOT restructure, rewrite, or improve the content. Verbatim copy of the body.

Verify the new file does NOT start with `---` and does NOT contain `tools:`, `color:`, or `model:` YAML fields.

**Step B: Update kata-plan-phase SKILL.md**

The SKILL.md has two Task() calls that spawn `kata-planner`:

1. **Step 8 (standard planning)** at line ~400-406:
   ```
   Task(
     prompt=filled_prompt,
     subagent_type="kata-planner",
     model="{planner_model}",
     description="Plan Phase {phase}"
   )
   ```

2. **Step 12 (revision mode)** at line ~530-536:
   ```
   Task(
     prompt=revision_prompt,
     subagent_type="kata-planner",
     model="{planner_model}",
     description="Revise Phase {phase} plans"
   )
   ```

For BOTH calls:
- Change `subagent_type="kata-planner"` to `subagent_type="general-purpose"`
- Update the prompt parameter to prepend `<agent-instructions>` wrapper

**Add a read step** before step 8 (in step 7 where other context files are read). Add reading of `references/planner-instructions.md` (relative to skill base directory). Store content for inlining.

The updated prompt structure for step 8:
```
"<agent-instructions>\n{planner_instructions_content}\n</agent-instructions>\n\n" + filled_prompt
```

The updated prompt structure for step 12:
```
"<agent-instructions>\n{planner_instructions_content}\n</agent-instructions>\n\n" + revision_prompt
```

The existing prompt sections (`<planning_context>`, `<downstream_consumer>`, `<quality_gate>`, `<revision_context>`, `<instructions>`) stay exactly as-is. The `<agent-instructions>` block gets PREPENDED.

Do NOT change model selection logic. Do NOT change any other part of the SKILL.md.
  </action>
  <verify>
1. `grep -c 'subagent_type="kata-planner"' skills/kata-plan-phase/SKILL.md` returns 0
2. `grep -c 'subagent_type="general-purpose"' skills/kata-plan-phase/SKILL.md` returns 2
3. `grep -c 'agent-instructions' skills/kata-plan-phase/SKILL.md` returns at least 2
4. `head -1 skills/kata-plan-phase/references/planner-instructions.md` does NOT start with `---`
5. `wc -l skills/kata-plan-phase/references/planner-instructions.md` shows ~1430+ lines
6. `npm run build:plugin` succeeds
  </verify>
  <done>
- planner-instructions.md exists with full agent body content (no frontmatter)
- Both Task() calls in SKILL.md use subagent_type="general-purpose"
- Both Task() calls wrap instructions in agent-instructions tags
- Build passes
  </done>
</task>

</tasks>

<verification>
- `grep -r 'subagent_type="kata-planner"' skills/kata-plan-phase/` returns empty
- `grep -r 'subagent_type="general-purpose"' skills/kata-plan-phase/SKILL.md` returns 2 matches
- `grep 'agent-instructions' skills/kata-plan-phase/SKILL.md` returns matches for both standard and revision Task() calls
- planner-instructions.md starts with `<role>` (first tag in agent body)
- `npm run build:plugin` succeeds without errors
</verification>

<success_criteria>
1. `skills/kata-plan-phase/references/planner-instructions.md` exists with ~1430 lines of agent instructions
2. `skills/kata-plan-phase/SKILL.md` contains zero references to `kata-planner` subagent type
3. Both standard (step 8) and revision (step 12) Task() calls use general-purpose with inlined instructions
4. Plugin build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/pending/01-proof-of-concept/01-01-SUMMARY.md`
</output>

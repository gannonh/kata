---
phase: 36-workflow-integration
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/kata-research-phase/SKILL.md
  - skills/kata-plan-phase/SKILL.md
autonomous: true
source_issue: "github:#99"
must_haves:
  truths:
    - kata-research-phase offers optional brainstorm follow-up after research completes (Step 5)
    - kata-plan-phase offers optional brainstorm step at the research decision gate (Step 5)
    - Declining brainstorm at either integration point continues the parent workflow without blocking
    - Each brainstorm gate uses AskUserQuestion with "Brainstorm first" and "Skip" options
  artifacts:
    - skills/kata-research-phase/SKILL.md (modified)
    - skills/kata-plan-phase/SKILL.md (modified)
  key_links:
    - kata-research-phase brainstorm follow-up appears after RESEARCH COMPLETE handling in Step 5
    - kata-plan-phase brainstorm gate appears in Step 5 before research spawning
    - Both gates invoke /kata-brainstorm as a sub-skill when accepted
    - Brainstorm skill handles its own Agent Teams prerequisite check
---

<objective>
Add optional brainstorm gates to kata-research-phase and kata-plan-phase skills.

Purpose: kata-research-phase should offer a brainstorm follow-up after research completes, allowing users to brainstorm based on research findings. kata-plan-phase should offer a brainstorm option at its research decision gate, before spawning the researcher.

Output: Two modified SKILL.md files with brainstorm integration points.
</objective>

<execution_context>
<!-- Executor agent has built-in instructions for plan execution and summary creation -->
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/pending/36-workflow-integration/36-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add brainstorm follow-up to kata-research-phase</name>
  <files>skills/kata-research-phase/SKILL.md</files>
  <action>
Modify Step 5 (Handle Agent Return) to add a brainstorm follow-up option after research completes successfully.

In the current Step 5, when `## RESEARCH COMPLETE` is returned, the skill offers: "Plan phase, Dig deeper, Review full, Done."

Add a brainstorm option to this list. After the "Display summary" instruction and before the existing offer list, insert an AskUserQuestion brainstorm gate:

After the `## RESEARCH COMPLETE` handler's "Display summary" line, add:

```markdown
**Brainstorm follow-up:**

Use AskUserQuestion:

- header: "Brainstorm"
- question: "Brainstorm ideas based on research findings?"
- options:
  - "Brainstorm first" — Run explorer/challenger brainstorm session informed by research
  - "Skip" — Continue to next steps

**If "Brainstorm first":**

Display:

```
Launching brainstorm session...
```

Run `/kata-brainstorm`

After brainstorm completes, continue to offer next steps (Plan phase, Dig deeper, Review full, Done).

**If "Skip":** Continue to offer next steps.
```

Insert this within the `## RESEARCH COMPLETE` handler in Step 5, after displaying the summary but before offering the existing options (Plan phase, Dig deeper, etc.).

Do NOT modify any other steps or sections.
  </action>
  <verify>
Read skills/kata-research-phase/SKILL.md and verify:
1. Step 5 RESEARCH COMPLETE handler includes brainstorm follow-up AskUserQuestion
2. Brainstorm gate appears after summary display
3. "Brainstorm first" invokes /kata-brainstorm
4. "Skip" continues to existing options
5. All other steps unchanged
  </verify>
  <done>
kata-research-phase SKILL.md offers brainstorm follow-up after research completes. Skip path continues to existing next-step options.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add brainstorm gate to kata-plan-phase research decision</name>
  <files>skills/kata-plan-phase/SKILL.md</files>
  <action>
Add an optional brainstorm step at the research decision point in Step 5 (Handle Research).

The current Step 5 handles research decisions: check for `--gaps`, `--skip-research`, config setting, existing research. After all these checks, if research is needed, it spawns the researcher.

Insert a brainstorm gate BEFORE the research spawn decision. Add it after the line "**If RESEARCH.md missing OR `--research` flag set:**" and before the "Display stage banner" for RESEARCHING.

Add the following section:

```markdown
**Optional brainstorm before research:**

Use AskUserQuestion:

- header: "Brainstorm"
- question: "Brainstorm approaches before researching this phase?"
- options:
  - "Brainstorm first" — Run explorer/challenger brainstorm session
  - "Skip" — Continue to research

**If "Brainstorm first":**

Display:

```
Launching brainstorm session...
```

Run `/kata-brainstorm`

After brainstorm completes, continue to research.

**If "Skip":** Continue to research.
```

Insert this between the "**If RESEARCH.md missing OR `--research` flag set:**" line and the stage banner display. The brainstorm gate fires only when research is about to happen (not when skipped or already exists).

Do NOT modify any other steps or content in the file.
  </action>
  <verify>
Read skills/kata-plan-phase/SKILL.md and verify:
1. Step 5 includes brainstorm gate before research spawning
2. Gate only fires when research is about to happen (after skip/exists checks)
3. AskUserQuestion has "Brainstorm" header with "Brainstorm first" and "Skip" options
4. "Brainstorm first" invokes /kata-brainstorm, then continues to research
5. "Skip" continues to research
6. All other steps unchanged
  </verify>
  <done>
kata-plan-phase SKILL.md offers brainstorm option at the research decision gate. Gate fires only when research is about to run. Both paths continue to research.
  </done>
</task>

</tasks>

<verification>
1. kata-research-phase offers brainstorm follow-up after research completes
2. kata-plan-phase offers brainstorm before research spawning
3. Both gates use consistent AskUserQuestion pattern
4. Neither gate blocks the parent workflow on decline
5. Brainstorm gates fire at the right workflow points (not when research is skipped)
</verification>

<success_criteria>
- [ ] kata-research-phase has brainstorm follow-up in Step 5 RESEARCH COMPLETE handler
- [ ] kata-plan-phase has brainstorm gate in Step 5 before research spawn
- [ ] Both gates use consistent AskUserQuestion pattern
- [ ] "Skip" never blocks parent workflow
- [ ] Brainstorm gates positioned correctly relative to skip/exists checks
- [ ] No other content modified in either file
</success_criteria>

<output>
After completion, create `.planning/phases/pending/36-workflow-integration/36-02-SUMMARY.md`
</output>

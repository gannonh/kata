---
phase: 03-phase-lookup-ignores-milestone-scope-causing-collisions
plan: 03
type: execute
wave: 2
depends_on: ["03-01", "03-02"]
files_modified:
  - .planning/ROADMAP.md
  - .planning/STATE.md
autonomous: true
source_issue: "github:gannonh/kata-orchestrator#102"
must_haves:
  truths:
    - ROADMAP.md current milestone section uses globally sequential phase numbers
    - STATE.md reflects the new global phase number for this phase
    - Completed milestone details blocks in ROADMAP.md are left as historical records
  artifacts:
    - Updated ROADMAP.md with new phase numbers for v1.6.0 phases
    - Updated STATE.md current position with new global phase number
  key_links:
    - .planning/ROADMAP.md
    - .planning/STATE.md
---

<objective>
Update ROADMAP.md and STATE.md to reflect globally sequential phase numbers.

Purpose: After Plans 01 and 02 renamed directories and updated policy, ROADMAP.md and STATE.md still reference old per-milestone phase numbers (Phase 1, 2, 3, 4, 5, 6 within v1.6.0). These need updating to the new global numbers.

Output: ROADMAP.md and STATE.md use correct global phase numbers throughout.
</objective>

<execution_context>
<!-- Executor agent has built-in instructions for plan execution and summary creation -->
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/pending/03-phase-lookup-ignores-milestone-scope-causing-collisions/03-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update ROADMAP.md with global phase numbers</name>
  <files>.planning/ROADMAP.md</files>
  <action>
1. Read the current ROADMAP.md.

2. In the "Current Milestone: v1.6.0 Skills-Native Subagents" section, update phase headers and references:
   - Determine the actual global numbers by checking what the completed v1.6.0 phase directories were renamed to in Plan 01 (e.g., `ls .planning/phases/completed/ | grep "proof-of-concept\|full-conversion"` to find their new numbers).
   - Check pending directory names: `ls .planning/phases/pending/` to find the new numbers for phases 3-6.
   - Update `### Phase N:` headers to use the new global numbers.
   - Update plan filename references (e.g., `01-01-PLAN.md` stays as-is since internal files weren't renamed for completed phases; but plan references should match actual filenames).
   - Update `Dependencies: Phase N` references to use new global numbers.

3. Completed milestones in `<details>` blocks: Leave as-is. These are historical records. The archived roadmaps in `.planning/milestones/` are the authoritative record for those milestones.

4. Update the Milestones overview bullet for v1.6.0 if it references a phase count or phase number.

5. Update the `*Last updated:*` footer line.

IMPORTANT: Do NOT update plan filenames inside completed phases. The internal files (01-01-PLAN.md etc.) were intentionally left with old names since they use wildcard matching for discovery.
  </action>
  <verify>
```bash
# Phase headers in current milestone section use new global numbers
grep "### Phase" .planning/ROADMAP.md | tail -10
# Should show numbers > 33 for v1.6.0 phases

# Dependencies reference correct global numbers
grep "Dependencies:" .planning/ROADMAP.md | tail -10
```
  </verify>
  <done>ROADMAP.md current milestone section uses globally sequential phase numbers consistent with renamed directories.</done>
</task>

<task type="auto">
  <name>Task 2: Update STATE.md current position and decisions</name>
  <files>.planning/STATE.md</files>
  <action>
1. Read the current STATE.md.

2. Update "Current Position" section:
   - Change `Phase: 2 - Full Conversion (completed)` to use the new global phase number for this phase (the one being planned/executed now, i.e., the phase-lookup-fix phase).
   - Update `Progress: ███░░░░░░░ 2/6 phases` — keep 2/6 ratio but use "Phase {global_N}" reference.

3. Update "Accumulated Context > Decisions" section:
   - The 2026-02-03 decision about per-milestone numbering should be marked as reverted: "Per-milestone phase numbering — Each milestone starts phase numbering at 1 (REVERTED by Phase {N})"
   - Add new decision: "2026-02-06: Globally sequential phase numbering restored — Phase numbers never reset at milestone boundaries. Reverts 2026-02-03 decision. Closes #102."

4. Update "Roadmap Evolution" entry for v1.6.0 to note the phase renumbering.

5. Update `Last activity:` and `Session Continuity` section to reflect current date and phase.
  </action>
  <verify>
```bash
# STATE.md references new global phase number
grep "Phase:" .planning/STATE.md | head -3

# Revert decision documented
grep -i "revert" .planning/STATE.md
```
  </verify>
  <done>STATE.md current position uses new global phase number. Decision log documents the revert.</done>
</task>

</tasks>

<verification>
- ROADMAP.md current milestone phase headers match actual directory names in completed/ and pending/
- STATE.md current position references the correct global phase number
- Completed milestone `<details>` blocks in ROADMAP.md are unchanged
</verification>

<success_criteria>
- ROADMAP.md and STATE.md are consistent with the renamed directories from Plan 01
- Decision log in STATE.md documents the numbering model revert
- No references to old per-milestone phase numbers remain in active documentation
</success_criteria>

<output>
After completion, create `.planning/phases/pending/{N}-phase-lookup-ignores-milestone-scope-causing-collisions/03-03-SUMMARY.md`
</output>

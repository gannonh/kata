---
phase: 03-phase-lookup-ignores-milestone-scope-causing-collisions
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/completed/*/
  - .planning/phases/pending/03-*/
  - .planning/phases/pending/04-*/
autonomous: true
source_issue: "github:gannonh/kata-orchestrator#102"
must_haves:
  truths:
    - Every completed phase directory has a globally unique numeric prefix
    - No two directories share the same numeric prefix
    - Pending phase directories use continuation numbering from highest completed phase
  artifacts:
    - Renamed completed phase directories with globally sequential prefixes
    - Renamed pending phase directories and internal files
  key_links:
    - .planning/phases/completed/ (all directories)
    - .planning/phases/pending/ (03, 04 directories)
    - .planning/milestones/ (archive roadmaps for ordering)
---

<objective>
Batch-rename all phase directories to globally sequential numbers, eliminating prefix collisions.

Purpose: Phase directories currently share numeric prefixes across milestones (eight directories start with `01-*`). Globally sequential numbering makes every prefix unique, so `find -name "${PADDED}-*" | head -1` returns the correct directory.

Output: All 33 completed phase directories and 2 pending phase directories renamed with unique sequential prefixes. Internal files in pending directories renamed to match.
</objective>

<execution_context>
<!-- Executor agent has built-in instructions for plan execution and summary creation -->
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/pending/03-phase-lookup-ignores-milestone-scope-causing-collisions/03-CONTEXT.md
@.planning/phases/pending/03-phase-lookup-ignores-milestone-scope-causing-collisions/03-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build chronological rename mapping and batch-rename completed directories</name>
  <files>.planning/phases/completed/*/</files>
  <action>
Build a bash script that:

1. Defines the chronological milestone-to-phase mapping. Walk milestones in shipped order and assign globally sequential numbers. The mapping is:

| Global | Milestone | Old Dir Name | New Dir Name |
|--------|-----------|-------------|-------------|
| 00 | v0.1.4 | 00-hard-fork-rebrand | 00-hard-fork-rebrand (unchanged) |
| 01 | v0.1.5 | 00-convert-commands-to-skills | 01-convert-commands-to-skills |
| 02 | v0.1.5 | 01-migrate-todo-commands | 02-migrate-todo-commands |
| 03 | v0.1.5 | 01.1-testing-evals-harness | 03-testing-evals-harness |
| 04 | v0.1.5 | 01.2-skill-tests | 04-skill-tests |
| 05 | v0.1.5 | 01.3-discuss-phase-skill | 05-discuss-phase-skill |
| 06 | v0.1.5 | 02-create-kata-slash-commands | 06-create-kata-slash-commands |
| 07 | v1.0.0 | v0.1.9-01-plugin-structure-validation | 07-plugin-structure-validation |
| 08 | v1.0.0 | v0.1.9-01.1-document-pr-workflow-behavior | 08-document-pr-workflow-behavior |
| 09 | v1.0.0 | 02-marketplace-distribution | 09-marketplace-distribution |
| 10 | v1.0.8 | v1.0.6-02.1-skill-resource-restructure | 10-skill-resource-restructure |
| 11 | v1.0.9 | v1.0.9-02.2-normalize-on-skills | 11-normalize-on-skills |
| 12 | v1.1.0 | 00-develop-robust-testing-suite | 12-develop-robust-testing-suite |
| 13 | v1.1.0 | 01-audit-config-foundation | 13-audit-config-foundation |
| 14 | v1.1.0 | 02-github-issue-sync (was v1.1.0 Phase 2: Onboarding & Milestones) | 14-onboarding-milestones |
| 15 | v1.1.0 | (Phase 2.1 GitHub Repo Setup - check if directory exists) | 15-github-repo-setup |
| 16 | v1.1.0 | (Phase 2.2 Decouple Project Init - check if directory exists) | 16-decouple-project-init |
| 17 | v1.1.0 | 03-phase-issues | 17-phase-issues |
| 18 | v1.1.0 | 04-plan-sync | 18-plan-sync |
| 19 | v1.1.0 | 05-pr-integration | 19-pr-integration |
| 20 | v1.1.0 | 06-pr-review-workflow-skill-agents | 20-pr-review-workflow-skill-agents |
| 21 | v1.1.0 | 07-deprecate-npx-support | 21-deprecate-npx-support |
| 22 | v1.3.0 | 00-foundation-ci-hardening | 22-foundation-ci-hardening |
| 23 | v1.3.0 | 01-release-automation | 23-release-automation |
| 24 | v1.3.3 | 01-internal-documentation | 24-internal-documentation |
| 25 | v1.4.0 | 01-issue-model-foundation | 25-issue-model-foundation |
| 26 | v1.4.0 | 02-issue-execution-workflow (was v1.4.0 Phase 2: GitHub Issue Sync) | 26-github-issue-sync |
| 27 | v1.4.1 | 01-pr-issue-closure | 27-pr-issue-closure |
| 28 | v1.4.1 | 02-issue-execution-workflow | 28-issue-execution-workflow |
| 29 | v1.4.1 | 03-issue-roadmap-integration | 29-issue-roadmap-integration |
| 30 | v1.4.1 | 04-wire-plan-phase-issue-context | 30-wire-plan-phase-issue-context |
| 31 | v1.5.0 | 01-phase-organization | 31-phase-organization |
| 32 | v1.5.0 | 02-phase-movement | 32-phase-movement |
| 33 | v1.5.0 | 03-roadmap-enhancements (check actual dir name) | 33-roadmap-enhancements |
| 34 | v1.6.0 | 01-proof-of-concept | 34-proof-of-concept |
| 35 | v1.6.0 | 02-full-conversion | 35-full-conversion |

IMPORTANT: The table above is an approximate guide. Before renaming, you MUST:
- Verify each old directory actually exists at the expected path
- Cross-reference milestone archive roadmaps in `.planning/milestones/` to confirm phase ordering within each milestone
- Handle the `v1.1.0-05-pr-integration` duplicate (remove it if `05-pr-integration` already has the same content, or merge)
- Handle v1.1.0 phases 2, 2.1, 2.2 carefully -- `02-github-issue-sync` may actually be v1.4.0 Phase 2, not v1.1.0 Phase 2. Check milestone archives to disambiguate directories with identical prefixes
- Any directories not in the mapping but present in completed/ must also be assigned numbers
- v1.0.0 Phase 3 (Documentation) may or may not have a directory -- skip if missing
- v1.2.0 and v1.2.1 may not have phase directories -- skip if missing

2. Execute the renames using `mv` for each directory. Rename only directory names, NOT internal filenames for completed phases (internal files use wildcard matching `*-PLAN.md`).

3. After all renames, verify no duplicate prefixes remain:
```bash
ls .planning/phases/completed/ | grep -oE '^[0-9]+' | sort -n | uniq -d
```
This should produce empty output.
  </action>
  <verify>
```bash
# No duplicate numeric prefixes
ls .planning/phases/completed/ | grep -oE '^[0-9]+' | sort -n | uniq -d | wc -l
# Should output: 0

# Total directory count matches expected
ls .planning/phases/completed/ | wc -l
# Should be 33-35 directories (exact count depends on which milestones had directories)
```
  </verify>
  <done>All completed phase directories have globally unique sequential numeric prefixes. No collisions.</done>
</task>

<task type="auto">
  <name>Task 2: Rename pending phase directories and internal files</name>
  <files>.planning/phases/pending/03-phase-lookup-ignores-milestone-scope-causing-collisions/, .planning/phases/pending/04-skills-sh-distribution/</files>
  <action>
The pending phases belong to v1.6.0. After completed phases end at ~35 (full-conversion), the pending phases continue:

1. Determine the next global number after the highest completed phase number.
2. Rename `03-phase-lookup-ignores-milestone-scope-causing-collisions` to `{N}-phase-lookup-ignores-milestone-scope-causing-collisions` where N is the next number (likely 36).
3. Rename internal files: `03-CONTEXT.md` -> `{N}-CONTEXT.md`, `03-RESEARCH.md` -> `{N}-RESEARCH.md`.
4. Rename `04-skills-sh-distribution` to `{N+1}-skills-sh-distribution`.
5. Since the pending 04 directory has no internal files yet, just the directory rename is needed.

NOTE: This plan (03-01-PLAN.md) is inside the directory being renamed. After renaming, this plan's path changes. That's fine -- the executor should complete this task before the rename path matters.
  </action>
  <verify>
```bash
# Pending directories have correct sequential numbers
ls .planning/phases/pending/
# Should show two directories with numbers continuing from completed highest

# Internal files renamed
ls .planning/phases/pending/*-phase-lookup-*/
# Should show {N}-CONTEXT.md and {N}-RESEARCH.md (not 03-*)
```
  </verify>
  <done>Pending phase directories use continuation numbering. Internal files renamed to match.</done>
</task>

</tasks>

<verification>
- `ls .planning/phases/completed/ | grep -oE '^[0-9]+' | sort -n | uniq -d` produces no output
- `ls .planning/phases/pending/` shows directories with numbers > highest completed
- No `03-` or `04-` prefixed directories remain in pending/ (old milestone-scoped numbers)
</verification>

<success_criteria>
- Every phase directory across completed/ and pending/ has a globally unique sequential numeric prefix
- Zero duplicate numeric prefixes exist
- Internal files in pending directories match their new directory prefix
</success_criteria>

<output>
After completion, create `.planning/phases/pending/{N}-phase-lookup-ignores-milestone-scope-causing-collisions/03-01-SUMMARY.md`
(Use the OLD plan number 03-01 in the summary filename for traceability)
</output>

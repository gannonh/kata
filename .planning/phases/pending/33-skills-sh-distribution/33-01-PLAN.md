---
phase: 33-skills-sh-distribution
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/build.js
  - package.json
  - tests/build.test.js
autonomous: true
user_setup: []
source_issue: ""

must_haves:
  truths:
    - build.js accepts "skills-sh" target and produces dist/skills-sh/skills/ output
    - Frontmatter transformation strips user-invocable, disable-model-invocation
    - allowed-tools converted from YAML list to space-delimited string
    - license, compatibility, and metadata.author fields added to frontmatter
    - hooks/ directory excluded from skills-sh build
    - .claude-plugin/ directory excluded from skills-sh build
    - "Triggers include" suffix stripped from descriptions
  artifacts:
    - dist/skills-sh/skills/ with all kata-* skill directories
  key_links:
    - scripts/build.js (build system)
    - tests/build.test.js (build validation)
---

<objective>
Add a skills.sh build target to the build system that produces Agent Skills spec-compliant output.

Purpose: The existing build produces a Claude Code plugin. This plan adds a second build target that transforms skill frontmatter to match the Agent Skills specification (agentskills.io), outputting to `dist/skills-sh/`.

Output: Modified build.js with `skills-sh` target, `npm run build:skills-sh` script, build tests validating the output.
</objective>

<execution_context>
<!-- Executor agent has built-in instructions for plan execution and summary creation -->
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@scripts/build.js
@tests/build.test.js
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add skills-sh build target to build.js</name>
  <files>scripts/build.js, package.json</files>
  <action>
Add a `buildSkillsSh()` function to `scripts/build.js` that:

1. Outputs to `dist/skills-sh/skills/` (note: skills/ subdirectory, matching repo structure)
2. Copies all skill directories from `skills/` source, excluding hooks/ and .claude-plugin/
3. Transforms SKILL.md frontmatter during copy:
   - Remove `user-invocable` line
   - Remove `disable-model-invocation` line
   - Convert `allowed-tools` from YAML list format to space-delimited string format:
     ```yaml
     # Source (YAML list):
     allowed-tools:
       - Read
       - Write
       - Bash
     # Output (space-delimited string):
     allowed-tools: Read Write Bash
     ```
   - Add `license: MIT` after the description line
   - Add `compatibility: Designed for Claude Code. Requires project .planning/ directory.` after license
   - Ensure `metadata` section includes `author: gannonh` (merge with existing metadata if present)
   - Strip "Triggers include..." suffix from description values (regex: remove `. Triggers include.*$` and `Triggers include.*$` patterns from description, trimming trailing whitespace and periods)
4. Does NOT copy hooks/, .claude-plugin/, CHANGELOG.md, or VERSION file (those are plugin-specific)

Update `main()` to accept `skills-sh` and `all` targets. When target is `all`, run both `buildPlugin()` and `buildSkillsSh()`.

Add to package.json scripts:
```json
"build:skills-sh": "node scripts/build.js skills-sh",
"build:all": "node scripts/build.js all"
```

The frontmatter transformation function should be called `transformSkillsShFrontmatter(content)` and handle the YAML manipulation via string operations (matching the existing approach in build.js, no YAML library).
  </action>
  <verify>
Run `npm run build:skills-sh` and verify:
- `dist/skills-sh/skills/` directory exists with all kata-* skill directories
- Pick a skill (e.g., kata-plan-phase) and verify its SKILL.md frontmatter:
  - No `user-invocable` line
  - No `disable-model-invocation` line
  - `allowed-tools` is space-delimited string, not YAML list
  - Has `license: MIT`
  - Has `compatibility:` line
  - Has `author: gannonh` in metadata
  - Description does not contain "Triggers include"
- No hooks/ directory in output
- No .claude-plugin/ directory in output
  </verify>
  <done>
`npm run build:skills-sh` produces dist/skills-sh/skills/ with all skill directories containing spec-compliant SKILL.md frontmatter. No plugin-specific artifacts in output.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add build tests for skills-sh target</name>
  <files>tests/build.test.js</files>
  <action>
Add a new `describe('Skills-sh build', ...)` test suite to `tests/build.test.js` that:

1. In `before()`, runs `npm run build:skills-sh`
2. Tests:
   - `creates dist/skills-sh/skills directory` — directory exists
   - `includes all kata- skill directories` — every directory in source skills/ appears in output
   - `does not include hooks directory` — dist/skills-sh/hooks/ does not exist
   - `does not include .claude-plugin directory` — dist/skills-sh/.claude-plugin/ does not exist
   - `skill frontmatter has license field` — parse a SKILL.md, verify `license: MIT` present
   - `skill frontmatter has no user-invocable field` — verify field absent
   - `skill frontmatter has no disable-model-invocation field` — verify field absent
   - `skill frontmatter has space-delimited allowed-tools` — verify the `allowed-tools:` line is a single line (not followed by `  - ` list items)
   - `skill descriptions do not contain trigger phrases` — verify no "Triggers include" in any description
   - `skill frontmatter has compatibility field` — verify present
   - `skill name matches directory name` — for each skill, the `name:` field equals the directory name

Add this test file to the `npm test` script in package.json (append to the existing test command).
  </action>
  <verify>Run `npm test` — all existing tests pass and the new skills-sh build tests pass.</verify>
  <done>Skills-sh build tests validate frontmatter compliance. All tests green.</done>
</task>

</tasks>

<verification>
- `npm run build:skills-sh` completes without errors
- `npm test` passes (all existing + new tests)
- Spot-check 3 different skills in dist/skills-sh/skills/ for correct frontmatter
</verification>

<success_criteria>
- Build system produces Agent Skills spec-compliant output at dist/skills-sh/skills/
- Frontmatter transformation strips Claude Code-specific fields and adds spec fields
- Build tests validate the output format
- Existing plugin build unaffected
</success_criteria>

<output>
After completion, create `.planning/phases/pending/33-skills-sh-distribution/33-01-SUMMARY.md`
</output>

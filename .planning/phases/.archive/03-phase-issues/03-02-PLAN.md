---
phase: 03-phase-issues
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - tests/skills/kata-adding-milestones.test.js
  - skills/kata-executing-phases/references/github-integration.md
autonomous: true

must_haves:
  truths:
    - "Tests verify phase issue creation logic"
    - "GitHub integration docs reference phase issue creation"
    - "Test covers issueMode behavior"
  artifacts:
    - path: "tests/skills/kata-adding-milestones.test.js"
      provides: "Phase issue creation test coverage"
      contains: "phase issue"
    - path: "skills/kata-executing-phases/references/github-integration.md"
      provides: "Updated integration points for Phase 3"
      contains: "Phase 9.5"
  key_links:
    - from: "kata-adding-milestones.test.js"
      to: "kata-adding-milestones/SKILL.md"
      via: "tests phase issue patterns"
      pattern: "phase.*issue|gh issue create"
---

<objective>
Add tests for phase issue creation and update integration documentation.

Purpose: Ensure phase issue creation is tested and documented in the central integration reference.

Output:
- Updated `kata-adding-milestones.test.js` with phase issue tests
- Updated `github-integration.md` with Phase 3 implementation details
</objective>

<execution_context>
@~/.claude/kata/references/execute-plan.md
@~/.claude/kata/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-phase-issues/03-RESEARCH.md

Plan 01 output:
@skills/kata-adding-milestones/SKILL.md

Existing test:
@tests/skills/kata-adding-milestones.test.js

Integration docs:
@skills/kata-executing-phases/references/github-integration.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add phase issue tests to kata-adding-milestones.test.js</name>
  <files>tests/skills/kata-adding-milestones.test.js</files>
  <action>
Read the existing test file and add tests for phase issue creation.

Add a new describe block "Phase Issue Creation (Phase 9.5)" with tests:

1. **Test: contains issueMode config check**
   - Pattern: /issueMode.*auto.*ask.*never/ or checks for all three modes
   - Verify the skill checks issueMode before creating issues

2. **Test: contains phase label creation**
   - Pattern: /gh label create.*phase.*--force/
   - Verify idempotent label creation

3. **Test: contains milestone number lookup**
   - Pattern: /gh api.*milestones.*select.*title/
   - Verify it gets milestone number before creating issues

4. **Test: contains ROADMAP.md parsing for phases**
   - Pattern: /ROADMAP\.md/ AND /Phase.*Goal|Success Criteria/
   - Verify it extracts phase details from roadmap

5. **Test: contains idempotent issue existence check**
   - Pattern: /gh issue list.*--label.*phase.*--milestone/
   - Verify it checks before creating

6. **Test: uses --body-file pattern**
   - Pattern: /--body-file/
   - Verify it uses file-based body (not inline --body with special chars)

7. **Test: contains gh issue create with required flags**
   - Pattern: /gh issue create.*--title.*--label.*phase.*--milestone/
   - Verify all required flags present

Follow existing test patterns in the file for consistency.
  </action>
  <verify>npm test -- --grep "kata-adding-milestones" passes; test file contains "Phase Issue Creation"</verify>
  <done>Tests added for phase issue creation logic</done>
</task>

<task type="auto">
  <name>Task 2: Update github-integration.md with Phase 3 details</name>
  <files>skills/kata-executing-phases/references/github-integration.md</files>
  <action>
Read the existing github-integration.md and update the Phase 3 section.

Find the "Integration Points by Phase" section and update Phase 3:

**Before (placeholder):**
```
- `kata-planning-phases` (Phase 3-4): Create/update phase issue
```

**After (implemented):**
```
### Phase 3: Phase Issues (Implemented)

**Skill:** `kata-adding-milestones`
**When:** After ROADMAP.md committed and GitHub Milestone created (Phase 9.5)
**GitHub Action:** Create Issue for each phase in milestone

**Flow:**
1. Check `github.enabled` (skip if false)
2. Check `github.issueMode` (auto/ask/never)
3. Create `phase` label (idempotent)
4. Get milestone number from API
5. Parse phases from ROADMAP.md for this milestone
6. For each phase:
   - Check if issue exists (idempotent)
   - Create issue with goal, success criteria, requirement IDs
   - Assign to milestone, apply `phase` label

**Config Keys Checked:**
- `github.enabled` — Master toggle
- `github.issueMode` — Issue creation mode (auto/ask/never)

**Issue Body Structure:**
- Goal (from ROADMAP.md)
- Success Criteria (as checkboxes)
- Requirements (IDs from ROADMAP.md)
- Plans placeholder (filled by Phase 4)
```

Also update the overview section if it references "future" Phase 3 implementation.
  </action>
  <verify>grep "Phase 3.*Implemented" github-integration.md returns match; grep "kata-adding-milestones" github-integration.md returns match for Phase 3</verify>
  <done>github-integration.md updated with Phase 3 implementation details</done>
</task>

</tasks>

<verification>
- [ ] Test file contains "Phase Issue Creation" describe block
- [ ] Test covers issueMode check
- [ ] Test covers label creation
- [ ] Test covers milestone lookup
- [ ] Test covers ROADMAP parsing
- [ ] Test covers idempotent existence check
- [ ] Test covers --body-file pattern
- [ ] All tests pass
- [ ] github-integration.md shows Phase 3 as implemented
- [ ] github-integration.md references kata-adding-milestones for Phase 3
</verification>

<success_criteria>
1. Tests pass for phase issue creation patterns
2. Integration documentation reflects current implementation
3. All Phase 3 requirements (GHI-01, GHI-02, GHI-03) documented and tested
</success_criteria>

<output>
After completion, create `.planning/phases/03-phase-issues/03-02-SUMMARY.md`
</output>

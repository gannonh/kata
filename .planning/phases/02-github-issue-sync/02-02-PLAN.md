---
phase: 02-github-issue-sync
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/check-issues/SKILL.md
autonomous: true

must_haves:
  truths:
    - "check-issues displays both local and GitHub backlog issues in unified view"
    - "User can filter by label (area or GitHub label)"
    - "Pulled GitHub Issues get local files with provenance"
    - "Duplicate detection prevents double-counting issues that exist both locally and in GitHub"
  artifacts:
    - path: "skills/check-issues/SKILL.md"
      provides: "Unified issue display from local and GitHub sources"
      contains: "gh issue list"
  key_links:
    - from: "skills/check-issues/SKILL.md"
      to: "gh CLI"
      via: "gh issue list --label backlog"
      pattern: "gh issue list.*--label.*backlog"
---

<objective>
Add GitHub Issue pull capability to the check-issues skill when `github.enabled=true`.

Purpose: Users see a unified view of all issues regardless of source (local files or GitHub). They can pull GitHub Issues into Kata workflow by selecting them, which creates local files with provenance tracking.

Output: Modified check-issues skill that queries both local and GitHub sources with deduplication.
</objective>

<execution_context>
<!-- Executor agent has built-in instructions for plan execution and summary creation -->
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-github-issue-sync/02-RESEARCH.md
@skills/check-issues/SKILL.md
@skills/execute-phase/references/github-integration.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add GitHub issue query step</name>
  <files>skills/check-issues/SKILL.md</files>
  <action>
Modify the `list_issues` step to include GitHub Issues in the display.

BEFORE the existing local file loop, add:

1. Check github.enabled config:
```bash
GITHUB_ENABLED=$(cat .planning/config.json 2>/dev/null | grep -o '"enabled"[[:space:]]*:[[:space:]]*[^,}]*' | head -1 | grep -o 'true\|false' || echo "false")
```

2. If `GITHUB_ENABLED=true`:
   - Query GitHub Issues with backlog label:
   ```bash
   gh issue list --label "backlog" --state open --json number,title,createdAt,labels --jq '.[] | "\(.createdAt)|\(.title)|github|\(.number)"'
   ```
   - Store results for later merge

3. Build dedupe list from local files' provenance fields:
```bash
# Get all GitHub issue numbers already tracked locally
LOCAL_PROVENANCE=$(grep -h "^provenance: github:" .planning/issues/open/*.md 2>/dev/null | grep -oE '#[0-9]+' | tr -d '#' | sort -u)
```

4. Merge results:
   - Local issues display as-is (with their area)
   - GitHub-only issues (not in LOCAL_PROVENANCE) display with source indicator `[GH]`
   - Display format: `1. Add auth token refresh (api, 2d ago)` vs `1. Fix login bug [GH] (bug, 2d ago)`

The combined list should be sorted by date (most recent first or oldest first - be consistent).
  </action>
  <verify>
Read the updated SKILL.md and verify:
- GitHub config check added
- `gh issue list --label "backlog"` query present
- Deduplication logic using provenance field
- Display distinguishes local vs GitHub-only issues
  </verify>
  <done>
- GitHub issue query added to list_issues step
- Deduplication prevents double-counting
- GitHub-only issues marked with [GH] indicator
  </done>
</task>

<task type="auto">
  <name>Task 2: Add pull-to-local action for GitHub issues</name>
  <files>skills/check-issues/SKILL.md</files>
  <action>
Modify the `execute_action` step to handle GitHub-only issues.

When user selects a GitHub-only issue (one with [GH] indicator):

1. In `load_context` step: fetch full issue details:
```bash
gh issue view $ISSUE_NUMBER --json title,body,createdAt,labels
```

2. In `offer_actions` step: add "Pull to local" option for GitHub-only issues:
```
Use AskUserQuestion:
- header: "Action"
- question: "This is a GitHub Issue. What would you like to do?"
- options:
  - "Pull to local" — create local file for offline work
  - "Work on it now" — pull to local AND move to closed
  - "View on GitHub" — open in browser (gh issue view --web)
  - "Put it back" — return to list
```

3. In `execute_action` step: implement "Pull to local":
```bash
# Create local file from GitHub Issue
timestamp=$(date "+%Y-%m-%dT%H:%M")
date_prefix=$(date "+%Y-%m-%d")
slug=$(echo "$TITLE" | tr '[:upper:]' '[:lower:]' | tr ' ' '-' | tr -cd 'a-z0-9-' | head -c 40)
OWNER_REPO=$(gh repo view --json nameWithOwner --jq '.nameWithOwner')

# Write local file
cat > ".planning/issues/open/${date_prefix}-${slug}.md" << EOF
---
created: ${timestamp}
title: ${TITLE}
area: general
provenance: github:${OWNER_REPO}#${ISSUE_NUMBER}
files: []
---

## Problem

${BODY}

## Solution

TBD
EOF
```

The provenance field is critical - it enables deduplication on subsequent checks.
  </action>
  <verify>
Read the updated SKILL.md and verify:
- GitHub issue fetch in load_context for GitHub-only issues
- "Pull to local" action offered for GitHub-only issues
- Local file creation with provenance field
- "View on GitHub" option present
  </verify>
  <done>
- GitHub-only issues can be selected and pulled to local
- Local file created with provenance tracking GitHub reference
- Additional GitHub-specific actions available (View on GitHub)
  </done>
</task>

<task type="auto">
  <name>Task 3: Update success criteria and output</name>
  <files>skills/check-issues/SKILL.md</files>
  <action>
Update the skill metadata to reflect GitHub integration.

1. Update `<output>` section:
```
- Moved issue to `.planning/issues/closed/` (if "Work on it now")
- Created `.planning/issues/open/` file (if "Pull to local" from GitHub)
- Updated `.planning/STATE.md` (if issue count changed)
```

2. Update `<success_criteria>`:
```
- [ ] All open issues listed with title, area, age
- [ ] GitHub backlog issues included (if github.enabled=true)
- [ ] Deduplication applied (local provenance matches GitHub #)
- [ ] GitHub-only issues marked with [GH] indicator
- [ ] Area filter applied if specified
- [ ] Selected issue's full context loaded
- [ ] Roadmap context checked for phase match
- [ ] Appropriate actions offered (Pull to local for GitHub issues)
- [ ] Selected action executed
- [ ] STATE.md updated if issue count changed
- [ ] Changes committed to git (if issue moved to closed/)
```

3. Update description in frontmatter to include GitHub triggers:
Add "github issues", "backlog issues", "pull issues" to the trigger list.
  </action>
  <verify>
Grep for "GitHub" in success_criteria.
Verify description includes GitHub-related triggers.
  </verify>
  <done>
- Output section includes "Pull to local" artifact
- Success criteria includes GitHub integration checks
- Description triggers updated for GitHub vocabulary
  </done>
</task>

</tasks>

<verification>
1. Read `skills/check-issues/SKILL.md` and verify:
   - GitHub config check pattern present
   - `gh issue list --label "backlog"` query present
   - Deduplication logic using provenance field
   - [GH] indicator for GitHub-only issues
   - "Pull to local" action creates file with provenance

2. Verify no old "todo" vocabulary accidentally reintroduced
</verification>

<success_criteria>
- [ ] check-issues queries GitHub Issues when github.enabled=true
- [ ] GitHub Issues with `backlog` label included in unified display
- [ ] Deduplication prevents double-counting (provenance field match)
- [ ] GitHub-only issues marked with [GH] indicator
- [ ] "Pull to local" action creates local file with provenance
- [ ] "View on GitHub" option available for GitHub issues
- [ ] Success criteria and output updated
- [ ] Description triggers updated for GitHub vocabulary
- [ ] No "todo" vocabulary present
</success_criteria>

<output>
After completion, create `.planning/phases/02-github-issue-sync/02-02-SUMMARY.md`
</output>

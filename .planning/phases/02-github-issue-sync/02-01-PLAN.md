---
phase: 02-github-issue-sync
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/add-issue/SKILL.md
autonomous: true

must_haves:
  truths:
    - "Issues created via /kata:add-issue appear as GitHub Issues when github.enabled=true"
    - "GitHub Issues have the 'backlog' label"
    - "Local issue file contains provenance field referencing GitHub issue number"
    - "Non-GitHub projects still create local-only issues"
  artifacts:
    - path: "skills/add-issue/SKILL.md"
      provides: "GitHub sync logic for issue creation"
      contains: "gh issue create"
  key_links:
    - from: "skills/add-issue/SKILL.md"
      to: "gh CLI"
      via: "gh issue create --label backlog"
      pattern: "gh issue create.*--label.*backlog"
---

<objective>
Add GitHub Issue sync to the add-issue skill when `github.enabled=true`.

Purpose: Users in GitHub-enabled projects get automatic GitHub Issue creation with `backlog` label, enabling issue tracking in GitHub while maintaining local file as source of truth.

Output: Modified add-issue skill that conditionally creates GitHub Issues.
</objective>

<execution_context>
<!-- Executor agent has built-in instructions for plan execution and summary creation -->
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-github-issue-sync/02-RESEARCH.md
@skills/add-issue/SKILL.md
@skills/execute-phase/references/github-integration.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add GitHub issue creation step</name>
  <files>skills/add-issue/SKILL.md</files>
  <action>
Add a new step `sync_to_github` AFTER the `create_file` step and BEFORE the `update_state` step.

The step must:

1. Check github.enabled config:
```bash
GITHUB_ENABLED=$(cat .planning/config.json 2>/dev/null | grep -o '"enabled"[[:space:]]*:[[:space:]]*[^,}]*' | head -1 | grep -o 'true\|false' || echo "false")
```

2. If `GITHUB_ENABLED=true`:
   - Create `backlog` label (idempotent): `gh label create "backlog" --description "Kata backlog issues" --force 2>/dev/null`
   - Check if issue already has provenance (skip if already synced)
   - Build issue body file at `/tmp/issue-body.md` with Problem and Solution sections from local file
   - Create GitHub Issue: `gh issue create --title "$TITLE" --body-file /tmp/issue-body.md --label "backlog"`
   - Capture issue number from output
   - Update local file's frontmatter to add `provenance: github:owner/repo#N`
   - Get owner/repo from `gh repo view --json nameWithOwner --jq '.nameWithOwner'`

3. Non-blocking: wrap all GitHub operations in error handling that warns but continues

4. If `GITHUB_ENABLED=false`: skip entirely (log "Local-only issue (GitHub integration disabled)")

Use `--body-file` pattern (not `--body`) to handle special characters safely. Reference existing pattern from execute-phase skill.
  </action>
  <verify>
Read the updated SKILL.md and verify:
- New step `sync_to_github` exists between `create_file` and `update_state`
- Step checks `github.enabled` config
- Uses `gh issue create --label "backlog"` pattern
- Updates provenance field in local file
- Has non-blocking error handling
  </verify>
  <done>
- Step `sync_to_github` added with GitHub Issue creation logic
- Provenance field updated in local file after GitHub sync
- Non-blocking error handling implemented
  </done>
</task>

<task type="auto">
  <name>Task 2: Update success criteria and output</name>
  <files>skills/add-issue/SKILL.md</files>
  <action>
Update the `<output>` section to include GitHub Issue as optional output:
```
- `.planning/issues/open/[date]-[slug].md`
- Updated `.planning/STATE.md` (if exists)
- GitHub Issue #N with `backlog` label (if github.enabled=true)
```

Update `<success_criteria>` to add:
- `- [ ] GitHub Issue created with backlog label (if github.enabled=true)`
- `- [ ] Provenance field set in local file (if GitHub synced)`

Also update the `confirm` step output to show GitHub Issue link when created:
```
Issue saved: .planning/issues/open/[filename]

  [title]
  Area: [area]
  Files: [count] referenced
  GitHub: #[number] (if synced)

---

Would you like to:
...
```
  </action>
  <verify>
Grep for "GitHub Issue" in success_criteria and output sections.
Verify confirm step mentions GitHub issue number.
  </verify>
  <done>
- Output section lists GitHub Issue as conditional output
- Success criteria includes GitHub sync checks
- Confirm step shows GitHub Issue link when synced
  </done>
</task>

</tasks>

<verification>
1. Read `skills/add-issue/SKILL.md` and verify:
   - `sync_to_github` step exists with correct position
   - GitHub config check pattern matches existing codebase patterns
   - `gh issue create --label "backlog"` command present
   - Provenance field update logic present
   - Non-blocking error handling (warnings, not failures)

2. Verify no old "todo" vocabulary accidentally reintroduced
</verification>

<success_criteria>
- [ ] add-issue skill has sync_to_github step
- [ ] Step checks github.enabled config before any GitHub operations
- [ ] GitHub Issues created with `backlog` label
- [ ] Local file provenance field updated with GitHub reference
- [ ] Non-blocking error handling (GitHub failures don't block local workflow)
- [ ] Output and success criteria updated to reflect GitHub sync
- [ ] No "todo" vocabulary present
</success_criteria>

<output>
After completion, create `.planning/phases/02-github-issue-sync/02-01-SUMMARY.md`
</output>

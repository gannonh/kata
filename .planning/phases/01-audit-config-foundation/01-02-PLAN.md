---
phase: 01-audit-config-foundation
plan: 02
type: execute
wave: 2
depends_on: [01-01]
files_modified:
  - skills/kata-milestone-management/SKILL.md
  - skills/kata-execution/SKILL.md
  - skills/kata-project-initialization/SKILL.md
autonomous: true

must_haves:
  truths:
    - "Skills read github config before taking GitHub actions"
    - "Skills branch behavior based on github.enabled value"
    - "Config read pattern uses 2>/dev/null for fallback"
  artifacts:
    - path: "skills/kata-milestone-management/SKILL.md"
      provides: "Conditional GitHub milestone creation hook"
      contains: "github.enabled"
    - path: "skills/kata-execution/SKILL.md"
      provides: "Conditional GitHub PR creation hook"
      contains: "github.enabled"
    - path: "skills/kata-project-initialization/SKILL.md"
      provides: "GitHub config write during onboarding"
      contains: "GitHub Integration"
  key_links:
    - from: "skills/kata-project-initialization/SKILL.md"
      to: ".planning/config.json"
      via: "config write step"
      pattern: "github.*enabled"
    - from: "skills/kata-milestone-management/SKILL.md"
      to: ".planning/config.json"
      via: "config read check"
      pattern: "cat.*config.json.*2>/dev/null"
    - from: "skills/kata-execution/SKILL.md"
      to: ".planning/config.json"
      via: "config read check"
      pattern: "cat.*config.json.*2>/dev/null"
---

<objective>
Add conditional GitHub integration hooks to affected Kata skills.

Purpose: Enable skills to branch behavior based on github.enabled config, preparing them for actual GitHub API calls in later phases.

Output:
- kata-project-initialization: GitHub preference question in Step 5
- kata-milestone-management: Conditional GitHub Milestone step after completion
- kata-execution: Conditional GitHub PR step at milestone completion
</objective>

<execution_context>
@~/.claude/kata/workflows/execute-plan.md
@~/.claude/kata/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-audit-config-foundation/01-RESEARCH.md
@.planning/phases/01-audit-config-foundation/01-INTEGRATION-POINTS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add GitHub config write to kata-project-initialization</name>
  <files>skills/kata-project-initialization/SKILL.md</files>
  <action>
Update Step 5 "Configure Workflow Preferences" to include GitHub integration questions.

After the existing Mode/Depth/Execution questions, add:

```markdown
**GitHub Integration:**
- "Enable GitHub integration (Recommended)" - Sync milestones, issues, PRs to GitHub
- "Disable GitHub integration" - Local planning only

**If enabled, Issue Creation Mode:**
- "Auto" - Create issues automatically when milestones/phases defined
- "Ask" - Prompt before creating each issue
- "Never" - Milestones and PRs only, no issues
```

Update the config.json creation to include github settings based on user choices:
- If enabled: `"github": { "enabled": true, "issueMode": "[chosen]" }`
- If disabled: `"github": { "enabled": false, "issueMode": "ask" }`

Keep all existing Step 5 content intact. Insert GitHub questions after Execution preference.
  </action>
  <verify>
Read skills/kata-project-initialization/SKILL.md and confirm:
1. Step 5 includes "GitHub Integration" question
2. issueMode options documented (Auto/Ask/Never)
3. Config write includes github object
  </verify>
  <done>kata-project-initialization asks about GitHub integration during onboarding and writes to config</done>
</task>

<task type="auto">
  <name>Task 2: Add conditional GitHub hook to kata-milestone-management</name>
  <files>skills/kata-milestone-management/SKILL.md</files>
  <action>
Add Step 11 "GitHub Integration (Conditional)" after Step 10 "Present completion" in the NEW MILESTONE Workflow section.

Insert this conditional step:

```markdown
### Step 11: GitHub Integration (Conditional)

**Read config:**
```bash
cat .planning/config.json 2>/dev/null
```

**If github.enabled = true:**

1. Create GitHub Milestone via gh CLI:
   ```bash
   gh api repos/{owner}/{repo}/milestones --method POST \
     -f title="v[X.Y] [Name]" \
     -f description="[From ROADMAP.md milestone section]"
   ```

2. Store milestone number in STATE.md under `## GitHub State` section

3. Report success in completion output:
   ```
   GitHub Milestone created: #[NUMBER]
   ```

**If github.enabled = false:**
Skip to next step (no GitHub operations).

**Note:** Actual GitHub API implementation deferred to Phase 2. This step documents the hook point and conditional logic pattern.
```

Update Step 10 numbering to account for new step if needed. Keep all existing content intact.
  </action>
  <verify>
Read skills/kata-milestone-management/SKILL.md and confirm:
1. NEW MILESTONE section has GitHub Integration step
2. Config read pattern uses `2>/dev/null`
3. Conditional logic checks github.enabled
4. gh CLI example included (even if deferred)
  </verify>
  <done>kata-milestone-management has conditional GitHub Milestone creation hook after milestone completion</done>
</task>

<task type="auto">
  <name>Task 3: Add conditional GitHub hook to kata-execution</name>
  <files>skills/kata-execution/SKILL.md</files>
  <action>
Update Step 10 "Present Results" to include conditional GitHub PR creation at milestone completion.

In the "If milestone complete" branch, add after the existing content but before the completion message:

```markdown
**GitHub PR Creation (if enabled):**

**Read config:**
```bash
cat .planning/config.json 2>/dev/null
```

**If github.enabled = true AND milestone complete:**

1. Create PR via gh CLI:
   ```bash
   gh pr create \
     --title "Phase [N]: [Phase Name]" \
     --body "$(cat <<'EOF'
   ## Summary
   [From phase SUMMARY.md]

   Closes #[phase_issue_number from STATE.md, if exists]
   EOF
   )"
   ```

2. Present PR URL in completion output:
   ```
   GitHub PR created: [URL]
   ```

**If github.enabled = false:**
Skip GitHub operations.

**Note:** Actual GitHub API implementation deferred to Phase 5. This step documents the hook point and conditional logic pattern.
```

Keep all existing Step 10 content intact. Insert the GitHub section in the milestone complete branch.
  </action>
  <verify>
Read skills/kata-execution/SKILL.md and confirm:
1. Step 10 has GitHub PR section in milestone complete branch
2. Config read pattern uses `2>/dev/null`
3. Conditional logic checks github.enabled
4. gh pr create example included (even if deferred)
  </verify>
  <done>kata-execution has conditional GitHub PR creation hook at milestone completion</done>
</task>

</tasks>

<verification>
Phase 1 Plan 02 verification:

1. **kata-project-initialization has GitHub config:**
   ```bash
   grep -q "GitHub Integration" skills/kata-project-initialization/SKILL.md && echo "PASS"
   ```

2. **kata-milestone-management has conditional hook:**
   ```bash
   grep -q "github.enabled" skills/kata-milestone-management/SKILL.md && echo "PASS"
   ```

3. **kata-execution has conditional hook:**
   ```bash
   grep -q "github.enabled" skills/kata-execution/SKILL.md && echo "PASS"
   ```

4. **All use proper fallback pattern:**
   ```bash
   for skill in skills/kata-{project-initialization,milestone-management,execution}/SKILL.md; do
     grep -q "2>/dev/null" "$skill" && echo "PASS: $skill"
   done
   ```
</verification>

<success_criteria>
- [ ] kata-project-initialization Step 5 asks about GitHub integration
- [ ] kata-project-initialization writes github config to config.json
- [ ] kata-milestone-management has Step 11 for conditional GitHub Milestone
- [ ] kata-milestone-management reads config with fallback (2>/dev/null)
- [ ] kata-execution Step 10 has conditional GitHub PR in milestone complete branch
- [ ] kata-execution reads config with fallback (2>/dev/null)
- [ ] All hooks use consistent conditional pattern (if github.enabled = true)
</success_criteria>

<output>
After completion, create `.planning/phases/01-audit-config-foundation/01-02-SUMMARY.md`
</output>

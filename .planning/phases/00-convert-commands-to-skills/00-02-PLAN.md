---
phase: 00-convert-commands-to-skills
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/kata-execution/SKILL.md
  - skills/kata-execution/references/deviation-rules.md
  - skills/kata-execution/references/checkpoint-protocol.md
  - skills/kata-execution/references/tdd-execution.md
  - skills/kata-execution/references/commit-protocol.md
  - commands/kata/execute-phase.md
  - agents/kata-executor.md
autonomous: true

must_haves:
  truths:
    - "/kata:execute-phase runs plans with wave-based parallel execution"
    - "Claude autonomously invokes kata-execution when asked to execute plans"
    - "kata-executor agent has access to execution skill knowledge"
  artifacts:
    - path: "skills/kata-execution/SKILL.md"
      provides: "Core execution workflow with trigger-focused description"
      min_lines: 150
    - path: "skills/kata-execution/references/deviation-rules.md"
      provides: "Auto-fix rules and permission levels"
      min_lines: 30
    - path: "commands/kata/execute-phase.md"
      provides: "Thin wrapper with skills: kata-execution in frontmatter"
      contains: "skills:"
  key_links:
    - from: "commands/kata/execute-phase.md"
      to: "skills/kata-execution/SKILL.md"
      via: "skills: frontmatter field"
      pattern: "skills:.*kata-execution"
    - from: "agents/kata-executor.md"
      to: "skills/kata-execution"
      via: "skills: frontmatter field"
      pattern: "skills:.*kata-execution"
---

<objective>
Create the kata-execution skill from existing execute-phase command, workflows, and kata-executor agent content.

Purpose: Enable autonomous skill invocation for plan execution while preserving deterministic /kata:execute-phase execution.

Output: skills/kata-execution/ directory with SKILL.md and references/, updated command and agent frontmatter.

**CRITICAL: Skills use FLAT directory naming. Use `skills/kata-execution/` NOT `skills/kata/kata-execution/`**
</objective>

<execution_context>
@~/.claude/kata/workflows/execute-plan.md
@~/.claude/kata/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/00-convert-commands-to-skills/00-RESEARCH.md

Source files to extract from:
@commands/kata/execute-phase.md
@agents/kata-executor.md
@kata/workflows/execute-plan.md
@kata/workflows/execute-phase.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create kata-execution skill structure</name>
  <files>
    skills/kata-execution/SKILL.md,
    skills/kata-execution/references/deviation-rules.md,
    skills/kata-execution/references/checkpoint-protocol.md,
    skills/kata-execution/references/tdd-execution.md,
    skills/kata-execution/references/commit-protocol.md
  </files>
  <action>
    Create skills/kata-execution/ directory structure (FLAT naming, no nested kata/ folder).

    **SKILL.md (~200-300 lines):**
    - Frontmatter: name: kata-execution, description with trigger phrases ("execute plan", "run PLAN.md", "execute phase", "handle checkpoints", "create SUMMARY.md")
    - Extract core workflow from kata-executor.md and execute-plan.md workflow:
      - Execution flow overview (load state, load plan, determine pattern, execute tasks, create summary)
      - Task execution overview
      - Deviation handling summary
      - Checkpoint handling summary
      - State management summary
    - Reference detailed files in references/
    - Keep under 500 lines

    **references/deviation-rules.md:**
    - Extract from kata/references/checkpoints.md and execute-plan.md:
      - Rule 1: Auto-fix bugs without asking
      - Rule 2: Auto-add critical functionality
      - Rule 3: Auto-fix blockers
      - Rule 4: Ask about architectural changes
      - Permission levels and examples

    **references/checkpoint-protocol.md:**
    - Extract from kata/references/checkpoints.md:
      - Checkpoint types (human-verify, decision, human-action)
      - Return formats for checkpoints
      - Continuation patterns

    **references/tdd-execution.md:**
    - Extract from kata/references/tdd.md:
      - RED-GREEN-REFACTOR cycle
      - TDD plan detection
      - TDD commit patterns

    **references/commit-protocol.md:**
    - Extract from kata/references/git-integration.md and execute-plan.md:
      - Per-task atomic commits
      - Commit message format
      - Co-authored-by line
      - SUMMARY.md creation

    Do NOT duplicate content - move it from existing files to skill references.
  </action>
  <verify>
    ls skills/kata-execution/ shows SKILL.md and references/ directory.
    wc -l skills/kata-execution/SKILL.md is between 150-500 lines.
    grep "name: kata-execution" skills/kata-execution/SKILL.md succeeds.
  </verify>
  <done>Skill directory exists with SKILL.md (trigger-focused description) and 4 reference files containing execution domain knowledge.</done>
</task>

<task type="auto">
  <name>Task 2: Update execute-phase command and kata-executor agent</name>
  <files>
    commands/kata/execute-phase.md,
    agents/kata-executor.md
  </files>
  <action>
    **commands/kata/execute-phase.md:**
    - Add `skills: kata-execution` to frontmatter
    - Add `context: fork` to frontmatter
    - Keep orchestrator logic (wave discovery, parallel Task spawning, result aggregation)
    - Add @-reference to skill: `@~/.claude/skills/kata-execution/SKILL.md`
    - Command stays ~300 lines (mostly orchestrator logic)

    **agents/kata-executor.md:**
    - Add `skills: kata-execution` to frontmatter (after tools: line)
    - Remove detailed content that now lives in skill and references
    - Keep: role description, execution_flow steps as summary, structured returns
    - Agent should be ~200-300 lines (down from ~750), referencing skill for details
    - Key content to keep in agent: step names and summaries, NOT full implementations
  </action>
  <verify>
    grep "skills:" commands/kata/execute-phase.md succeeds.
    grep "skills:" agents/kata-executor.md succeeds.
    wc -l agents/kata-executor.md is under 400 lines.
  </verify>
  <done>Command and agent have skills: frontmatter, content deduplicated to skill.</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `ls skills/kata-execution/` shows SKILL.md and references/
2. `grep "skills:" commands/kata/execute-phase.md` succeeds
3. `grep "skills:" agents/kata-executor.md` succeeds
4. Skill has trigger-focused description for autonomous invocation
</verification>

<success_criteria>
- [ ] kata-execution skill exists with SKILL.md + 4 reference files
- [ ] SKILL.md has trigger-focused description for autonomous invocation
- [ ] execute-phase command has skills: kata-execution in frontmatter
- [ ] kata-executor agent has skills: kata-execution in frontmatter
- [ ] Agent content deduplicated (moved to skill)
</success_criteria>

<output>
After completion, create `.planning/phases/00-convert-commands-to-skills/00-02-SUMMARY.md`
</output>

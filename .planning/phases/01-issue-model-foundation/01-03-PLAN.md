---
wave: 2
depends_on:
  - 01-01
  - 01-02
files_modified:
  - skills/adding-issues/SKILL.md
  - skills/checking-issues/SKILL.md
autonomous: true
---

<objective>
Add auto-migration logic that seamlessly converts existing todos to the new issue format on first use. Archive originals to .planning/todos/_archived/.

**Why:** Context decision specifies auto-migration with archive preservation.
</objective>

<tasks>

<task type="auto">
  <name>Task 1: Add migration step to adding-issues</name>
  <files>skills/adding-issues/SKILL.md</files>
  <action>
    Add a `check_and_migrate` step that runs before `ensure_directory`:

    ```markdown
    ## Step 0: Check and Migrate Legacy Todos

    Check if legacy `.planning/todos/` exists and needs migration:

    ```bash
    if [ -d ".planning/todos/pending" ] && [ ! -d ".planning/todos/_archived" ]; then
      # Create new structure
      mkdir -p .planning/issues/open .planning/issues/closed

      # Copy pending todos to open issues
      cp .planning/todos/pending/*.md .planning/issues/open/ 2>/dev/null || true

      # Copy done todos to closed issues
      cp .planning/todos/done/*.md .planning/issues/closed/ 2>/dev/null || true

      # Archive originals
      mkdir -p .planning/todos/_archived
      mv .planning/todos/pending .planning/todos/_archived/ 2>/dev/null || true
      mv .planning/todos/done .planning/todos/_archived/ 2>/dev/null || true

      echo "Migrated todos to issues format"
    fi
    ```

    Migration is idempotent: presence of `_archived/` indicates already migrated.
  </action>
  <verify>grep -c "check_and_migrate\|_archived" skills/adding-issues/SKILL.md</verify>
  <done>Migration step added to adding-issues skill</done>
</task>

<task type="auto">
  <name>Task 2: Add migration step to checking-issues</name>
  <files>skills/checking-issues/SKILL.md</files>
  <action>
    Add the same `check_and_migrate` step before `check_exist`:

    The logic is identical to adding-issues - copy from todos to issues, archive originals.

    This ensures migration happens regardless of which skill user invokes first.
  </action>
  <verify>grep -c "check_and_migrate\|_archived" skills/checking-issues/SKILL.md</verify>
  <done>Migration step added to checking-issues skill</done>
</task>

</tasks>

<must_haves>
- [ ] Existing todos in .planning/todos/pending/ get copied to .planning/issues/open/
- [ ] Original todos archived to .planning/todos/_archived/ (not deleted)
- [ ] Migration runs automatically on first skill invocation
- [ ] Migration is idempotent (doesn't re-migrate if _archived exists)
</must_haves>

<verification>
```bash
# Simulate migration (in test project)
mkdir -p .planning/todos/pending
echo "test" > .planning/todos/pending/test.md
# Then invoke either issue skill and verify:
# - .planning/issues/open/test.md exists
# - .planning/todos/_archived/pending/test.md exists
```
</verification>

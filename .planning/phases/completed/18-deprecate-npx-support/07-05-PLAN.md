---
phase: 07-deprecate-npx-support
plan: 05
type: execute
wave: 3
depends_on: [07-03]
files_modified:
  - bin/install.js
autonomous: true
user_setup:
  - service: npm
    why: "Manual deprecation package publish"
    dashboard_config:
      - task: "Run npm publish manually after bin/install.js replaced"
        location: "Terminal in kata project root"

must_haves:
  truths:
    - "bin/install.js shows deprecation message when run"
    - "NPX users see plugin installation instructions"
    - "Deprecation package exits cleanly (exit 0)"
  artifacts:
    - path: "bin/install.js"
      provides: "Deprecation stub"
      max_lines: 25
      contains: "deprecated"
  key_links: []
---

<objective>
Replace bin/install.js with deprecation stub for final NPM publish.

Purpose: Users running `npx @gannonh/kata` should see a helpful message directing them to plugin installation, not the old installer.

Output: Minimal bin/install.js that displays deprecation message and exits.
</objective>

<execution_context>
Current bin/install.js is 563 lines handling global/local NPX installation.

After this plan, it becomes ~15 lines showing deprecation notice.

The final `npm publish` is a manual step - delete the automated workflow, replace the file, then manually run `npm publish` to release the deprecation package.
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@bin/install.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace bin/install.js with deprecation stub</name>
  <files>bin/install.js</files>
  <action>
Replace the entire contents of bin/install.js with this deprecation stub:

```javascript
#!/usr/bin/env node

console.log(`
\x1b[33m╔═══════════════════════════════════════════════════════════╗
║  Kata NPX installation has been deprecated                ║
╚═══════════════════════════════════════════════════════════╝\x1b[0m

Kata is now distributed exclusively as a Claude Code plugin.

\x1b[1mTo install:\x1b[0m
  1. Start Claude Code: \x1b[36mclaude\x1b[0m
  2. Run: \x1b[36m/plugin install kata@gannonh-kata-marketplace\x1b[0m

For more information: https://github.com/gannonh/kata
`);

process.exit(0);
```

This provides:
- Clear deprecation notice with visual box (amber color)
- Step-by-step plugin installation instructions
- Link to GitHub for more info
- Clean exit (exit 0) so it doesn't appear as error
  </action>
  <verify>
```bash
# Test the deprecation stub
node bin/install.js

# Should display deprecation message and exit cleanly
echo "Exit code: $?"
# Should be 0
```
  </verify>
  <done>bin/install.js replaced with deprecation stub showing plugin installation instructions</done>
</task>

<task type="auto">
  <name>Task 2: Verify package.json bin configuration</name>
  <files>package.json</files>
  <action>
Verify package.json has the bin field configured correctly for npx:

```json
{
  "bin": {
    "kata": "bin/install.js"
  }
}
```

This ensures `npx @gannonh/kata` runs the deprecation stub.

Also verify the "files" array includes "bin" (should be done in 07-03, but double-check):
```json
{
  "files": [
    "bin"
  ]
}
```
  </action>
  <verify>
```bash
# Verify bin configuration
node -p "JSON.stringify(require('./package.json').bin)"
# Should show {"kata":"bin/install.js"}

# Verify files includes bin
node -p "require('./package.json').files"
# Should include "bin"
```
  </verify>
  <done>package.json correctly configured for deprecation package</done>
</task>

</tasks>

<verification>
- [ ] `node bin/install.js` shows deprecation message
- [ ] Exit code is 0
- [ ] Message includes plugin installation instructions
- [ ] package.json bin points to bin/install.js
</verification>

<success_criteria>
1. bin/install.js is minimal deprecation stub (~15 lines)
2. Running stub shows clear deprecation message
3. Message provides plugin installation steps
4. Exit code is 0 (clean exit)
5. package.json configured for npx to run the stub
</success_criteria>

<output>
After completion, create `.planning/phases/07-deprecate-npx-support/07-05-SUMMARY.md`

**IMPORTANT**: After phase completion, manually run `npm publish` to release the deprecation package. This is a one-time manual step replacing the automated publish workflow.
</output>

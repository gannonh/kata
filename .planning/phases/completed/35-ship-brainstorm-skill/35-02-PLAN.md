---
phase: 35-ship-brainstorm-skill
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/kata-brainstorm/SKILL.md
autonomous: true
source_issue: "#99"
must_haves:
  truths:
    - Brainstorm agents receive condensed project context from Kata planning artifacts
    - Context includes PROJECT.md core value, current milestone goals, constraints
    - Context includes ROADMAP.md current milestone phases and progress
    - Context includes open issue titles and areas
    - Context includes STATE.md current position
    - Total context brief is approximately 1300 words
    - Non-Kata projects (no .planning/ directory) fall back to generic context gathering
    - The [CONDENSED PROJECT BRIEF] placeholder in explorer/challenger templates receives the assembled context
  artifacts:
    - skills/kata-brainstorm/SKILL.md (modified)
  key_links:
    - Orchestrator reads and condenses files, then inlines into agent prompts
    - Context assembly happens in Step 1 before agent spawning in Step 4
    - .planning/ directory existence determines Kata vs generic path
---

<objective>
Replace generic context gathering with Kata-aware project brief assembly in kata-brainstorm skill.

Purpose: Brainstorm agents need project context to generate relevant proposals. The current generic "read README" approach misses Kata's structured planning artifacts. Kata-specific context assembly produces a focused brief from PROJECT.md, ROADMAP.md, open issues, and STATE.md that gives agents the strategic framing they need.

Output: Modified SKILL.md Step 1 with Kata-specific context assembly and generic fallback.
</objective>

<execution_context>
<!-- Executor agent has built-in instructions for plan execution and summary creation -->
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/pending/35-ship-brainstorm-skill/35-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace Step 1 context gathering with Kata-aware assembly</name>
  <files>skills/kata-brainstorm/SKILL.md</files>
  <action>
Replace the current Step 1 (Gather Context) section in SKILL.md. The current content (lines 26-36) is a generic list of things to read. Replace with a two-path approach:

**New Step 1: Gather Context**

The step should instruct Claude to:

1. Check if `.planning/` directory exists (bash `[ -d ".planning" ]`)

2. **If Kata project** (`.planning/` exists):

   Read and condense the following into a `PROJECT_BRIEF` variable (target ~1300 words total):

   | Source | What to extract | Target size |
   |--------|----------------|-------------|
   | `.planning/PROJECT.md` | Core value statement, current milestone name and goals, validated requirements (list only), active requirements, constraints | ~500 words |
   | `.planning/ROADMAP.md` | Current milestone section (phases with goals), progress summary table | ~300 words |
   | `.planning/issues/open/*.md` | List of issue titles and areas (one line each, from filenames or first heading) | ~200 words |
   | `.planning/STATE.md` | Current position block, recent decisions (last 3-5) | ~200 words |

   Use the Read tool to read each file, then condense into a single text block. The assembled brief replaces `[CONDENSED PROJECT BRIEF]` in the explorer and challenger prompt templates.

   If any file is missing, skip it (don't fail). The brief should work with partial data.

   For open issues, use bash to list files:
   ```bash
   ls .planning/issues/open/*.md 2>/dev/null | head -20
   ```
   Then read the first few lines of each to extract titles.

3. **If non-Kata project** (no `.planning/` directory):

   Fall back to generic context gathering:
   - Read `README.md` or `README` if it exists
   - Read `package.json` description field if it exists
   - Read any `CHANGELOG.md` or `HISTORY.md` for recent changes
   - Read any roadmap, backlog, or planning files found in the repo root
   - Condense into a project brief

4. The assembled brief (Kata or generic) gets injected into the `[CONDENSED PROJECT BRIEF]` placeholder in the explorer and challenger prompts when spawning agents in Step 4.

Preserve the paragraph after the current Step 1 bullet list that says "Condense this into a context block that every agent receives in their prompt." Update it to reflect the two-path approach.

Do NOT modify Steps 0, 2, 3, 4, 5, 6, the team structure table, prompt templates, customization section, or output structure. Only modify Step 1.
  </action>
  <verify>
Read skills/kata-brainstorm/SKILL.md and verify:
1. Step 1 checks for `.planning/` directory existence
2. Kata path reads PROJECT.md, ROADMAP.md, open issues, and STATE.md with specific extraction targets
3. Each source has a size target documented
4. Generic fallback path reads README, package.json, CHANGELOG
5. Missing files are handled gracefully (skip, don't fail)
6. Brief is described as replacing [CONDENSED PROJECT BRIEF] placeholder
7. All other steps and sections unchanged
  </verify>
  <done>
Step 1 has two paths: Kata-specific artifact assembly (~1300 words from 4 sources) and generic fallback. Both paths produce a project brief for the [CONDENSED PROJECT BRIEF] placeholder. Missing files handled gracefully.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build and validate complete skill</name>
  <files>skills/kata-brainstorm/SKILL.md</files>
  <action>
Run the full build and test suite to validate the complete skill (both Plan 01 and Plan 02 changes):

```bash
npm run build:plugin
npm test
```

Then verify the built skill is complete and coherent:
1. Read `dist/plugin/skills/kata-brainstorm/SKILL.md`
2. Confirm all 7 steps are present and in order (Step 0 through Step 6)
3. Confirm Step 0 has prerequisite check (from Plan 01)
4. Confirm Step 1 has Kata-aware context assembly with fallback (from Plan 02)
5. Confirm Step 3 uses TeamCreate (from Plan 01)
6. Confirm Step 6 uses TeamDelete (from Plan 01)
7. Confirm YAML frontmatter preserved
8. Confirm explorer/challenger prompt templates preserved with [CONDENSED PROJECT BRIEF] placeholder
9. Confirm no `@~/.claude/` references (build validation catches these)

Run smoke test: confirm skill line count is reasonable (original was 171 lines, expect ~250-300 with new content).
  </action>
  <verify>
```bash
# Build succeeds
npm run build:plugin

# Tests pass
npm test

# Built skill has all sections
grep -c "### Step" dist/plugin/skills/kata-brainstorm/SKILL.md  # Should be 7 (Steps 0-6)

# Kata context assembly present
grep -q ".planning/PROJECT.md" dist/plugin/skills/kata-brainstorm/SKILL.md
grep -q "generic" dist/plugin/skills/kata-brainstorm/SKILL.md

# No old references
! grep -q "Teammate" dist/plugin/skills/kata-brainstorm/SKILL.md
! grep -q "@~/.claude/" dist/plugin/skills/kata-brainstorm/SKILL.md

# Line count sanity
wc -l dist/plugin/skills/kata-brainstorm/SKILL.md
```
  </verify>
  <done>
Built skill contains all 7 steps, Kata-aware context assembly, prerequisite check, updated API references. Build and tests pass. No old references remain.
  </done>
</task>

</tasks>

<verification>
1. Step 1 assembles context from Kata planning artifacts when `.planning/` exists
2. Non-Kata projects fall back to generic README/package.json context
3. Context brief targets ~1300 words from 4 Kata sources
4. Missing files don't block context assembly
5. Build output contains the complete updated skill
6. All 7 steps present in correct order
</verification>

<success_criteria>
- [ ] Step 1 checks for `.planning/` directory
- [ ] Kata path reads PROJECT.md, ROADMAP.md, open issues, STATE.md
- [ ] Each source has documented extraction targets and size limits
- [ ] Generic fallback reads README, package.json, CHANGELOG
- [ ] Missing files handled gracefully
- [ ] Build includes complete skill with both Plan 01 and 02 changes
- [ ] Tests pass
- [ ] Line count reasonable (~250-300 lines)
</success_criteria>

<output>
After completion, create `.planning/phases/pending/35-ship-brainstorm-skill/35-02-SUMMARY.md`
</output>

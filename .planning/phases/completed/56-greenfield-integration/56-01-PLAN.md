---
phase: 56-greenfield-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/kata-new-project/scripts/scaffold-intel.cjs
  - skills/kata-new-project/SKILL.md
autonomous: true
must_haves:
  truths:
    - Running /kata-new-project creates .planning/intel/ with index.json, conventions.json, and summary.md
    - Scaffolded index.json uses v2 schema with stats.totalFiles == 0
    - Scaffolded conventions.json uses v2 schema with insufficient_data naming pattern
    - Scaffolded summary.md indicates greenfield project awaiting first phase execution
    - Self-validation in kata-new-project checks .planning/intel/ artifacts exist
  artifacts:
    - skills/kata-new-project/scripts/scaffold-intel.cjs
    - skills/kata-new-project/SKILL.md (modified)
  key_links:
    - scaffold-intel.cjs output matches scan-codebase.cjs v2 schema exactly
    - kata-new-project Phase 4 calls scaffold-intel.cjs after mkdir
    - kata-new-project Phase 6 self-validation includes intel files
---

<objective>
Create the intel scaffolding script and integrate it into kata-new-project so greenfield projects get empty-schema intel files at project creation time.

Purpose: Greenfield projects need `.planning/intel/` with empty v2-schema files so that `kata-execute-phase` step 7.25 can detect them and run a full code scan after the first phase. Without scaffolding, the gate check (`if [ -f ".planning/intel/index.json" ]`) never fires.

Output: New `scaffold-intel.cjs` script + modified `kata-new-project` SKILL.md
</objective>

<execution_context>
<!-- Executor agent has built-in instructions -->
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/pending/56-greenfield-integration/56-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create scaffold-intel.cjs script</name>
  <files>skills/kata-new-project/scripts/scaffold-intel.cjs</files>
  <action>
Create a Node.js CJS script at `skills/kata-new-project/scripts/scaffold-intel.cjs` that writes three empty-schema files to `.planning/intel/`.

The script must:
1. Use the same `resolveProjectRoot()` pattern from `skills/kata-map-codebase/scripts/scan-codebase.cjs` (check `KATA_PROJECT_ROOT` env, then CWD `.planning/`, then CWD `main/.planning/`)
2. Create `.planning/intel/` directory via `fs.mkdirSync(intelDir, { recursive: true })`
3. Write `index.json` with EXACT v2 schema matching scan-codebase.cjs output shape:
   ```json
   {
     "version": 2,
     "generated": "ISO-8601-timestamp",
     "source": "kata-new-project",
     "generatedBy": "scaffold",
     "commitHash": "none",
     "files": {},
     "stats": {
       "totalFiles": 0,
       "byType": {},
       "byLayer": {},
       "byExtension": {}
     }
   }
   ```
4. Write `conventions.json` with EXACT v2 schema:
   ```json
   {
     "version": 2,
     "generated": "ISO-8601-timestamp",
     "commitHash": "none",
     "naming": {
       "exports": {
         "pattern": "insufficient_data",
         "confidence": 0,
         "sampleSize": 0,
         "breakdown": {}
       }
     },
     "directories": {},
     "fileSuffixes": {}
   }
   ```
5. Write `summary.md`:
   ```markdown
   # Codebase Intelligence Summary

   Generated: YYYY-MM-DD | Source: kata-new-project (greenfield scaffold)

   ## Stack
   - Greenfield project — stack will be detected after first phase execution

   ## Architecture
   - No code written yet

   ## Conventions
   - No conventions detected yet

   ## Key Patterns
   - No patterns detected yet

   ## Concerns
   - No concerns yet
   ```
6. Print confirmation: `scaffold-intel.cjs: created .planning/intel/ with empty v2 schema`
7. Use `#!/usr/bin/env node` shebang and `'use strict';`
8. Include `module.exports` of key functions for testability

CRITICAL: The `stats` field names must be camelCase (`totalFiles`, `byType`, `byLayer`, `byExtension`) to match scan-codebase.cjs v2 output. Do NOT use snake_case (`total_files`) which is the v1 format from generate-intel.js.
  </action>
  <verify>
Run `node skills/kata-new-project/scripts/scaffold-intel.cjs` from a temp directory that has `.planning/` created. Verify:
- `.planning/intel/index.json` exists and has `stats.totalFiles === 0`
- `.planning/intel/conventions.json` exists and has `naming.exports.pattern === "insufficient_data"`
- `.planning/intel/summary.md` exists and contains "greenfield scaffold"
  </verify>
  <done>scaffold-intel.cjs creates three v2-compatible empty-schema intel files in .planning/intel/</done>
</task>

<task type="auto">
  <name>Task 2: Wire scaffold-intel.cjs into kata-new-project SKILL.md</name>
  <files>skills/kata-new-project/SKILL.md</files>
  <action>
Modify `skills/kata-new-project/SKILL.md` in three places:

**1. Phase 4 — after the `mkdir -p` command (line ~159) and BEFORE writing PROJECT.md:**

After the existing `mkdir -p .planning/phases/pending .planning/phases/active .planning/phases/completed` block, add:

```bash
# Scaffold empty intel for greenfield progressive capture
node "scripts/scaffold-intel.cjs" 2>/dev/null || echo "Warning: Intel scaffolding skipped"
```

This runs BEFORE PROJECT.md is written and committed, so the intel directory gets created as part of the initial directory setup.

**2. Phase 4 — update the commit command (line ~243) to include intel files:**

Change the `git add` line to also stage the intel files:

```bash
git add .planning/PROJECT.md .planning/phases/pending/.gitkeep .planning/phases/active/.gitkeep .planning/phases/completed/.gitkeep .planning/intel/
```

**3. Phase 6 — update self-validation (line ~693) to check intel files:**

Add three more checks to the validation block:

```bash
[ -f .planning/intel/index.json ] || MISSING="${MISSING}\n- .planning/intel/index.json"
[ -f .planning/intel/conventions.json ] || MISSING="${MISSING}\n- .planning/intel/conventions.json"
[ -f .planning/intel/summary.md ] || MISSING="${MISSING}\n- .planning/intel/summary.md"
```

Also update the `<output>` section and `<success_criteria>` to mention the intel files.

DO NOT change Phase 2 (Brownfield Offer), Phase 3 (Questioning), or Phase 5 (Workflow Preferences). Intel scaffolding is unconditional — both greenfield and brownfield projects get it.
  </action>
  <verify>
Read `skills/kata-new-project/SKILL.md` and confirm:
1. Phase 4 contains `node "scripts/scaffold-intel.cjs"` call after mkdir
2. Phase 4 commit includes `.planning/intel/` in git add
3. Phase 6 validation checks for all three intel files
4. No changes to Phases 2, 3, or 5
  </verify>
  <done>kata-new-project SKILL.md calls scaffold-intel.cjs in Phase 4, stages intel in commit, and validates intel in Phase 6</done>
</task>

</tasks>

<verification>
1. `scaffold-intel.cjs` is syntactically valid: `node -c skills/kata-new-project/scripts/scaffold-intel.cjs`
2. Schema compatibility: index.json output from scaffold-intel.cjs has identical top-level keys as scan-codebase.cjs output (version, generated, source, generatedBy, commitHash, files, stats)
3. Stats field naming: scaffold uses `totalFiles` (camelCase), not `total_files` (snake_case)
4. SKILL.md has no syntax errors in bash blocks
5. The scaffold call uses `2>/dev/null || echo "Warning..."` pattern (non-blocking, matches project style)
</verification>

<success_criteria>
- [ ] scaffold-intel.cjs creates .planning/intel/ with index.json, conventions.json, summary.md
- [ ] index.json follows v2 schema with stats.totalFiles == 0
- [ ] conventions.json follows v2 schema with insufficient_data naming
- [ ] summary.md contains greenfield scaffold text
- [ ] kata-new-project Phase 4 calls scaffold-intel.cjs after directory creation
- [ ] kata-new-project Phase 4 commit stages .planning/intel/
- [ ] kata-new-project Phase 6 validates all three intel files
</success_criteria>

<output>
After completion, create `.planning/phases/pending/56-greenfield-integration/56-01-SUMMARY.md`
</output>

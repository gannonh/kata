---
phase: 33-skills-sh-distribution
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/kata-plan-phase/SKILL.md
  - skills/kata-execute-phase/SKILL.md
  - skills/kata-verify-work/SKILL.md
  - skills/kata-new-project/SKILL.md
  - skills/kata-add-milestone/SKILL.md
  - skills/kata-add-phase/SKILL.md
  - skills/kata-audit-milestone/SKILL.md
  - skills/kata-check-issues/SKILL.md
  - skills/kata-debug/SKILL.md
  - skills/kata-execute-quick-task/SKILL.md
  - skills/kata-migrate-phases/SKILL.md
  - skills/kata-research-phase/SKILL.md
  - skills/kata-track-progress/SKILL.md
  - skills/kata-review-pull-requests/SKILL.md
  - skills/kata-set-profile/SKILL.md
  - skills/kata-resume-work/SKILL.md
  - skills/kata-map-codebase/SKILL.md
  - skills/kata-list-phase-assumptions/SKILL.md
  - skills/kata-configure-settings/SKILL.md
  - skills/kata-discuss-phase/SKILL.md
  - skills/kata-add-issue/SKILL.md
  - skills/kata-whats-new/SKILL.md
  - skills/kata-insert-phase/SKILL.md
  - skills/kata-pause-work/SKILL.md
  - skills/kata-plan-milestone-gaps/SKILL.md
  - skills/kata-remove-phase/SKILL.md
  - skills/kata-complete-milestone/SKILL.md
  - skills/kata-move-phase/SKILL.md
  - tests/build.test.js
autonomous: true
must_haves:
  truths:
    - All 29 SKILL.md files use Agent Skills spec-compliant frontmatter
    - Claude Code runtime loads skills identically after normalization
    - skills-ref validate passes for every skill directory
  artifacts:
    - 28 normalized SKILL.md files (kata-help already compliant)
    - New test in tests/build.test.js validating spec compliance via skills-ref
  key_links:
    - skills/ (all 29 skill directories)
    - tests/build.test.js
---

<objective>
Normalize all SKILL.md frontmatter to Agent Skills spec format and add spec validation to the test suite.

Purpose: The Agent Skills spec (agentskills.io) defines a portable frontmatter format. Kata's SKILL.md files use Claude Code extensions (`user-invocable`, `disable-model-invocation`, YAML list `allowed-tools`) that are unnecessary defaults. Normalizing source files eliminates the need for build-time transformation, letting the same files serve both the Claude Code plugin and skills.sh distribution channels.

Output: All 29 skills pass `skills-ref validate`. Test suite enforces spec compliance.
</objective>

<execution_context>
<!-- Executor agent has built-in instructions for plan execution and summary creation -->
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/pending/33-skills-sh-distribution/33-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Batch-normalize all 28 SKILL.md files to Agent Skills spec format</name>
  <files>skills/*/SKILL.md (all 28 files except kata-help which is already compliant)</files>
  <action>
Write a bash script that normalizes each SKILL.md frontmatter in place. The script must:

1. For each `skills/kata-*/SKILL.md` file (skip `kata-help` since it's already spec-compliant):

   a. **Remove `user-invocable: true`** line. Claude Code defaults to true when absent.

   b. **Remove `disable-model-invocation: false`** line (present in 27 of 28 files). Claude Code defaults to false when absent.

   c. **Remove `context: fork`** line if present (only `kata-review-pull-requests` has this). This is a Claude Code extension not in the spec.

   d. **Convert `allowed-tools` from YAML list to space-delimited string.** Transform:
   ```yaml
   allowed-tools:
     - Read
     - Write
     - Bash
   ```
   Into:
   ```yaml
   allowed-tools: Read Write Bash
   ```
   The tools vary per skill. Extract all list items and join with spaces.

   e. **Clean up resulting blank lines** in frontmatter (collapsed double newlines from removed fields).

2. After all edits, verify no `user-invocable` or `disable-model-invocation` lines remain:
```bash
grep -r "^user-invocable:" skills/*/SKILL.md
grep -r "^disable-model-invocation:" skills/*/SKILL.md
```
Both should return empty.

3. Verify all `allowed-tools` are space-delimited (no YAML list format remains):
```bash
grep -A1 "^allowed-tools:" skills/*/SKILL.md | grep "^  -"
```
Should return empty.

4. Spot-check 3 skills to confirm frontmatter structure:
```bash
head -15 skills/kata-plan-phase/SKILL.md
head -15 skills/kata-execute-phase/SKILL.md
head -15 skills/kata-review-pull-requests/SKILL.md
```

IMPORTANT: Do NOT modify anything below the closing `---` frontmatter delimiter. Only transform the YAML frontmatter block.

IMPORTANT: Preserve the `metadata` block (including `version: "0.1.0"`) as-is. The spec allows arbitrary metadata.

Use `sed` or a targeted script. Do not use a YAML parsing library.
  </action>
  <verify>
```bash
# No user-invocable lines remain
grep -rc "^user-invocable:" skills/*/SKILL.md | grep -v ":0$"
# Should produce no output

# No disable-model-invocation lines remain
grep -rc "^disable-model-invocation:" skills/*/SKILL.md | grep -v ":0$"
# Should produce no output

# No context: fork remains
grep -rc "^context:" skills/*/SKILL.md | grep -v ":0$"
# Should produce no output

# No YAML-list allowed-tools remain
grep -A1 "^allowed-tools:" skills/*/SKILL.md | grep "^.*-  " | wc -l
# Should output: 0

# All 29 skills still have name: and description: fields
ls -d skills/kata-* | wc -l
# Should output: 29

# Build the plugin and run existing tests to confirm nothing broke
npm run build:plugin && npm test
```
  </verify>
  <done>All 28 SKILL.md files normalized. `user-invocable`, `disable-model-invocation`, and `context` fields removed. `allowed-tools` converted to space-delimited strings. Existing tests pass.</done>
</task>

<task type="auto">
  <name>Task 2: Add skills-ref spec validation test to build.test.js</name>
  <files>tests/build.test.js</files>
  <action>
Add a new test describe block `'Agent Skills spec validation'` to `tests/build.test.js` with one test:

**Test: `'all skills pass skills-ref validate'`**

For each skill directory in `skills/`:
1. Run `npx skills-ref validate ./skills/{skill-name}` (the validate command checks SKILL.md frontmatter against the Agent Skills spec)
2. Collect any failures
3. Assert zero failures

Implementation:
```javascript
describe('Agent Skills spec validation', () => {
  test('all skills pass skills-ref validate', () => {
    const skillsDir = path.join(ROOT, 'skills');
    const entries = fs.readdirSync(skillsDir, { withFileTypes: true })
      .filter(e => e.isDirectory() && e.name.startsWith('kata-'));
    const errors = [];

    for (const entry of entries) {
      const skillPath = path.join(skillsDir, entry.name);
      try {
        execSync(`npx skills-ref validate "${skillPath}"`, {
          cwd: ROOT,
          stdio: 'pipe',
          timeout: 30000
        });
      } catch (err) {
        errors.push(`${entry.name}: ${err.stderr?.toString().trim() || err.message}`);
      }
    }

    if (errors.length > 0) {
      assert.fail(`Skills failing spec validation:\n${errors.join('\n')}`);
    }
  });
});
```

After adding the test, run the full test suite:
```bash
npm run build:plugin && npm test
```

If any skills fail validation, fix the frontmatter issue and re-run.
  </action>
  <verify>
```bash
# Run just the new test
node --test --test-reporter spec tests/build.test.js 2>&1 | grep -A2 "Agent Skills spec"
# Should show the test passing

# Run full test suite
npm test
# All tests pass
```
  </verify>
  <done>New `Agent Skills spec validation` test exists in `tests/build.test.js`. All 29 skills pass `skills-ref validate`. Full test suite passes.</done>
</task>

</tasks>

<verification>
- `grep -r "^user-invocable:" skills/` returns empty
- `grep -r "^disable-model-invocation:" skills/` returns empty
- `npm test` passes (including new skills-ref validation test)
- `npm run build:plugin` succeeds
- `npx skills-ref validate skills/kata-plan-phase` exits 0
</verification>

<success_criteria>
- All 29 SKILL.md files have spec-compliant frontmatter (no Claude Code extension fields)
- `allowed-tools` uses space-delimited format in all skills
- `skills-ref validate` passes for every skill directory
- Existing tests continue to pass (Claude Code runtime compatibility preserved)
- New test in build.test.js enforces ongoing spec compliance
</success_criteria>

<output>
After completion, create `.planning/phases/pending/33-skills-sh-distribution/33-01-SUMMARY.md`
</output>

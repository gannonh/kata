---
phase: 02-full-conversion
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/kata-plan-phase/references/phase-researcher-instructions.md
  - skills/kata-plan-phase/references/plan-checker-instructions.md
  - skills/kata-plan-phase/SKILL.md
autonomous: true

must_haves:
  truths:
    - "kata-plan-phase spawns general-purpose subagents for both phase-researcher and plan-checker"
    - "Phase-researcher instructions file contains the full body content from agents/kata-phase-researcher.md (no frontmatter)"
    - "Plan-checker instructions file contains the full body content from agents/kata-plan-checker.md (no frontmatter)"
    - "Both instruction files are read before their respective Task() calls and wrapped in agent-instructions tags"
  artifacts:
    - path: "skills/kata-plan-phase/references/phase-researcher-instructions.md"
      provides: "Phase researcher agent instructions as skill resource"
      min_lines: 640
    - path: "skills/kata-plan-phase/references/plan-checker-instructions.md"
      provides: "Plan checker agent instructions as skill resource"
      min_lines: 740
    - path: "skills/kata-plan-phase/SKILL.md"
      provides: "Updated orchestrator using general-purpose for all subagent calls"
      contains: "subagent_type=\"general-purpose\""
  key_links:
    - from: "skills/kata-plan-phase/SKILL.md"
      to: "skills/kata-plan-phase/references/phase-researcher-instructions.md"
      via: "Read tool call storing content as phase_researcher_instructions_content"
      pattern: "phase-researcher-instructions\\.md"
    - from: "skills/kata-plan-phase/SKILL.md"
      to: "skills/kata-plan-phase/references/plan-checker-instructions.md"
      via: "Read tool call storing content as plan_checker_instructions_content"
      pattern: "plan-checker-instructions\\.md"
---

<objective>
Migrate kata-phase-researcher and kata-plan-checker from custom subagents to skill resources in kata-plan-phase.

Purpose: Converts the 2 remaining custom subagent Task() calls in kata-plan-phase (phase-researcher at line 234, plan-checker at line 475) to general-purpose with inlined instructions. After this plan, kata-plan-phase will have zero custom subagent types.
Output: 2 instruction files + updated SKILL.md
</objective>

<execution_context>
<!-- Executor agent has built-in instructions for plan execution and summary creation -->
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/pending/02-full-conversion/02-RESEARCH.md

Source files:
@agents/kata-phase-researcher.md
@agents/kata-plan-checker.md
@skills/kata-plan-phase/SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract phase-researcher and plan-checker instructions to skill resources</name>
  <files>skills/kata-plan-phase/references/phase-researcher-instructions.md, skills/kata-plan-phase/references/plan-checker-instructions.md</files>
  <action>
**Step A: Create phase-researcher-instructions.md**

Read `agents/kata-phase-researcher.md`. Extract everything AFTER the closing `---` of the YAML frontmatter. The frontmatter block is the content between the first and second `---` markers (includes name, description, tools, color fields). Copy everything after the second `---` verbatim into `skills/kata-plan-phase/references/phase-researcher-instructions.md`.

Do NOT include the frontmatter. Do NOT restructure, rewrite, or improve the content. Verbatim copy of the body.

Verify the new file does NOT start with `---` and does NOT contain `tools:`, `color:`, or `model:` YAML fields.

**Step B: Create plan-checker-instructions.md**

Read `agents/kata-plan-checker.md`. Extract everything AFTER the closing `---` of the YAML frontmatter using the same approach as Step A. Write to `skills/kata-plan-phase/references/plan-checker-instructions.md`.

Same validation: no frontmatter, no YAML fields.
  </action>
  <verify>
1. `head -1 skills/kata-plan-phase/references/phase-researcher-instructions.md` does NOT start with `---`
2. `wc -l skills/kata-plan-phase/references/phase-researcher-instructions.md` shows ~640+ lines
3. `head -1 skills/kata-plan-phase/references/plan-checker-instructions.md` does NOT start with `---`
4. `wc -l skills/kata-plan-phase/references/plan-checker-instructions.md` shows ~740+ lines
  </verify>
  <done>
- phase-researcher-instructions.md exists with full agent body (no frontmatter)
- plan-checker-instructions.md exists with full agent body (no frontmatter)
  </done>
</task>

<task type="auto">
  <name>Task 2: Update kata-plan-phase SKILL.md to inline instructions for phase-researcher and plan-checker</name>
  <files>skills/kata-plan-phase/SKILL.md</files>
  <action>
**Step A: Add Read calls for new instruction files**

In step 7 ("Read Context Files"), where planner instructions are already read (added in POC), add reads for the two new instruction files:

```
- `${SKILL_BASE_DIR}/references/phase-researcher-instructions.md` (required)
- `${SKILL_BASE_DIR}/references/plan-checker-instructions.md` (required)
```

Store as `phase_researcher_instructions_content` and `plan_checker_instructions_content` respectively.

**Step B: Update phase-researcher Task() call (line ~234)**

Current pattern:
```
Task(
  ...
  subagent_type="kata-phase-researcher",
  ...
)
```

Update to:
1. Change `subagent_type="kata-phase-researcher"` to `subagent_type="general-purpose"`
2. Prepend `<agent-instructions>\n{phase_researcher_instructions_content}\n</agent-instructions>\n\n` to the prompt parameter

**Step C: Update plan-checker Task() call (line ~475)**

Current pattern:
```
Task(
  ...
  subagent_type="kata-plan-checker",
  ...
)
```

Update to:
1. Change `subagent_type="kata-plan-checker"` to `subagent_type="general-purpose"`
2. Prepend `<agent-instructions>\n{plan_checker_instructions_content}\n</agent-instructions>\n\n` to the prompt parameter

Do NOT change the already-migrated planner Task() calls (those already use general-purpose from POC). Do NOT change model selection logic.
  </action>
  <verify>
1. `grep -c 'subagent_type="kata-' skills/kata-plan-phase/SKILL.md` returns 0 (zero remaining custom types)
2. `grep -c 'subagent_type="general-purpose"' skills/kata-plan-phase/SKILL.md` returns 4 (2 planner from POC + researcher + checker)
3. `grep -c 'agent-instructions' skills/kata-plan-phase/SKILL.md` returns at least 4
4. `grep 'phase-researcher-instructions.md' skills/kata-plan-phase/SKILL.md` returns at least 1 match
5. `grep 'plan-checker-instructions.md' skills/kata-plan-phase/SKILL.md` returns at least 1 match
6. `npm run build:plugin` succeeds
  </verify>
  <done>
- Zero remaining custom subagent types in kata-plan-phase
- 4 total general-purpose Task() calls (planner x2, researcher x1, checker x1)
- Both new instruction files read and inlined with agent-instructions wrapper
- Build passes
  </done>
</task>

</tasks>

<verification>
- `grep -r 'subagent_type="kata-' skills/kata-plan-phase/` returns empty (no custom types remain)
- `grep -c 'subagent_type="general-purpose"' skills/kata-plan-phase/SKILL.md` returns 4
- `grep -c 'agent-instructions' skills/kata-plan-phase/SKILL.md` returns 4+
- phase-researcher-instructions.md body matches agents/kata-phase-researcher.md body (post-frontmatter)
- plan-checker-instructions.md body matches agents/kata-plan-checker.md body (post-frontmatter)
- `npm run build:plugin` succeeds
</verification>

<success_criteria>
1. `skills/kata-plan-phase/references/phase-researcher-instructions.md` exists with ~640+ lines
2. `skills/kata-plan-phase/references/plan-checker-instructions.md` exists with ~740+ lines
3. Zero remaining `subagent_type="kata-*"` patterns in kata-plan-phase
4. All 4 Task() calls use general-purpose with agent-instructions wrapper
5. Plugin build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/pending/02-full-conversion/02-01-SUMMARY.md`
</output>

---
phase: 02-full-conversion
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/kata-debug/references/debugger-instructions.md
  - skills/kata-debug/SKILL.md
  - skills/kata-execute-quick-task/SKILL.md
  - skills/kata-verify-work/references/verifier-instructions.md
  - skills/kata-track-progress/references/codebase-mapper-instructions.md
autonomous: true

must_haves:
  truths:
    - "kata-debug spawns general-purpose subagents for debugger with inlined instructions"
    - "kata-execute-quick-task uses general-purpose for planner and executor Task() calls"
    - "Verifier, debugger, and codebase-mapper instruction files contain verbatim agent body content"
  artifacts:
    - path: "skills/kata-debug/references/debugger-instructions.md"
      provides: "Debugger agent instructions as skill resource"
      min_lines: 1185
    - path: "skills/kata-debug/SKILL.md"
      provides: "Updated orchestrator using general-purpose for debugger"
      contains: "subagent_type=\"general-purpose\""
    - path: "skills/kata-execute-quick-task/SKILL.md"
      provides: "Updated skill using general-purpose for planner and executor"
      contains: "subagent_type=\"general-purpose\""
    - path: "skills/kata-verify-work/references/verifier-instructions.md"
      provides: "Verifier agent instructions as skill resource"
      min_lines: 760
    - path: "skills/kata-track-progress/references/codebase-mapper-instructions.md"
      provides: "Codebase mapper agent instructions as skill resource"
      min_lines: 720
  key_links:
    - from: "skills/kata-debug/SKILL.md"
      to: "skills/kata-debug/references/debugger-instructions.md"
      via: "Read instruction file before Task() calls"
      pattern: "debugger-instructions\\.md"
---

<objective>
Migrate kata-debugger (in kata-debug), update kata-execute-quick-task, and extract remaining agent instructions (verifier, codebase-mapper).

Purpose: Covers 3 areas missed by the initial REQUIREMENTS mapping:
1. kata-debug skill has 2 Task() calls with `subagent_type="kata-debugger"` that need migration
2. kata-execute-quick-task has Task() calls with `kata-planner` and `kata-executor` that need updating to general-purpose (instructions already exist from POC)
3. kata-verifier and kata-codebase-mapper need file extraction to skill references/ directories for completeness (referenced by skills as documentation, not direct Task() spawns)
Output: 3 instruction files + 2 updated SKILL.md files
</objective>

<execution_context>
<!-- Executor agent has built-in instructions for plan execution and summary creation -->
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/pending/02-full-conversion/02-RESEARCH.md

Source files:
@agents/kata-debugger.md
@agents/kata-verifier.md
@agents/kata-codebase-mapper.md
@skills/kata-debug/SKILL.md
@skills/kata-execute-quick-task/SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract debugger, verifier, and codebase-mapper instructions to skill resources</name>
  <files>skills/kata-debug/references/debugger-instructions.md, skills/kata-verify-work/references/verifier-instructions.md, skills/kata-track-progress/references/codebase-mapper-instructions.md</files>
  <action>
For each agent, extract the body (everything after YAML frontmatter) to the corresponding instruction file. Create references/ directories if they don't exist.

**A: agents/kata-debugger.md → skills/kata-debug/references/debugger-instructions.md**

Read `agents/kata-debugger.md`. Extract everything AFTER the closing `---` of the YAML frontmatter. Copy body verbatim. Create `skills/kata-debug/references/` directory if needed.

**B: agents/kata-verifier.md → skills/kata-verify-work/references/verifier-instructions.md**

Same extraction pattern. The verify-work skill already has a references/ directory.

**C: agents/kata-codebase-mapper.md → skills/kata-track-progress/references/codebase-mapper-instructions.md**

Same extraction pattern. Create `skills/kata-track-progress/references/` directory if needed.

For all 3 files: verify they do NOT start with `---` and do NOT contain `tools:`, `color:`, or `model:` YAML fields.
  </action>
  <verify>
1. `head -1 skills/kata-debug/references/debugger-instructions.md` does NOT start with `---`
2. `wc -l skills/kata-debug/references/debugger-instructions.md` shows ~1185+ lines
3. `head -1 skills/kata-verify-work/references/verifier-instructions.md` does NOT start with `---`
4. `wc -l skills/kata-verify-work/references/verifier-instructions.md` shows ~760+ lines
5. `head -1 skills/kata-track-progress/references/codebase-mapper-instructions.md` does NOT start with `---`
6. `wc -l skills/kata-track-progress/references/codebase-mapper-instructions.md` shows ~720+ lines
  </verify>
  <done>
- 3 instruction files created with full agent body content (no frontmatter)
- debugger-instructions.md in kata-debug/references/
- verifier-instructions.md in kata-verify-work/references/
- codebase-mapper-instructions.md in kata-track-progress/references/
  </done>
</task>

<task type="auto">
  <name>Task 2: Update kata-debug and kata-execute-quick-task to use general-purpose subagents</name>
  <files>skills/kata-debug/SKILL.md, skills/kata-execute-quick-task/SKILL.md</files>
  <action>
**Step A: Update kata-debug SKILL.md**

kata-debug has 2 Task() calls with `subagent_type="kata-debugger"` at lines ~104 and ~157.

1. Add a read instruction before the Task() calls for `references/debugger-instructions.md`, storing as `debugger_instructions_content`
2. For BOTH Task() calls:
   - Change `subagent_type="kata-debugger"` to `subagent_type="general-purpose"`
   - Prepend `<agent-instructions>\n{debugger_instructions_content}\n</agent-instructions>\n\n` to the prompt

Do NOT change model selection logic.

**Step B: Update kata-execute-quick-task SKILL.md**

kata-execute-quick-task has Task() calls with `subagent_type="kata-planner"` (line ~231) and `subagent_type="kata-executor"` (line ~273).

The planner and executor instruction files already exist from POC:
- `skills/kata-plan-phase/references/planner-instructions.md`
- `skills/kata-execute-phase/references/executor-instructions.md`

1. Add read instructions for both instruction files (using absolute paths since these are in OTHER skills' directories):
   - Read planner instructions from kata-plan-phase skill references
   - Read executor instructions from kata-execute-phase skill references
   Store as `planner_instructions_content` and `executor_instructions_content`

2. For the planner Task() call (line ~231):
   - Change `subagent_type="kata-planner"` to `subagent_type="general-purpose"`
   - Prepend `<agent-instructions>\n{planner_instructions_content}\n</agent-instructions>\n\n` to the prompt

3. For the executor Task() call (line ~273):
   - Change `subagent_type="kata-executor"` to `subagent_type="general-purpose"`
   - Prepend `<agent-instructions>\n{executor_instructions_content}\n</agent-instructions>\n\n` to the prompt

Do NOT change model selection logic.
  </action>
  <verify>
1. `grep -c 'subagent_type="kata-' skills/kata-debug/SKILL.md` returns 0
2. `grep -c 'subagent_type="general-purpose"' skills/kata-debug/SKILL.md` returns 2
3. `grep -c 'agent-instructions' skills/kata-debug/SKILL.md` returns at least 2
4. `grep -c 'subagent_type="kata-' skills/kata-execute-quick-task/SKILL.md` returns 0
5. `grep -c 'subagent_type="general-purpose"' skills/kata-execute-quick-task/SKILL.md` returns 2
6. `grep -c 'agent-instructions' skills/kata-execute-quick-task/SKILL.md` returns at least 2
7. `npm run build:plugin` succeeds
  </verify>
  <done>
- kata-debug: Zero custom subagent types, 2 general-purpose Task() calls with inlined debugger instructions
- kata-execute-quick-task: Zero custom subagent types, 2 general-purpose Task() calls with inlined planner/executor instructions
- Build passes
  </done>
</task>

</tasks>

<verification>
- `grep -r 'subagent_type="kata-' skills/kata-debug/` returns empty
- `grep -r 'subagent_type="kata-' skills/kata-execute-quick-task/` returns empty
- All 3 instruction files exist and match agent body content (post-frontmatter)
- `npm run build:plugin` succeeds
</verification>

<success_criteria>
1. debugger-instructions.md, verifier-instructions.md, codebase-mapper-instructions.md all created
2. kata-debug uses general-purpose for both Task() calls
3. kata-execute-quick-task uses general-purpose for both Task() calls
4. Plugin build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/pending/02-full-conversion/02-05-SUMMARY.md`
</output>

---
phase: 36-workflow-integration
plan: 03
type: execute
wave: 2
depends_on: ["02"]
files_modified:
  - skills/kata-plan-phase/SKILL.md
  - skills/kata-plan-phase/references/planner-instructions.md
  - skills/kata-plan-phase/references/phase-researcher-instructions.md
autonomous: true
source_issue: "github:#99"
must_haves:
  truths:
    - kata-plan-phase Step 7 (Read Context Files) reads the latest brainstorm SUMMARY.md if one exists
    - kata-plan-phase Step 8 (Spawn kata-planner) injects brainstorm context into the planner prompt
    - planner-instructions.md gather_phase_context step documents brainstorm SUMMARY.md as a context source
    - phase-researcher-instructions.md Step 1 loads brainstorm SUMMARY.md when available
    - Missing brainstorm SUMMARY.md is handled gracefully (no error, no blocking)
  artifacts:
    - skills/kata-plan-phase/SKILL.md (modified)
    - skills/kata-plan-phase/references/planner-instructions.md (modified)
    - skills/kata-plan-phase/references/phase-researcher-instructions.md (modified)
  key_links:
    - Brainstorm discovery uses ls -dt pattern to find latest timestamped directory
    - SUMMARY.md content is stored as brainstorm_context variable in Step 7
    - brainstorm_context is injected into planning_context section in Step 8 planner prompt
    - Planner instructions reference brainstorm context as an optional input
    - Researcher instructions load brainstorm SUMMARY.md alongside CONTEXT.md and RESEARCH.md
---

<objective>
Wire brainstorm SUMMARY.md output into downstream agents (planner and researcher) as context.

Purpose: When a brainstorm session has run, its SUMMARY.md contains pressure-tested proposals that should inform research and planning. The planner and researcher agents need to see this context to incorporate brainstorm findings into their work.

Output: Modified SKILL.md with brainstorm context reading/injection, updated planner-instructions.md and phase-researcher-instructions.md with brainstorm context loading.
</objective>

<execution_context>
<!-- Executor agent has built-in instructions for plan execution and summary creation -->
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/pending/36-workflow-integration/36-RESEARCH.md
@.planning/phases/pending/36-workflow-integration/36-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add brainstorm context reading and injection to kata-plan-phase</name>
  <files>skills/kata-plan-phase/SKILL.md</files>
  <action>
Two modifications to kata-plan-phase SKILL.md:

**1. Add brainstorm SUMMARY.md reading to Step 7 (Read Context Files)**

In Step 7 ("## 7. Read Context Files"), after the list of files to read (which ends with `references/plan-checker-instructions.md`), add:

```markdown
**Read latest brainstorm SUMMARY.md (if exists):**

```bash
LATEST_BRAINSTORM=$(ls -dt .planning/brainstorms/*/SUMMARY.md 2>/dev/null | head -1)
if [ -n "$LATEST_BRAINSTORM" ]; then
  BRAINSTORM_CONTEXT=$(cat "$LATEST_BRAINSTORM")
fi
```

Store `BRAINSTORM_CONTEXT` for use in Step 8 prompt. If no brainstorm exists, this variable is empty (no error).
```

Add this after the bullet point for `references/plan-checker-instructions.md` and before "Store all content for use in the Task prompt below."

**2. Add brainstorm context to Step 8 planner prompt**

In Step 8 ("## 8. Spawn kata-planner Agent"), find the prompt template that starts with `<planning_context>`. Inside the template, after the section:

```
**Linked Issues (from STATE.md):**
{issue_context_section}
```

Add:

```
**Brainstorm Context (if exists):**
{brainstorm_context}
```

This injects the brainstorm SUMMARY.md content into the planner's prompt. If no brainstorm was run, this section will be empty.

Do NOT modify any other steps or content.
  </action>
  <verify>
Read skills/kata-plan-phase/SKILL.md and verify:
1. Step 7 includes brainstorm SUMMARY.md reading with ls -dt discovery pattern
2. BRAINSTORM_CONTEXT variable is mentioned for storage
3. Step 8 planner prompt includes "Brainstorm Context (if exists):" section with {brainstorm_context}
4. Brainstorm section appears after Linked Issues section in the prompt template
5. All other steps unchanged
  </verify>
  <done>
kata-plan-phase reads latest brainstorm SUMMARY.md in Step 7 and injects it into planner prompt in Step 8. Missing brainstorm handled gracefully.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update planner and researcher instructions with brainstorm context</name>
  <files>skills/kata-plan-phase/references/planner-instructions.md, skills/kata-plan-phase/references/phase-researcher-instructions.md</files>
  <action>
**1. Update planner-instructions.md**

Find the `<step name="gather_phase_context">` section. After the existing context loading (CONTEXT.md, RESEARCH.md, DISCOVERY.md), add brainstorm SUMMARY.md as a context source.

After the line:
```bash
# Read DISCOVERY.md if exists (from mandatory discovery)
cat "${PHASE_DIR}"/*-DISCOVERY.md 2>/dev/null
```

Add:

```bash
# Read latest brainstorm SUMMARY.md if exists (from /kata-brainstorm)
LATEST_BRAINSTORM=$(ls -dt .planning/brainstorms/*/SUMMARY.md 2>/dev/null | head -1)
[ -n "$LATEST_BRAINSTORM" ] && cat "$LATEST_BRAINSTORM"
```

Also, after the paragraph about RESEARCH.md:

```
**If RESEARCH.md exists:** Use standard_stack, architecture_patterns, dont_hand_roll, common_pitfalls. Research has already identified the right tools.
```

Add:

```
**If brainstorm SUMMARY.md exists:** Incorporate pressure-tested proposals into plan structure. Brainstorm output contains ideas that survived explorer/challenger debate. Use as additional context alongside research.
```

**2. Update phase-researcher-instructions.md**

Find the `## Step 1: Receive Research Scope and Load Context` section. After the existing context loading that reads CONTEXT.md:

```bash
# Read CONTEXT.md if exists (from /kata-discuss-phase)
cat "${PHASE_DIR}"/*-CONTEXT.md 2>/dev/null
```

Add:

```bash
# Read latest brainstorm SUMMARY.md if exists (from /kata-brainstorm)
LATEST_BRAINSTORM=$(ls -dt .planning/brainstorms/*/SUMMARY.md 2>/dev/null | head -1)
[ -n "$LATEST_BRAINSTORM" ] && cat "$LATEST_BRAINSTORM"
```

And in the constraint table that follows, add a new row after the CONTEXT.md rows:

```
| **Brainstorm SUMMARY.md** | Pressure-tested proposals from explorer/challenger session. Use as additional context to inform research scope and recommendations. |
```

Do NOT modify any other content in either file.
  </action>
  <verify>
Read both files and verify:

planner-instructions.md:
1. gather_phase_context step includes brainstorm SUMMARY.md reading with ls -dt pattern
2. Guidance paragraph for brainstorm context exists after RESEARCH.md guidance
3. No other changes

phase-researcher-instructions.md:
1. Step 1 includes brainstorm SUMMARY.md reading with ls -dt pattern
2. Constraint table includes brainstorm SUMMARY.md row
3. No other changes
  </verify>
  <done>
planner-instructions.md and phase-researcher-instructions.md both load brainstorm SUMMARY.md as optional context. Planner uses proposals to inform plan structure. Researcher uses proposals to inform research scope.
  </done>
</task>

</tasks>

<verification>
1. kata-plan-phase reads brainstorm SUMMARY.md in Step 7 using ls -dt discovery
2. Brainstorm context injected into planner prompt in Step 8
3. planner-instructions.md documents brainstorm as context source in gather_phase_context
4. phase-researcher-instructions.md loads brainstorm in Step 1
5. All brainstorm loading is optional (missing files handled gracefully)
6. Build succeeds with all modifications
</verification>

<success_criteria>
- [ ] kata-plan-phase Step 7 reads brainstorm SUMMARY.md
- [ ] kata-plan-phase Step 8 injects brainstorm context into planner prompt
- [ ] planner-instructions.md references brainstorm in gather_phase_context
- [ ] phase-researcher-instructions.md loads brainstorm in Step 1
- [ ] Missing brainstorm SUMMARY.md causes no errors
- [ ] Build succeeds: npm run build:plugin && npm test
</success_criteria>

<output>
After completion, create `.planning/phases/pending/36-workflow-integration/36-03-SUMMARY.md`
</output>

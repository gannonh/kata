---
phase: 02-full-conversion
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/kata-add-milestone/references/project-researcher-instructions.md
  - skills/kata-add-milestone/references/research-synthesizer-instructions.md
  - skills/kata-add-milestone/references/roadmapper-instructions.md
  - skills/kata-add-milestone/SKILL.md
autonomous: true

must_haves:
  truths:
    - "kata-add-milestone spawns general-purpose subagents for project-researcher, research-synthesizer, and roadmapper"
    - "All 3 instruction files contain verbatim agent body content (no frontmatter)"
    - "All 7 Task() calls in kata-add-milestone use general-purpose with agent-instructions wrapper"
  artifacts:
    - path: "skills/kata-add-milestone/references/project-researcher-instructions.md"
      provides: "Project researcher agent instructions as skill resource"
      min_lines: 850
    - path: "skills/kata-add-milestone/references/research-synthesizer-instructions.md"
      provides: "Research synthesizer agent instructions as skill resource"
      min_lines: 240
    - path: "skills/kata-add-milestone/references/roadmapper-instructions.md"
      provides: "Roadmapper agent instructions as skill resource"
      min_lines: 590
    - path: "skills/kata-add-milestone/SKILL.md"
      provides: "Updated orchestrator using general-purpose for all subagent calls"
      contains: "subagent_type=\"general-purpose\""
  key_links:
    - from: "skills/kata-add-milestone/SKILL.md"
      to: "skills/kata-add-milestone/references/project-researcher-instructions.md"
      via: "Read tool call storing as project_researcher_instructions_content"
      pattern: "project-researcher-instructions\\.md"
    - from: "skills/kata-add-milestone/SKILL.md"
      to: "skills/kata-add-milestone/references/research-synthesizer-instructions.md"
      via: "Read tool call storing as research_synthesizer_instructions_content"
      pattern: "research-synthesizer-instructions\\.md"
    - from: "skills/kata-add-milestone/SKILL.md"
      to: "skills/kata-add-milestone/references/roadmapper-instructions.md"
      via: "Read tool call storing as roadmapper_instructions_content"
      pattern: "roadmapper-instructions\\.md"
---

<objective>
Migrate kata-project-researcher, kata-research-synthesizer, and kata-roadmapper from custom subagents to skill resources in kata-add-milestone.

Purpose: kata-add-milestone has the highest agent count (3 agents, 7 Task() calls). All 3 agents are migrated to kata-add-milestone/references/ as the canonical location. kata-new-project also lists these agents in its model profile table but does NOT spawn them via Task().
Output: 3 instruction files + updated SKILL.md
</objective>

<execution_context>
<!-- Executor agent has built-in instructions for plan execution and summary creation -->
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/pending/02-full-conversion/02-RESEARCH.md

Source files:
@agents/kata-project-researcher.md
@agents/kata-research-synthesizer.md
@agents/kata-roadmapper.md
@skills/kata-add-milestone/SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract 3 agent instructions to kata-add-milestone skill resources</name>
  <files>skills/kata-add-milestone/references/project-researcher-instructions.md, skills/kata-add-milestone/references/research-synthesizer-instructions.md, skills/kata-add-milestone/references/roadmapper-instructions.md</files>
  <action>
For each of the 3 agents, extract the body (everything after YAML frontmatter) to the corresponding instruction file:

**A: agents/kata-project-researcher.md → skills/kata-add-milestone/references/project-researcher-instructions.md**

Read `agents/kata-project-researcher.md`. Extract everything AFTER the closing `---` of the YAML frontmatter. Copy body verbatim. Do NOT include frontmatter. Do NOT restructure content.

**B: agents/kata-research-synthesizer.md → skills/kata-add-milestone/references/research-synthesizer-instructions.md**

Same extraction pattern.

**C: agents/kata-roadmapper.md → skills/kata-add-milestone/references/roadmapper-instructions.md**

Same extraction pattern.

For all 3 files: verify they do NOT start with `---` and do NOT contain `tools:`, `color:`, or `model:` YAML fields.
  </action>
  <verify>
1. `head -1 skills/kata-add-milestone/references/project-researcher-instructions.md` does NOT start with `---`
2. `wc -l skills/kata-add-milestone/references/project-researcher-instructions.md` shows ~850+ lines
3. `head -1 skills/kata-add-milestone/references/research-synthesizer-instructions.md` does NOT start with `---`
4. `wc -l skills/kata-add-milestone/references/research-synthesizer-instructions.md` shows ~240+ lines
5. `head -1 skills/kata-add-milestone/references/roadmapper-instructions.md` does NOT start with `---`
6. `wc -l skills/kata-add-milestone/references/roadmapper-instructions.md` shows ~590+ lines
  </verify>
  <done>
- 3 instruction files created with full agent body content (no frontmatter)
- project-researcher-instructions.md ~850+ lines
- research-synthesizer-instructions.md ~240+ lines
- roadmapper-instructions.md ~590+ lines
  </done>
</task>

<task type="auto">
  <name>Task 2: Update kata-add-milestone SKILL.md to inline all 3 agent instructions</name>
  <files>skills/kata-add-milestone/SKILL.md</files>
  <action>
**Step A: Add Read calls for instruction files**

Before the research agent spawn section, add reads for all 3 instruction files:

```
Read `references/project-researcher-instructions.md` → store as `project_researcher_instructions_content`
Read `references/research-synthesizer-instructions.md` → store as `research_synthesizer_instructions_content`
Read `references/roadmapper-instructions.md` → store as `roadmapper_instructions_content`
```

Use `${SKILL_BASE_DIR}/references/` path pattern consistent with POC.

**Step B: Update 4 project-researcher Task() calls (lines ~318, ~359, ~401, ~439)**

Each currently has `subagent_type="kata-project-researcher"`. For each:
1. Change `subagent_type="kata-project-researcher"` to `subagent_type="general-purpose"`
2. Prepend `<agent-instructions>\n{project_researcher_instructions_content}\n</agent-instructions>\n\n` to the prompt

**Step C: Update research-synthesizer Task() call (line ~463)**

1. Change `subagent_type="kata-research-synthesizer"` to `subagent_type="general-purpose"`
2. Prepend `<agent-instructions>\n{research_synthesizer_instructions_content}\n</agent-instructions>\n\n` to the prompt

**Step D: Update 2 roadmapper Task() calls (lines ~763, ~830)**

1. Change `subagent_type="kata-roadmapper"` to `subagent_type="general-purpose"`
2. Prepend `<agent-instructions>\n{roadmapper_instructions_content}\n</agent-instructions>\n\n` to the prompt

Do NOT change model selection logic. Do NOT change the model profile lookup table.
  </action>
  <verify>
1. `grep -c 'subagent_type="kata-' skills/kata-add-milestone/SKILL.md` returns 0
2. `grep -c 'subagent_type="general-purpose"' skills/kata-add-milestone/SKILL.md` returns 7
3. `grep -c 'agent-instructions' skills/kata-add-milestone/SKILL.md` returns at least 7
4. `grep 'project-researcher-instructions.md' skills/kata-add-milestone/SKILL.md` returns at least 1 match
5. `grep 'research-synthesizer-instructions.md' skills/kata-add-milestone/SKILL.md` returns at least 1 match
6. `grep 'roadmapper-instructions.md' skills/kata-add-milestone/SKILL.md` returns at least 1 match
7. `npm run build:plugin` succeeds
  </verify>
  <done>
- Zero remaining custom subagent types in kata-add-milestone
- 7 total general-purpose Task() calls (researcher x4, synthesizer x1, roadmapper x2)
- All instruction files read and inlined with agent-instructions wrapper
- Build passes
  </done>
</task>

</tasks>

<verification>
- `grep -r 'subagent_type="kata-' skills/kata-add-milestone/` returns empty
- `grep -c 'subagent_type="general-purpose"' skills/kata-add-milestone/SKILL.md` returns 7
- All 3 instruction files exist and match agent body content (post-frontmatter)
- `npm run build:plugin` succeeds
</verification>

<success_criteria>
1. 3 instruction files created in skills/kata-add-milestone/references/
2. Zero remaining `subagent_type="kata-*"` patterns in kata-add-milestone
3. All 7 Task() calls use general-purpose with agent-instructions wrapper
4. Plugin build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/pending/02-full-conversion/02-02-SUMMARY.md`
</output>

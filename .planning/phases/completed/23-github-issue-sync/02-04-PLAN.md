---
phase: 02-github-issue-sync
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/check-issues/SKILL.md
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "When 'Work on it now' is used on an issue with GitHub provenance, in-progress label is added to GitHub Issue"
    - "backlog label remains on GitHub Issue when in-progress label is added"
    - "in-progress label is created idempotently if it doesn't exist"
  artifacts:
    - path: "skills/check-issues/SKILL.md"
      provides: "GitHub label sync on work start"
      contains: "gh issue edit.*add-label.*in-progress"
  key_links:
    - from: "skills/check-issues/SKILL.md"
      to: "GitHub Issue"
      via: "gh issue edit --add-label"
      pattern: 'gh issue edit.*--add-label "in-progress"'
---

<objective>
Add GitHub `in-progress` label when "Work on it now" is used on an issue with GitHub provenance.

Purpose: Complete bidirectional sync - issue state changes should reflect in GitHub labels, not just local directory structure.
Output: Updated check-issues skill that adds `in-progress` label to GitHub Issues when starting work.
</objective>

<execution_context>
Gap closure for UAT finding:
- UAT test 7 passed (local file moved correctly)
- Enhancement request: GitHub label should also update
- Design: Keep `backlog` label, ADD `in-progress` label
</execution_context>

<context>
@.planning/phases/02-github-issue-sync/02-UAT.md
@skills/check-issues/SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add in-progress label sync to check-issues skill</name>
  <files>skills/check-issues/SKILL.md</files>
  <action>
Modify the `execute_action` step in skills/check-issues/SKILL.md.

**Path 1: Work on it now (open local issue)** — around line 315-335

Find the section starting with `**Work on it now (open local issue):**`.
After the `mv` command (line ~318), add GitHub label update logic:

```bash
mv ".planning/issues/open/[filename]" ".planning/issues/in-progress/"

# Add in-progress label to GitHub Issue if linked
PROVENANCE=$(grep "^provenance:" ".planning/issues/in-progress/[filename]" | cut -d' ' -f2)
if echo "$PROVENANCE" | grep -q "^github:"; then
  ISSUE_NUMBER=$(echo "$PROVENANCE" | grep -oE '#[0-9]+' | tr -d '#')

  if [ -n "$ISSUE_NUMBER" ]; then
    GITHUB_ENABLED=$(cat .planning/config.json 2>/dev/null | grep -o '"enabled"[[:space:]]*:[[:space:]]*[^,}]*' | head -1 | grep -o 'true\|false' || echo "false")

    if [ "$GITHUB_ENABLED" = "true" ]; then
      # Create in-progress label idempotently (ignore error if exists)
      gh label create "in-progress" --description "Issue is actively being worked on" --color "FFA500" 2>/dev/null || true

      # Add in-progress label (keeps backlog label)
      gh issue edit "$ISSUE_NUMBER" --add-label "in-progress" 2>/dev/null \
        && echo "Added in-progress label to GitHub Issue #${ISSUE_NUMBER}" \
        || echo "Warning: Failed to add in-progress label to GitHub Issue #${ISSUE_NUMBER}"
    fi
  fi
fi
```

**Path 2: Work on it now (GitHub-only issue)** — around line 337-356

Find the section starting with `**Work on it now (GitHub-only issue):**`.
This section first pulls the issue to local, then moves to in-progress.
Insert the label logic AFTER the move but BEFORE the confirmation display.

Current structure (lines ~337-356):
```
**Work on it now (GitHub-only issue):**
First execute "Pull to local" action, then move to in-progress:
```bash
mv ".planning/issues/open/${date_prefix}-${slug}.md" ".planning/issues/in-progress/"
```

Display confirmation:
...
```

Update to:
```
**Work on it now (GitHub-only issue):**
First execute "Pull to local" action, then move to in-progress and sync GitHub label:
```bash
mv ".planning/issues/open/${date_prefix}-${slug}.md" ".planning/issues/in-progress/"

# Add in-progress label to GitHub Issue (we know it's GitHub-linked since this is the GitHub-only path)
GITHUB_ENABLED=$(cat .planning/config.json 2>/dev/null | grep -o '"enabled"[[:space:]]*:[[:space:]]*[^,}]*' | head -1 | grep -o 'true\|false' || echo "false")

if [ "$GITHUB_ENABLED" = "true" ]; then
  # Create in-progress label idempotently (ignore error if exists)
  gh label create "in-progress" --description "Issue is actively being worked on" --color "FFA500" 2>/dev/null || true

  # Add in-progress label (keeps backlog label)
  # Note: $ISSUE_NUMBER is already available from the pull-to-local step
  gh issue edit "$ISSUE_NUMBER" --add-label "in-progress" 2>/dev/null \
    && echo "Added in-progress label to GitHub Issue #${ISSUE_NUMBER}" \
    || echo "Warning: Failed to add in-progress label to GitHub Issue #${ISSUE_NUMBER}"
fi
```

Display confirmation:
...
```

**Both paths: Update confirmation display** to show label status:
```
Issue moved to in-progress: [filename]

  [title]
  Area: [area]
  GitHub: Linked to #[number], added in-progress label
          -or- Not linked (if no provenance)
```

**Update success_criteria checklist** (around line 545-559) to include:
- [ ] "Work on it now" adds in-progress label to GitHub Issue (if linked)
  </action>
  <verify>
1. Read skills/check-issues/SKILL.md
2. Verify `gh label create "in-progress"` appears in BOTH "Work on it now" sections
3. Verify `gh issue edit.*--add-label "in-progress"` pattern exists in BOTH sections
4. Verify confirmation messages mention label status
  </verify>
  <done>
- "Work on it now" action includes idempotent label creation
- "Work on it now" action adds in-progress label via gh issue edit
- Both local issue and GitHub-only issue paths have explicit label logic bash blocks
- Confirmation output mentions label update status
  </done>
</task>

</tasks>

<verification>
After implementation:
1. Check skill file contains `gh label create "in-progress"` command in both paths
2. Check skill file contains `gh issue edit "$ISSUE_NUMBER" --add-label "in-progress"` command in both paths
3. Verify pattern exists for both open local and GitHub-only issue paths
</verification>

<success_criteria>
- [ ] skills/check-issues/SKILL.md updated with in-progress label logic
- [ ] Label created idempotently (gh label create ... || true)
- [ ] Label added with gh issue edit --add-label
- [ ] Both work-on-it paths (local and GitHub-only) include explicit bash code for label sync
- [ ] Confirmation messages updated to show label status
</success_criteria>

<output>
After completion, create `.planning/phases/02-github-issue-sync/02-04-SUMMARY.md`
</output>

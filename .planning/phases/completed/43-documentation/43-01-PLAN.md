---
phase: 43-documentation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - README.md
  - .docs/TEMPLATE-CUSTOMIZATION.md
autonomous: true
source_issue: ""

must_haves:
  truths:
    - "README.md 'What's New' section updated from v1.8.0 to v1.9.0 with template customization highlights"
    - "README.md has a 'Template Customization' section between 'Configuration' and 'Why It Works' sections"
    - "README.md template customization section lists all 5 customizable templates with names, owning skills, and descriptions"
    - "README.md template customization section includes an example workflow showing list, copy, edit, validate operations"
    - "README.md template customization section mentions .planning/templates/ as the override location"
    - ".docs/TEMPLATE-CUSTOMIZATION.md exists with template schema documentation"
    - ".docs/TEMPLATE-CUSTOMIZATION.md documents required and optional fields for all 5 templates (summary-template.md, plan-template.md, UAT-template.md, verification-report.md, changelog-entry.md)"
    - ".docs/TEMPLATE-CUSTOMIZATION.md includes a migration guide section explaining the transition from SessionStart hooks to skills-based validation"
    - "Migration guide explains that hooks/ directory was removed and validation now runs as pre-flight checks inside skills"
    - "Migration guide lists the 5 skills that run validation pre-flight: kata-execute-phase, kata-plan-phase, kata-complete-milestone, kata-add-milestone, kata-verify-work"
  artifacts:
    - README.md
    - .docs/TEMPLATE-CUSTOMIZATION.md
  key_links:
    - "README.md template list matches the 5 templates discovered by list-templates.sh"
    - "Schema documentation matches the kata-template-schema comments in each template file"
    - "Migration guide references check-config.sh and check-template-drift.sh in kata-doctor/scripts/"
---

<objective>
Document template customization for users. Update README with feature overview and example workflow. Create a detailed reference doc with template schemas and migration guide.

Purpose: Complete DOCS-01 through DOCS-05, giving users clear instructions for customizing templates and understanding the validation architecture.
Output: Updated README.md, new .docs/TEMPLATE-CUSTOMIZATION.md.
</objective>

<execution_context>
<!-- Executor agent has built-in instructions for plan execution and summary creation -->
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@README.md
@skills/kata-customize-template/SKILL.md
@skills/kata-execute-phase/scripts/resolve-template.sh
@skills/kata-doctor/scripts/check-template-drift.sh
@skills/kata-execute-phase/references/summary-template.md
@skills/kata-plan-phase/references/plan-template.md
@skills/kata-verify-work/references/UAT-template.md
@skills/kata-verify-work/references/verification-report.md
@skills/kata-complete-milestone/references/changelog-entry.md
@.planning/phases/completed/41-validation-migration/41-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update README with template customization section and v1.9.0 What's New</name>
  <files>README.md</files>
  <action>
Two edits to README.md:

**Edit A: Update "What's New" section**

Change `## What's New in v1.8.0` to `## What's New in v1.9.0`.

Replace the v1.8.0 content with v1.9.0 highlights:

```markdown
## What's New in v1.9.0

**Template Overrides (Universal)** — Customize how Kata generates planning artifacts:
- **Template customization** — `/kata-customize-template` to list, copy, edit, and validate template overrides
- **Universal resolution** — Templates resolve via sibling discovery, working identically for plugin and skills-only users
- **Schema validation** — Required field checks run as pre-flight in skills (no SessionStart hooks)
- **5 customizable templates** — Plans, summaries, UAT sessions, verification reports, changelogs
```

Move the existing v1.8.0 content into a `<details>` block below the new v1.9.0 section, matching the pattern of v1.7.0 and earlier.

**Edit B: Add Template Customization section**

Insert a new `## Template Customization` section after the `## Configuration` section (before `---` that precedes `## Why It Works`).

Content:

```markdown
## Template Customization

Templates control the structure of planning artifacts. Override any template to change how Kata generates files for your project.

### Available Templates

| Template | Skill | Controls |
| --- | --- | --- |
| `summary-template.md` | kata-execute-phase | Phase completion summaries |
| `plan-template.md` | kata-plan-phase | Phase plan structure |
| `UAT-template.md` | kata-verify-work | UAT session format |
| `verification-report.md` | kata-verify-work | Verification report format |
| `changelog-entry.md` | kata-complete-milestone | Changelog entry format |

Overrides live at `.planning/templates/`. When a template override exists, Kata uses it instead of the built-in default.

### Customization Workflow

```
# List available templates and override status
/kata-customize-template list

# Copy a default template for local editing
/kata-customize-template copy summary-template.md

# Edit the override (describe changes in natural language)
/kata-customize-template edit summary-template.md

# Validate all overrides against required schemas
/kata-customize-template validate
```

### Validation

Template overrides are validated automatically during skill execution. If an override is missing required fields, you will see a drift warning. Run `/kata-customize-template validate` to check all overrides, or `/kata-doctor` for a full project health check.

For detailed schema documentation per template, see [Template Customization Reference](.docs/TEMPLATE-CUSTOMIZATION.md).
```

Also add `.planning/templates/` to the Artifact Structure tree. Find the line `├── config.json` in the artifact structure and add after it:
```
├── templates/              # Template overrides (customized output formats)
```

**Do NOT:**
- Change any other README sections
- Remove existing content (only wrap v1.8.0 in details)
  </action>
  <verify>
```bash
# What's New updated to v1.9.0
grep -q "What's New in v1.9.0" README.md && echo "OK: v1.9.0 header" || echo "FAIL"

# v1.8.0 wrapped in details
grep -q "v1.8.0: Adaptive Workflows" README.md && echo "OK: v1.8.0 preserved" || echo "FAIL"

# Template Customization section exists
grep -q "## Template Customization" README.md && echo "OK: section exists" || echo "FAIL"

# All 5 templates listed
grep -q "summary-template.md" README.md && echo "OK" || echo "FAIL: missing summary"
grep -q "plan-template.md" README.md && echo "OK" || echo "FAIL: missing plan"
grep -q "UAT-template.md" README.md && echo "OK" || echo "FAIL: missing UAT"
grep -q "verification-report.md" README.md && echo "OK" || echo "FAIL: missing verification"
grep -q "changelog-entry.md" README.md && echo "OK" || echo "FAIL: missing changelog"

# Example workflow commands present
grep -q "kata-customize-template list" README.md && echo "OK" || echo "FAIL: missing list example"
grep -q "kata-customize-template copy" README.md && echo "OK" || echo "FAIL: missing copy example"
grep -q "kata-customize-template validate" README.md && echo "OK" || echo "FAIL: missing validate example"

# templates/ in artifact structure
grep -q "templates/" README.md && echo "OK: templates/ in structure" || echo "FAIL"
```
  </verify>
  <done>README.md updated with v1.9.0 What's New, template customization section with all 5 templates listed, example workflow, validation info, and templates/ in artifact structure.</done>
</task>

<task type="auto">
  <name>Task 2: Create template schema reference and migration guide</name>
  <files>.docs/TEMPLATE-CUSTOMIZATION.md</files>
  <action>
Create `.docs/TEMPLATE-CUSTOMIZATION.md` combining DOCS-04 (template schema documentation) and DOCS-05 (migration guide).

**Structure:**

```markdown
# Template Customization Reference

## Overview

Kata uses 5 templates to generate planning artifacts. Each template has a schema defined by a `kata-template-schema` HTML comment that declares required and optional fields. Override any template by placing a customized copy at `.planning/templates/{template-name}`.

## Template Schemas

### summary-template.md

**Skill:** kata-execute-phase
**Controls:** Phase completion summaries (`{phase}-{plan}-SUMMARY.md`)

| Field Type | Required | Optional |
| --- | --- | --- |
| Frontmatter | phase, plan, subsystem, tags, duration, completed | requires, provides, affects, tech-stack, key-files, key-decisions, patterns-established |
| Body sections | Performance, Accomplishments, Task Commits, Files Created/Modified, Decisions Made | Deviations from Plan, Issues Encountered, User Setup Required, Next Phase Readiness |

### plan-template.md

**Skill:** kata-plan-phase
**Controls:** Phase plan structure (`{phase}-{plan}-PLAN.md`)

| Field Type | Required | Optional |
| --- | --- | --- |
| Frontmatter | phase, plan, type, wave, depends_on, files_modified, autonomous, must_haves | user_setup, source_issue, gap_closure |
| Body sections | objective, execution_context, context, tasks, verification, success_criteria, output | (none) |

### UAT-template.md

**Skill:** kata-verify-work
**Controls:** UAT session format (`{phase}-UAT.md`)

| Field Type | Required | Optional |
| --- | --- | --- |
| Frontmatter | status, phase, source, started, updated | (none) |
| Body sections | Current Test, Tests, Summary, Gaps | (none) |

### verification-report.md

**Skill:** kata-verify-work
**Controls:** Verification report format (`{phase}-VERIFICATION.md`)

| Field Type | Required | Optional |
| --- | --- | --- |
| Frontmatter | phase, verified, status, score | re_verification, gaps, human_verification |
| Body sections | Goal Achievement, Observable Truths, Required Artifacts, Key Link Verification, Requirements Coverage | Anti-Patterns Found, Human Verification Required, Gaps Summary |

### changelog-entry.md

**Skill:** kata-complete-milestone
**Controls:** Changelog entry format

| Field Type | Required | Optional |
| --- | --- | --- |
| Frontmatter | (none) | (none) |
| Body sections | Added, Fixed, Changed | Deprecated, Removed, Security |

## Schema Format

Templates declare their schema using an HTML comment at the top of the file:

```html
<!-- kata-template-schema
required-fields:
  frontmatter: [field1, field2]
  body: [Section Name 1, Section Name 2]
optional-fields:
  frontmatter: [field3]
  body: [Optional Section]
version: 1
-->
```

**Required fields** must be present in any override. The validation system (`check-template-drift.sh`) checks for:
- Frontmatter fields: `fieldname:` pattern in the YAML frontmatter block
- Body sections: Markdown headings (`## Section Name`) or XML tags (`<section_name>`)

**Optional fields** are recognized by the schema but not enforced during validation.

## How Resolution Works

When a skill needs a template, `resolve-template.sh` checks two locations in order:

1. **Project override:** `.planning/templates/{template-name}` (checked first)
2. **Built-in default:** `skills/kata-*/references/{template-name}` (sibling discovery)

The first match wins. If no file is found at either location, the script exits with an error listing both search paths.

## Validation Architecture

### How Validation Runs

Validation runs as pre-flight checks inside skills, not as SessionStart hooks. Five orchestrator skills run validation before their main process:

| Skill | Config check | Template drift check |
| --- | --- | --- |
| kata-execute-phase | Yes | Yes |
| kata-plan-phase | Yes | Yes |
| kata-complete-milestone | Yes | Yes |
| kata-add-milestone | Yes | No |
| kata-verify-work | Yes | Yes |

`kata-add-milestone` skips template drift checks because it does not resolve templates.

### Validation Scripts

Both scripts live at `skills/kata-doctor/scripts/`:

- **check-config.sh** — Validates `.planning/config.json` against the known key schema (17 keys). Warns on unknown keys and invalid types.
- **check-template-drift.sh** — Scans `.planning/templates/` for overrides, compares each against the `kata-template-schema` comment in the corresponding default template, and reports missing required fields.

Both scripts always exit 0 (warnings only, never blocking).

### On-Demand Validation

- `/kata-customize-template validate` — Runs template drift check and displays results
- `/kata-doctor` — Full project health check including config validation, template drift, and roadmap format

## Migration from Hooks

**v1.9.0 removed the SessionStart hooks system.** Validation that previously ran at session start now runs inside skills.

### What Changed

| Before (v1.8.0) | After (v1.9.0) |
| --- | --- |
| `hooks/kata-config-validator.js` ran at session start | `check-config.sh` runs as pre-flight in 5 skills |
| `hooks/kata-template-drift.js` ran at session start | `check-template-drift.sh` runs as pre-flight in 4 skills |
| Hooks required plugin installation | Scripts use sibling discovery, work everywhere |
| `hooks/hooks.json` registry | No registry needed |

### What Was Removed

- `hooks/hooks.json` (hook registry)
- `hooks/kata-template-drift.js` (SessionStart hook)
- `hooks/kata-config-validator.js` (SessionStart hook)
- `scripts/build-hooks.cjs` (hook build script)

### Impact

- **No action required for users.** The same validations run automatically. The only difference is timing: validation runs when a skill starts instead of when a session starts.
- **Skills-only users get validation.** Previously, hooks only worked for plugin installations. The new scripts work for all installation methods.
```

Read the actual schema comments from the 5 template files to verify the required/optional fields listed above are accurate. If any field lists differ from what is shown above, update to match the actual schema comments.

**Do NOT:**
- Create README.md content (that is Task 1)
- Modify any source files
  </action>
  <verify>
```bash
# File exists
[ -f .docs/TEMPLATE-CUSTOMIZATION.md ] && echo "OK: file exists" || echo "FAIL"

# All 5 templates documented
grep -c "### summary-template.md\|### plan-template.md\|### UAT-template.md\|### verification-report.md\|### changelog-entry.md" .docs/TEMPLATE-CUSTOMIZATION.md

# Migration section exists
grep -q "Migration from Hooks" .docs/TEMPLATE-CUSTOMIZATION.md && echo "OK: migration guide" || echo "FAIL"

# Lists removed files
grep -q "hooks/hooks.json" .docs/TEMPLATE-CUSTOMIZATION.md && echo "OK: lists removed hooks" || echo "FAIL"

# Lists 5 skills with validation
grep -q "kata-execute-phase" .docs/TEMPLATE-CUSTOMIZATION.md && echo "OK" || echo "FAIL"
grep -q "kata-plan-phase" .docs/TEMPLATE-CUSTOMIZATION.md && echo "OK" || echo "FAIL"
grep -q "kata-complete-milestone" .docs/TEMPLATE-CUSTOMIZATION.md && echo "OK" || echo "FAIL"
grep -q "kata-add-milestone" .docs/TEMPLATE-CUSTOMIZATION.md && echo "OK" || echo "FAIL"
grep -q "kata-verify-work" .docs/TEMPLATE-CUSTOMIZATION.md && echo "OK" || echo "FAIL"

# Schema format documented
grep -q "kata-template-schema" .docs/TEMPLATE-CUSTOMIZATION.md && echo "OK: schema format" || echo "FAIL"

# Resolution documented
grep -q "resolve-template.sh" .docs/TEMPLATE-CUSTOMIZATION.md && echo "OK: resolution" || echo "FAIL"
```
  </verify>
  <done>.docs/TEMPLATE-CUSTOMIZATION.md created with schema documentation for all 5 templates, schema format explanation, resolution mechanism, validation architecture, and migration guide from hooks to skills-based validation.</done>
</task>

</tasks>

<verification>
- README.md What's New section references v1.9.0
- README.md has a Template Customization section listing all 5 templates
- README.md includes example workflow with list/copy/edit/validate commands
- README.md artifact structure includes .planning/templates/
- .docs/TEMPLATE-CUSTOMIZATION.md documents required and optional fields for all 5 templates
- .docs/TEMPLATE-CUSTOMIZATION.md explains schema comment format
- .docs/TEMPLATE-CUSTOMIZATION.md documents template resolution (project override then sibling discovery)
- .docs/TEMPLATE-CUSTOMIZATION.md includes validation architecture (which skills run which checks)
- .docs/TEMPLATE-CUSTOMIZATION.md has migration guide listing removed hooks and replacement scripts
- No source code files modified
</verification>

<success_criteria>
- DOCS-01: README includes template customization section with setup instructions
- DOCS-02: All customizable templates listed with descriptions and field documentation
- DOCS-03: Example workflow shows end-to-end template customization
- DOCS-04: Template schema documentation covers required and optional fields per template
- DOCS-05: Migration guide explains transition from hooks-based to skills-based validation
</success_criteria>

<output>
After completion, create `.planning/phases/active/43-documentation/43-01-SUMMARY.md`
</output>

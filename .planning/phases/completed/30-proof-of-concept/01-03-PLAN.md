---
phase: 01-proof-of-concept
plan: 03
type: execute
wave: 2
depends_on: ["01-01", "01-02"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Phase planning with new pattern produces equivalent quality output"
    - "Phase execution with new pattern produces equivalent quality output"
    - "User has made Go/No-Go decision on proceeding to full conversion"
  artifacts: []
  key_links:
    - from: "skills/kata-plan-phase/SKILL.md"
      to: "general-purpose subagent"
      via: "Task() call with inlined instructions"
      pattern: "subagent_type=\"general-purpose\""
    - from: "skills/kata-execute-phase/SKILL.md"
      to: "general-purpose subagent"
      via: "Task() call with inlined instructions"
      pattern: "subagent_type=\"general-purpose\""
---

<objective>
Validate that the skill resource + general-purpose subagent pattern produces equivalent behavior to the custom subagent pattern. Then present Go/No-Go decision to user.

Purpose: POC validation (POC-05) and decision gate (POC-06). The whole point of Phase 1 is answering: does this pattern work? This plan answers that question and gets a user decision.
Output: Validation results + user decision to proceed or abandon
</objective>

<execution_context>
<!-- Executor agent has built-in instructions for plan execution and summary creation -->
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/pending/01-proof-of-concept/01-RESEARCH.md

Prior plan summaries (needed for validation context):
@.planning/phases/pending/01-proof-of-concept/01-01-SUMMARY.md
@.planning/phases/pending/01-proof-of-concept/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Validate POC behavior</name>
  <files></files>
  <action>
Run validation checks to confirm the migrated skills work correctly:

1. **Build validation**: Run `npm run build:plugin` and confirm it succeeds. Check that the built output includes the new reference files (`planner-instructions.md`, `executor-instructions.md`) in the correct locations.

2. **Artifact validation tests**: Run `npm test` (or the specific test file `tests/artifact-validation.test.js`) and confirm all tests pass. The test for "all Kata subagent_type attributes have kata: prefix" should pass because `general-purpose` does not start with `kata-`.

3. **Structural validation**: Verify the prompt assembly pattern is correct:
   - Confirm `skills/kata-plan-phase/SKILL.md` reads `references/planner-instructions.md` before Task() calls
   - Confirm both standard (step 8) and revision (step 12) Task() calls include `<agent-instructions>` wrapper
   - Confirm `skills/kata-execute-phase/SKILL.md` reads `references/executor-instructions.md` before wave execution
   - Confirm all 3 wave execution Task() calls include `<agent-instructions>` wrapper

4. **No stale references check**: Run `grep -r 'subagent_type="kata-planner"' skills/` and `grep -r 'subagent_type="kata-executor"' skills/` to confirm zero matches in the two migrated skill directories. Note: other skills (kata-execute-quick-task, kata-verify-work) still reference custom agents and are Phase 2 scope.

5. **Instructions file integrity**:
   - Confirm `planner-instructions.md` starts with `<role>` and contains `<structured_returns>`
   - Confirm `executor-instructions.md` starts with `<role>` and contains `<structured_returns>`
   - Confirm neither file contains YAML frontmatter markers

Document all validation results (pass/fail with details) for the checkpoint task below.
  </action>
  <verify>
1. `npm run build:plugin` exits 0
2. `npm test` passes (specifically artifact-validation tests)
3. No stale `kata-planner`/`kata-executor` subagent_type references in migrated skills
4. Instructions files are well-formed
  </verify>
  <done>All automated validation checks pass. Results documented for user review.</done>
</task>

<task type="checkpoint:decision" gate="blocking">
  <decision>Go/No-Go: Proceed with full conversion to skill resource pattern?</decision>
  <context>
The POC migrated 2 of 15+ agents (kata-planner, kata-executor) from custom subagent type to the "skill resource + general-purpose subagent" pattern. This checkpoint determines whether to:
- Proceed to Phase 2 (migrate all remaining agents)
- Abandon the milestone (revert changes, stay with custom subagents)

Key factors for the decision:
- Build and tests pass
- Structural validation confirms correct prompt assembly
- The core unknown is behavioral equivalence: whether inlined instructions (task prompt) produce the same quality output as system prompt instructions. This can only be fully validated by running the skills in a real project.

Recommendation: If automated checks pass, try running `/kata-plan-phase` on a test phase in a separate project to observe output quality before deciding.
  </context>
  <options>
    <option id="go">
      <name>Go - Proceed to Full Conversion</name>
      <pros>Portability across Agent Skills platforms, simpler architecture (no custom agent types), all automated checks pass</pros>
      <cons>Behavioral equivalence not yet proven in production usage, prompt size impact unknown until real usage</cons>
    </option>
    <option id="no-go">
      <name>No-Go - Abandon Milestone</name>
      <pros>Zero risk, keep working system</pros>
      <cons>Stay locked to Claude Code custom agent mechanism, not portable</cons>
    </option>
    <option id="extend-poc">
      <name>Extend POC - Test in real project first</name>
      <pros>Higher confidence in Go decision</pros>
      <cons>Additional time before committing to direction</cons>
    </option>
  </options>
  <resume-signal>Select: go, no-go, or extend-poc</resume-signal>
</task>

</tasks>

<verification>
- Build passes
- All tests pass
- No stale subagent references in migrated skills
- User has made an explicit Go/No-Go/Extend decision
</verification>

<success_criteria>
1. All automated validation checks pass
2. User has made a Go/No-Go decision
3. Decision is recorded in STATE.md
</success_criteria>

<output>
After completion, create `.planning/phases/pending/01-proof-of-concept/01-03-SUMMARY.md`
</output>

---
phase: 01-release-automation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/completing-milestones/references/version-detector.md
  - skills/completing-milestones/references/changelog-generator.md
autonomous: true

must_haves:
  truths:
    - "Version detector parses git log for conventional commit types"
    - "Version detector returns major/minor/patch/none based on commit analysis"
    - "Changelog generator formats commits into Keep a Changelog structure"
    - "Both reference files are self-contained with verified bash patterns"
  artifacts:
    - path: "skills/completing-milestones/references/version-detector.md"
      provides: "Semantic version detection from conventional commits"
      contains: "detect_version_bump"
    - path: "skills/completing-milestones/references/changelog-generator.md"
      provides: "Changelog entry generation from git history"
      contains: "generate_changelog_entry"
  key_links:
    - from: "version-detector.md"
      to: "git log"
      via: "bash command extraction"
      pattern: "git log.*format"
    - from: "changelog-generator.md"
      to: "CHANGELOG.md"
      via: "Keep a Changelog format"
      pattern: "\\[.*\\] - \\d{4}"
---

<objective>
Create reference files for version detection and changelog generation.

Purpose: Provide reusable logic that the completing-milestones skill can use to automate release artifact creation.
Output: Two reference files with verified bash patterns from 01-RESEARCH.md.
</objective>

<execution_context>
<!-- Executor agent has built-in instructions for plan execution and summary creation -->
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-release-automation/01-RESEARCH.md

# Existing skill structure
@skills/completing-milestones/SKILL.md
@skills/completing-milestones/references/milestone-complete.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create version-detector.md reference</name>
  <files>skills/completing-milestones/references/version-detector.md</files>
  <action>
Create `skills/completing-milestones/references/version-detector.md` by extracting and organizing content from `01-RESEARCH.md`:

1. **Purpose section** — Explain semantic version detection from conventional commits
2. **Commit parsing patterns** — Extract from research "Pattern 1: Conventional Commit Parsing" (git describe, git log, grep filters)
3. **detect_version_bump function** — Extract from research "Pattern 2: Semantic Version Detection"
4. **calculate_next_version function** — Extract from research "Code Examples > Version Bump Calculation"
5. **update_versions function** — Extract from research "Code Examples > Version File Updates"
6. **Dry run mode section** — Reference research "Pattern 4: Dry Run Mode"
7. **Pitfall warnings** — Extract relevant items from research "Common Pitfalls" (version mismatch, missing ! suffix, empty release)

Format as XML-structured reference file following Kata conventions.
  </action>
  <verify>
File exists at skills/completing-milestones/references/version-detector.md
File contains "detect_version_bump" function
File contains "calculate_next_version" function
File contains "update_versions" function
  </verify>
  <done>version-detector.md contains complete version detection logic sourced from 01-RESEARCH.md</done>
</task>

<task type="auto">
  <name>Task 2: Create changelog-generator.md reference</name>
  <files>skills/completing-milestones/references/changelog-generator.md</files>
  <action>
Create `skills/completing-milestones/references/changelog-generator.md` by extracting and organizing content from `01-RESEARCH.md`:

1. **Purpose section** — Explain changelog generation from conventional commits
2. **Keep a Changelog format template** — Extract from research "Pattern 3: Changelog Entry Generation"
3. **get_commits_by_type function** — Extract from research "Code Examples > Commit Type Extraction"
4. **generate_changelog_entry function** — Extract from research "Code Examples > Changelog Generation"
5. **Commit type mapping** — feat->Added, fix->Fixed, refactor/perf/docs->Changed
6. **Review gate emphasis** — Changelog is generated as suggestion, requires human approval
7. **Pitfall warnings** — Extract from research "Pitfall 3: Changelog Overwrites"

Format as XML-structured reference file following Kata conventions.
  </action>
  <verify>
File exists at skills/completing-milestones/references/changelog-generator.md
File contains "get_commits_by_type" function
File contains "generate_changelog_entry" function
File contains Keep a Changelog format template
  </verify>
  <done>changelog-generator.md contains complete changelog generation logic sourced from 01-RESEARCH.md</done>
</task>

</tasks>

<verification>
```bash
# Both reference files exist
ls -la skills/completing-milestones/references/version-detector.md
ls -la skills/completing-milestones/references/changelog-generator.md

# Version detector has required functions
grep -q "detect_version_bump" skills/completing-milestones/references/version-detector.md && echo "OK: detect_version_bump"
grep -q "calculate_next_version" skills/completing-milestones/references/version-detector.md && echo "OK: calculate_next_version"
grep -q "update_versions" skills/completing-milestones/references/version-detector.md && echo "OK: update_versions"

# Changelog generator has required functions
grep -q "get_commits_by_type" skills/completing-milestones/references/changelog-generator.md && echo "OK: get_commits_by_type"
grep -q "generate_changelog_entry" skills/completing-milestones/references/changelog-generator.md && echo "OK: generate_changelog_entry"
```
</verification>

<success_criteria>
- [ ] version-detector.md created with semantic version detection logic
- [ ] version-detector.md contains detect_version_bump, calculate_next_version, update_versions functions
- [ ] changelog-generator.md created with Keep a Changelog formatting
- [ ] changelog-generator.md contains get_commits_by_type, generate_changelog_entry functions
- [ ] Both files follow Kata XML reference conventions
- [ ] Dry run mode documented in version-detector.md
- [ ] Review gate pattern documented in changelog-generator.md
</success_criteria>

<output>
After completion, create `.planning/phases/01-release-automation/01-01-SUMMARY.md`
</output>

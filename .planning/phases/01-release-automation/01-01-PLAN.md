---
phase: 01-release-automation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/completing-milestones/references/changelog-generator.md
  - skills/completing-milestones/references/version-detector.md
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Changelog generation logic is documented with shell patterns"
    - "Version detection algorithm is documented with bump rules"
    - "Dry-run mode is documented for validation without side effects"
  artifacts:
    - path: "skills/completing-milestones/references/changelog-generator.md"
      provides: "Changelog generation from conventional commits"
      contains: "generate_changelog_entry"
    - path: "skills/completing-milestones/references/version-detector.md"
      provides: "Semantic version bump detection"
      contains: "detect_version_bump"
  key_links:
    - from: "version-detector.md"
      to: "conventional commits"
      via: "git log parsing"
      pattern: "git log.*grep"
    - from: "changelog-generator.md"
      to: "Keep a Changelog format"
      via: "markdown template"
      pattern: "## \\[.*\\]"
---

<objective>
Create reference documentation for changelog generation and version detection.

Purpose: Provide shell-based patterns that the completing-milestones skill can use to automate release workflow (REL-01, REL-02, REL-04).
Output: Two reference files with documented shell functions for changelog generation and semantic version detection.
</objective>

<execution_context>
<!-- Executor agent has built-in instructions for plan execution and summary creation -->
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-release-automation/01-RESEARCH.md

@skills/completing-milestones/SKILL.md
@skills/completing-milestones/references/milestone-complete.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create version-detector.md reference</name>
  <files>skills/completing-milestones/references/version-detector.md</files>
  <action>
Create version-detector.md with:

1. Purpose section explaining semantic versioning from conventional commits
2. Shell function `get_last_tag` to find most recent release tag
3. Shell function `get_commits_by_type` to filter commits since last tag
4. Shell function `detect_version_bump` implementing:
   - Breaking change (! or BREAKING CHANGE:) → major
   - feat commits → minor
   - fix commits → patch
   - docs/chore/etc only → none (prompt user)
5. Shell function `calculate_next_version` to compute X.Y.Z
6. Usage examples showing how to call from skill workflow
7. DRY_RUN mode pattern for REL-04 (validate without executing)

Use patterns from 01-RESEARCH.md code examples. Format as reference doc (not executable script).
  </action>
  <verify>File exists with all documented functions: get_last_tag, get_commits_by_type, detect_version_bump, calculate_next_version</verify>
  <done>Version detection reference complete with semantic versioning logic documented</done>
</task>

<task type="auto">
  <name>Task 2: Create changelog-generator.md reference</name>
  <files>skills/completing-milestones/references/changelog-generator.md</files>
  <action>
Create changelog-generator.md with:

1. Purpose section explaining Keep a Changelog format generation
2. Shell function `extract_commits_since_tag` to get commit subjects
3. Shell function `categorize_commits` to bucket by type:
   - feat → Added
   - fix → Fixed
   - docs/refactor/perf → Changed
   - BREAKING CHANGE → Breaking Changes (top of entry)
4. Shell function `generate_changelog_entry` to produce markdown:
   ```
   ## [X.Y.Z] - YYYY-MM-DD

   ### Breaking Changes (if any)
   ### Added (from feat)
   ### Fixed (from fix)
   ### Changed (from other)
   ```
5. Shell function `prepend_to_changelog` to insert at top of CHANGELOG.md
6. Human review pattern: generate as suggestion, prompt before writing
7. DRY_RUN mode showing what would be written without file modification

Use patterns from 01-RESEARCH.md. Match existing reference file style.
  </action>
  <verify>File exists with generate_changelog_entry function and Keep a Changelog format template</verify>
  <done>Changelog generation reference complete with categorization and formatting logic</done>
</task>

</tasks>

<verification>
```bash
# Verify both reference files exist
ls skills/completing-milestones/references/version-detector.md
ls skills/completing-milestones/references/changelog-generator.md

# Verify key functions documented
grep -l "detect_version_bump" skills/completing-milestones/references/version-detector.md
grep -l "generate_changelog_entry" skills/completing-milestones/references/changelog-generator.md

# Verify dry-run pattern documented
grep -l "DRY_RUN" skills/completing-milestones/references/version-detector.md
grep -l "DRY_RUN" skills/completing-milestones/references/changelog-generator.md
```
</verification>

<success_criteria>
- [ ] version-detector.md created with semantic versioning logic
- [ ] changelog-generator.md created with Keep a Changelog format
- [ ] Both files document DRY_RUN mode for validation
- [ ] Shell patterns match existing Kata conventions
- [ ] Files follow reference documentation style (not executable scripts)
</success_criteria>

<output>
After completion, create `.planning/phases/01-release-automation/01-01-SUMMARY.md`
</output>

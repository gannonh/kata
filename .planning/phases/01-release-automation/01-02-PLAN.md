---
phase: 01-release-automation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - skills/completing-milestones/SKILL.md
  - skills/completing-milestones/references/milestone-complete.md
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User can trigger release workflow during milestone completion"
    - "Changelog is auto-generated from commits and shown for approval"
    - "Version bump is auto-detected and shown for confirmation"
    - "User can dry-run release without side effects"
  artifacts:
    - path: "skills/completing-milestones/SKILL.md"
      provides: "Updated skill with release workflow references"
      contains: "changelog-generator.md"
    - path: "skills/completing-milestones/references/milestone-complete.md"
      provides: "Release workflow steps integrated"
      contains: "release_workflow"
  key_links:
    - from: "milestone-complete.md"
      to: "changelog-generator.md"
      via: "@./references reference"
      pattern: "@./references/changelog-generator.md"
    - from: "milestone-complete.md"
      to: "version-detector.md"
      via: "@./references reference"
      pattern: "@./references/version-detector.md"
    - from: "SKILL.md"
      to: "gh release create"
      via: "GitHub CLI"
      pattern: "gh release"
---

<objective>
Integrate release automation into the completing-milestones skill workflow.

Purpose: Enable users to trigger changelog generation, version detection, and GitHub Release creation during milestone completion (REL-01, REL-02, REL-03, REL-04).
Output: Updated completing-milestones skill that offers release workflow as optional step after milestone verification.
</objective>

<execution_context>
<!-- Executor agent has built-in instructions for plan execution and summary creation -->
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-release-automation/01-RESEARCH.md
@.planning/phases/01-release-automation/01-01-SUMMARY.md

@skills/completing-milestones/SKILL.md
@skills/completing-milestones/references/milestone-complete.md
@skills/completing-milestones/references/changelog-generator.md
@skills/completing-milestones/references/version-detector.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update SKILL.md execution_context</name>
  <files>skills/completing-milestones/SKILL.md</files>
  <action>
Update the execution_context section to include new reference files:

```xml
<execution_context>
**Load these files NOW (before proceeding):**

- @./references/milestone-complete.md (main workflow)
- @./references/milestone-archive-template.md (archive template)
- @./references/changelog-generator.md (release: changelog generation)
- @./references/version-detector.md (release: version detection)
</execution_context>
```

Also update the description to mention release workflow:
- Add "release automation" and "trigger release" to description triggers

Keep all other SKILL.md content unchanged.
  </action>
  <verify>grep "changelog-generator.md" skills/completing-milestones/SKILL.md</verify>
  <done>SKILL.md references new release workflow documentation</done>
</task>

<task type="auto">
  <name>Task 2: Add release workflow steps to milestone-complete.md</name>
  <files>skills/completing-milestones/references/milestone-complete.md</files>
  <action>
Add release workflow as new step between "review_documentation" and "update_state" steps.

Create `<step name="release_workflow">` with:

1. Check if user wants release automation:
   ```
   Use AskUserQuestion:
   - header: "Release Automation"
   - question: "Would you like to generate release artifacts for v{{version}}?"
   - options:
     - "Yes, generate changelog and release" — Proceed with release workflow
     - "Dry run first" — Show what would happen without executing
     - "Skip release" — Continue to milestone completion without release
   ```

2. If "Yes" or "Dry run":
   - Load @./references/version-detector.md
   - Call detect_version_bump to get suggested bump type
   - Show detected version and ask for confirmation
   - Load @./references/changelog-generator.md
   - Call generate_changelog_entry for suggested changelog
   - Show changelog and ask for approval/edits

3. If "Dry run":
   - Display all artifacts that WOULD be created
   - Display all files that WOULD be modified
   - Do NOT execute any writes
   - Return to release choice

4. If approved (not dry run):
   - Update package.json version
   - Update .claude-plugin/plugin.json version
   - Prepend changelog entry to CHANGELOG.md
   - Stage version files for commit

5. Update existing git_commit_milestone step:
   - Include version file changes in commit if release was triggered
   - Add release artifacts to commit message

6. Add release step after commit (if release was triggered):
   - Check for existing release: `gh release view v{{version}}`
   - If not exists: `gh release create v{{version}} --title "v{{version}}" --notes "$(cat CHANGELOG_ENTRY)"`
   - Confirm release URL

Include appropriate error handling:
- Tag already exists: warn and skip
- gh CLI not authenticated: show auth instructions
- Version mismatch: prompt to fix manually
  </action>
  <verify>grep -l "release_workflow" skills/completing-milestones/references/milestone-complete.md</verify>
  <done>Release workflow integrated into milestone completion process</done>
</task>

<task type="auto">
  <name>Task 3: Update success_criteria in milestone-complete.md</name>
  <files>skills/completing-milestones/references/milestone-complete.md</files>
  <action>
Update the success_criteria section to include release workflow outcomes:

Add to checklist:
- [ ] (Optional) Changelog entry generated and approved
- [ ] (Optional) Version bumped in package.json and plugin.json
- [ ] (Optional) GitHub Release created with changelog notes

Update the offer_next step to mention release status:
```
✅ Milestone v[X.Y] [Name] complete

{If release triggered:}
Released:
- GitHub Release: [URL]
- Changelog: Updated CHANGELOG.md
- Version: package.json and plugin.json updated to v[X.Y]

{If release skipped:}
Note: Release artifacts not created. Run manually if needed:
- Update CHANGELOG.md
- Update version in package.json and plugin.json
- Create GitHub Release
```
  </action>
  <verify>grep "GitHub Release" skills/completing-milestones/references/milestone-complete.md</verify>
  <done>Success criteria updated with release workflow outcomes</done>
</task>

</tasks>

<verification>
```bash
# Verify SKILL.md references new files
grep "changelog-generator.md" skills/completing-milestones/SKILL.md
grep "version-detector.md" skills/completing-milestones/SKILL.md

# Verify release_workflow step exists
grep -l "release_workflow" skills/completing-milestones/references/milestone-complete.md

# Verify dry-run option exists
grep -l "Dry run" skills/completing-milestones/references/milestone-complete.md

# Verify GitHub Release integration
grep "gh release" skills/completing-milestones/references/milestone-complete.md
```
</verification>

<success_criteria>
- [ ] SKILL.md execution_context includes changelog-generator.md and version-detector.md
- [ ] milestone-complete.md has release_workflow step with 3 options (Yes/Dry run/Skip)
- [ ] Dry run mode shows artifacts without modifying files
- [ ] Release workflow updates package.json, plugin.json, CHANGELOG.md
- [ ] GitHub Release creation integrated with gh CLI
- [ ] Success criteria updated with release workflow outcomes
</success_criteria>

<output>
After completion, create `.planning/phases/01-release-automation/01-02-SUMMARY.md`
</output>

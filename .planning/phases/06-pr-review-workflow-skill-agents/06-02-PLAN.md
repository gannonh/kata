---
phase: 06-pr-review-workflow-skill-agents
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - skills/kata-reviewing-prs/SKILL.md
autonomous: true

must_haves:
  truths:
    - "Skill auto-detects PR context when invoked with no arguments"
    - "Skill integrates with gh pr diff for scope detection"
    - "Skill supports parallel agent execution when requested"
  artifacts:
    - path: "skills/kata-reviewing-prs/SKILL.md"
      provides: "Enhanced PR review skill with GitHub integration"
      contains: "gh pr diff"
  key_links:
    - from: "skills/kata-reviewing-prs/SKILL.md"
      to: "gh CLI"
      via: "shell commands in workflow"
      pattern: "gh pr"
---

<objective>
Enhance the PR review skill with GitHub PR context integration and Kata-specific workflow patterns.

Purpose: Make the skill context-aware so it automatically detects when running during PR workflow and adapts its scope accordingly.
Output: Updated SKILL.md with GitHub PR integration and Kata workflow guidance.
</objective>

<execution_context>
@./references/execute-plan.md
@./references/summary-template.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/06-pr-review-workflow-skill-agents/06-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add GitHub PR context detection</name>
  <files>skills/kata-reviewing-prs/SKILL.md</files>
  <action>
    Update the SKILL.md workflow section to include PR context detection:

    1. Add a "Context Detection" section before "Workflow":
       ```markdown
       ## Context Detection

       When invoked, the skill automatically detects context:

       **On a PR branch:**
       ```bash
       # Check if current branch has an open PR
       gh pr view --json number,baseRefName 2>/dev/null
       ```
       If a PR exists, use `gh pr diff` for scope instead of `git diff`.

       **During phase execution:**
       When `pr_workflow: true` in `.planning/config.json`, the skill knows to review phase-specific changes.

       **Standalone:**
       Falls back to `git diff` for unstaged changes, or `git diff --staged` for staged changes.
       ```

    2. Update the Workflow section step 1 (Determine scope):
       - Add PR detection: "If on a branch with open PR, use `gh pr diff --name-only`"
       - Add staged detection: "If `--staged` flag, use `git diff --staged --name-only`"
       - Keep existing: "Default to `git diff --name-only` for unstaged changes"

    3. Add Kata-specific usage section after "Workflow Integration":
       ```markdown
       ## Kata Workflow Usage

       **During phase execution (`pr_workflow: true`):**
       Review phase changes before marking PR ready. Invoke between plan execution and phase completion.

       **After plan completion:**
       Quick review of individual plan changes:
       `/kata:reviewing-prs code errors`

       **Before milestone audit:**
       Full review of all milestone changes:
       `/kata:reviewing-prs all`

       **Pre-commit hook pattern:**
       Add to your workflow before committing:
       1. Stage changes
       2. `/kata:reviewing-prs code errors --staged`
       3. Fix critical issues
       4. Commit
       ```

    4. Ensure parallel execution is documented (already in source, verify):
       `/kata:reviewing-prs all parallel` launches all agents simultaneously via multiple Task calls.
  </action>
  <verify>grep -c "gh pr diff" skills/kata-reviewing-prs/SKILL.md returns at least 2 (context detection + workflow)</verify>
  <done>SKILL.md includes GitHub PR context detection and Kata workflow usage patterns</done>
</task>

<task type="auto">
  <name>Task 2: Add argument handling for staged/PR modes</name>
  <files>skills/kata-reviewing-prs/SKILL.md</files>
  <action>
    Update the Usage section to document argument handling:

    1. Add to Usage section:
       ```markdown
       **Scope modifiers:**
       ```
       /kata:reviewing-prs --staged        # Review staged changes only
       /kata:reviewing-prs --pr            # Force PR diff mode (auto-detected normally)
       /kata:reviewing-prs --branch main   # Compare against specific branch
       ```

       **Combined usage:**
       ```
       /kata:reviewing-prs code tests --staged    # Review staged code and tests
       /kata:reviewing-prs all --pr               # Full review of PR changes
       ```
       ```

    2. Update the argument-hint in frontmatter:
       `argument-hint: "[aspects...] [--staged|--pr|--branch <ref>]"`

    3. Add a "Scope Resolution" subsection explaining precedence:
       - Explicit `--pr` or `--staged` takes precedence
       - Auto-detect PR if on branch with open PR
       - Default to unstaged `git diff`
  </action>
  <verify>grep "argument-hint" skills/kata-reviewing-prs/SKILL.md shows the updated hint</verify>
  <done>Skill documents --staged, --pr, --branch modifiers with clear precedence rules</done>
</task>

</tasks>

<verification>
- [ ] `grep "gh pr diff" skills/kata-reviewing-prs/SKILL.md` shows PR integration
- [ ] `grep "Context Detection" skills/kata-reviewing-prs/SKILL.md` shows new section
- [ ] `grep "Kata Workflow Usage" skills/kata-reviewing-prs/SKILL.md` shows integration guidance
- [ ] `grep "\-\-staged" skills/kata-reviewing-prs/SKILL.md` shows staged mode documentation
</verification>

<success_criteria>
- Skill auto-detects PR context using gh pr view
- Skill uses gh pr diff when on a PR branch
- --staged, --pr, --branch modifiers documented
- Kata workflow usage patterns documented for phase execution, plan completion, and pre-commit
</success_criteria>

<output>
After completion, create `.planning/phases/06-pr-review-workflow-skill-agents/06-02-SUMMARY.md`
</output>

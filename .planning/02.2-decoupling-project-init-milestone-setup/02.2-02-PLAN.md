---
phase: 02.2-decoupling-project-init-milestone-setup
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/kata-adding-milestones/SKILL.md
  - skills/kata-adding-milestones/references/questioning.md
  - skills/kata-adding-milestones/references/ui-brand.md
  - skills/kata-adding-milestones/references/project-template.md
  - skills/kata-adding-milestones/references/requirements-template.md
  - skills/kata-adding-milestones/references/github-mapping.md
autonomous: true

must_haves:
  truths:
    - "add-milestone skill creates ROADMAP.md with milestone definition"
    - "add-milestone detects if this is first milestone (no ROADMAP.md exists)"
    - "add-milestone creates GitHub Milestone when github.enabled=true and remote exists (Phase 5.5)"
    - "Skill name matches kata-adding-* pattern for consistency"
  artifacts:
    - path: "skills/kata-adding-milestones/SKILL.md"
      provides: "Milestone creation skill"
      contains: "kata-adding-milestones"
    - path: "skills/kata-adding-milestones/references/github-mapping.md"
      provides: "Kata-GitHub primitive mapping documentation"
      contains: "Milestone"
  key_links:
    - from: "skills/kata-adding-milestones/SKILL.md"
      to: "ROADMAP.md"
      via: "roadmapper agent"
      pattern: "kata-roadmapper"
    - from: "skills/kata-adding-milestones/SKILL.md"
      to: "GitHub API"
      via: "Phase 5.5 gh api call"
      pattern: "gh api.*milestones"
---

<objective>

Rename kata-starting-milestones to kata-adding-milestones for consistency with kata-adding-phases and kata-adding-todos naming pattern.

Purpose: Unified skill naming convention across Kata skills.
Output: New kata-adding-milestones skill directory (renamed from starting-milestones with updated frontmatter).

</objective>

<context>

@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02.2-decoupling-project-init-milestone-setup/02.2-RESEARCH.md

**Key insight:** This is a RENAME operation, not a merge. The existing `skills/kata-starting-milestones/SKILL.md` already contains the complete flow:
- Phase 5.5: GitHub Milestone creation (when github.enabled=true and remote exists)
- Phase 6.5: Model profile resolution
- Phases 7-9: Research → Requirements → Roadmap flow

No code needs to be extracted from starting-projects. The skill is already complete.

**Changes needed:**
1. Rename skill directory and update frontmatter name field
2. Update description to include "add milestone" trigger phrases
3. Update user_command to `/kata:add-milestone`
4. Copy reference files to new location
5. Add github-mapping.md reference document

</context>

<tasks>

<task type="auto">
  <name>Task 1: Rename skill and update frontmatter</name>
  <files>skills/kata-adding-milestones/SKILL.md</files>
  <action>
1. Create new skill directory:
```bash
mkdir -p skills/kata-adding-milestones/references
```

2. Copy SKILL.md from starting-milestones:
```bash
cp skills/kata-starting-milestones/SKILL.md skills/kata-adding-milestones/SKILL.md
```

3. Update the SKILL.md frontmatter (lines 1-13) to:
```yaml
---
name: kata-adding-milestones
description: Use this skill when adding a milestone to an existing project, starting a new milestone cycle, creating the first milestone after project init, or defining what's next after completing work. Triggers include "add milestone", "new milestone", "start milestone", "create milestone", "first milestone", "next milestone", and "milestone cycle".
version: 0.1.0
user-invocable: true
disable-model-invocation: false
allowed-tools:
  - Read
  - Write
  - Bash
  - Task
  - AskUserQuestion
---
```

4. Update the user_command line (after frontmatter):
```
<user_command>/kata:add-milestone</user_command>
```

5. In the objective section, update to clarify first-milestone handling:
```
Add a milestone to the project through unified flow: questioning → research (optional) → requirements → roadmap.

This works for both first milestone (after /kata:new-project) and subsequent milestones (after completing a milestone).

**Creates/Updates:**
- `.planning/PROJECT.md` — updated with new milestone goals
- `.planning/research/` — domain research (optional, focuses on NEW features)
- `.planning/REQUIREMENTS.md` — scoped requirements for this milestone
- `.planning/ROADMAP.md` — phase structure (creates if first, continues if subsequent)
- `.planning/STATE.md` — reset for new milestone (creates if first)

**After this command:** Run `/kata:plan-phase [N]` to start execution.
```

**DO NOT** change any of the process phases (1-10). They are already correct, including:
- Phase 5.5 for GitHub Milestone creation
- Phase 6.5 for model profile resolution
- Phases 7-9 for research/requirements/roadmap flow

**First milestone detection** is already in the existing skill (check for ROADMAP.md existence). No changes needed to this logic.
  </action>
  <verify>
```bash
# Verify skill directory exists
ls -la skills/kata-adding-milestones/

# Verify name field updated
grep "^name: kata-adding-milestones" skills/kata-adding-milestones/SKILL.md

# Verify user_command updated
grep "kata:add-milestone" skills/kata-adding-milestones/SKILL.md

# Verify triggers include "add milestone"
grep -i "add milestone" skills/kata-adding-milestones/SKILL.md

# Verify Phase 5.5 still exists (GitHub Milestone creation)
grep -A5 "Phase 5.5" skills/kata-adding-milestones/SKILL.md | head -10
```
  </verify>
  <done>
skills/kata-adding-milestones/SKILL.md exists with updated name field, description triggers, and user_command. All process phases preserved including Phase 5.5 for GitHub Milestone creation.
  </done>
</task>

<task type="auto">
  <name>Task 2: Copy reference files and add github-mapping.md</name>
  <files>
skills/kata-adding-milestones/references/questioning.md
skills/kata-adding-milestones/references/ui-brand.md
skills/kata-adding-milestones/references/project-template.md
skills/kata-adding-milestones/references/requirements-template.md
skills/kata-adding-milestones/references/github-mapping.md
  </files>
  <action>
1. Copy all reference files from starting-milestones:
```bash
cp skills/kata-starting-milestones/references/* skills/kata-adding-milestones/references/
```

2. Create github-mapping.md reference document at `skills/kata-adding-milestones/references/github-mapping.md`:

```markdown
# Kata-GitHub Primitive Mapping

This document defines how Kata concepts map to GitHub primitives when `github.enabled=true`.

## Mapping Table

| Kata Concept | GitHub Primitive | Created By | Notes |
| ------------ | ---------------- | ---------- | ----- |
| **Milestone** | GitHub Milestone | `add-milestone` (Phase 5.5) | 1:1 mapping. Version becomes milestone title. |
| **Phase** | GitHub Issue | `planning-phases` (future) | Assigned to corresponding milestone. `phase` label applied. |
| **Plan** | Checklist in Issue body | `executing-phases` (future) | Plans become `- [ ]` items in phase issue body. |
| **Task** | N/A | Not mapped | Tasks are internal execution units, not surfaced to GitHub. |

## GitHub Config Keys

| Key | Values | Effect |
| --- | ------ | ------ |
| `github.enabled` | `true`/`false` | Master toggle for all GitHub integration |
| `github.issueMode` | `auto`/`ask`/`never` | When to create phase Issues |

## Milestone Creation Flow (Phase 5.5)

When `github.enabled=true` and a GitHub remote exists:

1. **Check for existing milestone:**
   ```bash
   MILESTONE_EXISTS=$(gh api /repos/:owner/:repo/milestones | jq -r ".[] | select(.title==\"v${VERSION}\") | .number")
   ```

2. **Create if doesn't exist:**
   ```bash
   gh api --method POST /repos/:owner/:repo/milestones \
     -f title="v${VERSION}" \
     -f state='open' \
     -f description="${MILESTONE_DESC}"
   ```

3. **Idempotent:** Re-running add-milestone with same version skips creation.

## Phase Issue Creation (Future - Phase 3)

When `github.issueMode=auto` or user approves:

1. Create issue with `phase` label
2. Assign to milestone by number
3. Issue body includes:
   - Phase goal
   - Success criteria
   - Checklist of plans (added during planning-phases)

## Plan Checklist Sync (Future - Phase 4)

During execution:
- Plans start as `- [ ]` items
- `executing-phases` updates to `- [x]` as each plan completes
- Issue body is edited in place

## Future: Sub-Issues

If `gh-subissue` extension is available, plans could become sub-issues of the phase issue rather than checklist items. This provides:
- Individual plan status tracking
- Separate discussion threads per plan
- Richer linking

Currently not implemented; checklist approach is the MVP.
```

3. Update SKILL.md execution_context to reference github-mapping.md:
   Add `@./references/github-mapping.md` to the execution_context section.
  </action>
  <verify>
```bash
# Verify all reference files copied
ls -la skills/kata-adding-milestones/references/

# Verify github-mapping.md exists
cat skills/kata-adding-milestones/references/github-mapping.md | head -20

# Verify SKILL.md references github-mapping.md
grep "github-mapping.md" skills/kata-adding-milestones/SKILL.md
```
  </verify>
  <done>
All reference files copied from starting-milestones. github-mapping.md created with Kata-GitHub primitive mapping. SKILL.md references github-mapping.md in execution_context.
  </done>
</task>

<task type="auto">
  <name>Task 3: Commit adding-milestones skill</name>
  <files>skills/kata-adding-milestones/</files>
  <action>
Stage and commit the new skill:

```bash
git add skills/kata-adding-milestones/
git commit -m "$(cat <<'EOF'
feat(02.2-02): create kata-adding-milestones skill

Renamed from kata-starting-milestones for consistency with:
- kata-adding-phases
- kata-adding-todos

Updates:
- Frontmatter name: kata-adding-milestones
- User command: /kata:add-milestone
- Description triggers: "add milestone", "first milestone"

Existing features preserved:
- Phase 5.5: GitHub Milestone creation (when github.enabled=true)
- First milestone detection (creates ROADMAP.md + STATE.md if missing)
- Research → Requirements → Roadmap flow (Phases 7-9)

New:
- references/github-mapping.md documents Kata-GitHub primitive mapping

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
)"
```
  </action>
  <verify>
`git log -1 --oneline` shows the commit.
`git show --stat HEAD` shows skills/kata-adding-milestones/ files added.
  </verify>
  <done>
Commit exists adding the new kata-adding-milestones skill.
  </done>
</task>

</tasks>

<verification>

```bash
# Verify skill structure
ls -la skills/kata-adding-milestones/
ls -la skills/kata-adding-milestones/references/

# Verify SKILL.md name field
grep "^name:" skills/kata-adding-milestones/SKILL.md

# Verify user_command
grep "kata:add-milestone" skills/kata-adding-milestones/SKILL.md

# Verify triggers
grep -i "add milestone" skills/kata-adding-milestones/SKILL.md

# Verify Phase 5.5 preserved (GitHub Milestone creation)
grep -c "Phase 5.5" skills/kata-adding-milestones/SKILL.md  # Should be >= 1
grep "gh api.*milestones" skills/kata-adding-milestones/SKILL.md  # Should find API call

# Verify github-mapping.md
head -5 skills/kata-adding-milestones/references/github-mapping.md

# Verify SKILL.md references github-mapping.md
grep "github-mapping.md" skills/kata-adding-milestones/SKILL.md
```

</verification>

<success_criteria>

- [ ] skills/kata-adding-milestones/ directory exists
- [ ] SKILL.md frontmatter has name: kata-adding-milestones
- [ ] Description includes "add milestone", "first milestone" triggers
- [ ] user_command is /kata:add-milestone
- [ ] Phase 5.5 preserved (GitHub Milestone creation via gh api)
- [ ] First milestone detection logic preserved (ROADMAP.md existence check)
- [ ] Research/requirements/roadmap flow preserved (Phases 7-9)
- [ ] references/github-mapping.md documents Kata-GitHub mapping
- [ ] All reference files copied (questioning.md, ui-brand.md, etc.)
- [ ] SKILL.md execution_context includes github-mapping.md
- [ ] Changes committed with descriptive message

</success_criteria>

<output>

After completion, create `.planning/phases/02.2-decoupling-project-init-milestone-setup/02.2-02-SUMMARY.md`

</output>

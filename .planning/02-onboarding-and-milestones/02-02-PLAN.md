---
phase: 02-onboarding-and-milestones
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/kata-starting-milestones/SKILL.md
autonomous: true

must_haves:
  truths:
    - "GitHub Milestone created when github.enabled = true"
    - "Milestone title matches version (v1.1.0 format)"
    - "Milestone description includes milestone goal"
    - "Milestone creation fails gracefully without blocking Kata workflow"
  artifacts:
    - path: "skills/kata-starting-milestones/SKILL.md"
      provides: "GitHub Milestone creation step"
      contains: "gh api"
  key_links:
    - from: "skills/kata-starting-milestones/SKILL.md"
      to: ".planning/config.json"
      via: "grep github.enabled"
      pattern: 'GITHUB_ENABLED.*grep.*enabled'
    - from: "skills/kata-starting-milestones/SKILL.md"
      to: "GitHub API"
      via: "gh api POST /repos/:owner/:repo/milestones"
      pattern: "gh api.*milestones"
---

<objective>
Extend kata-starting-milestones to create GitHub Milestones when enabled.

Purpose: Kata milestones automatically mirror to GitHub for visibility and tracking.
Output: Updated SKILL.md with GitHub Milestone creation in Phase 6.
</objective>

<execution_context>
@~/.claude/kata/references/execute-plan.md
@~/.claude/kata/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-onboarding-and-milestones/02-RESEARCH.md

**Phase 1 foundation:**
- Config schema: `github.enabled` (boolean), `github.issueMode` (auto|ask|never)
- Reading pattern: `grep -o '"enabled"[[:space:]]*:[[:space:]]*[^,}]*' | grep -o 'true\|false'`

**Research patterns (from 02-RESEARCH.md):**
- gh auth status check before API calls
- gh api POST /repos/:owner/:repo/milestones for creation
- Check milestone exists before creating (idempotent)
- Non-blocking error handling (warn and continue)

**Current skill structure:**
- Phase 6: Cleanup and Commit (after updating PROJECT.md and STATE.md)
- No GitHub integration currently
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add GitHub Milestone creation to Phase 6</name>
  <files>skills/kata-starting-milestones/SKILL.md</files>
  <action>
Add a new Phase 5.5 (or insert into Phase 6) for GitHub Milestone creation, after milestone version is determined but before final commit.

**Insert new section after Phase 5 (Update STATE.md) and before Phase 6 (Cleanup and Commit):**

```markdown
## Phase 5.5: Create GitHub Milestone (if enabled)

Read GitHub config:
```bash
GITHUB_ENABLED=$(cat .planning/config.json 2>/dev/null | grep -o '"enabled"[[:space:]]*:[[:space:]]*[^,}]*' | grep -o 'true\|false' || echo "false")
```

**If `GITHUB_ENABLED=true`:**

Check authentication (non-blocking):
```bash
if ! gh auth status &>/dev/null; then
  echo "⚠ GitHub CLI not authenticated. Run 'gh auth login' to enable GitHub integration."
  # Continue without GitHub operations
else
  # Proceed with milestone creation
fi
```

Check if milestone exists (idempotent):
```bash
MILESTONE_EXISTS=$(gh api /repos/:owner/:repo/milestones 2>/dev/null | jq -r ".[] | select(.title==\"v${VERSION}\") | .number" 2>/dev/null)
```

Create milestone if doesn't exist:
```bash
if [ -z "$MILESTONE_EXISTS" ]; then
  # Extract milestone description (first paragraph of goal, truncated to 500 chars)
  MILESTONE_DESC=$(echo "$MILESTONE_GOALS" | head -1 | cut -c1-500)

  gh api \
    --method POST \
    -H "Accept: application/vnd.github.v3+json" \
    /repos/:owner/:repo/milestones \
    -f title="v${VERSION}" \
    -f state='open' \
    -f description="${MILESTONE_DESC}" \
    2>/dev/null && echo "✓ GitHub Milestone v${VERSION} created" || echo "⚠ Failed to create GitHub Milestone (continuing)"
else
  echo "✓ GitHub Milestone v${VERSION} already exists (#${MILESTONE_EXISTS})"
fi
```

**If `GITHUB_ENABLED=false`:**

Skip GitHub operations silently (no warning needed - user opted out).

**Error handling principle:**
- All GitHub operations are non-blocking
- Failures warn but do not stop milestone initialization
- Planning files always persist locally regardless of GitHub status
```

**Update the completion display (Phase 10: Done) to show GitHub status:**

Add to the completion banner if GitHub was enabled:

```markdown
**If `GITHUB_ENABLED=true` and milestone created:**

Add to completion display:
| GitHub     | Milestone v${VERSION} created   |
```

**Important implementation notes:**
- The `gh api` pattern uses `:owner/:repo` placeholders that resolve from git remote automatically
- `jq` is required for parsing milestone list - include fallback if jq unavailable
- VERSION variable should be available from Phase 3 (Determine Milestone Version)
- MILESTONE_GOALS should be extracted from PROJECT.md "Current Milestone" section
  </action>
  <verify>
Run: `grep -n "GITHUB_ENABLED" skills/kata-starting-milestones/SKILL.md`
Expect: Multiple matches showing config reading and conditional logic

Run: `grep -n "gh api.*milestones" skills/kata-starting-milestones/SKILL.md`
Expect: At least 2 matches (existence check and create)

Run: `grep -n "non-blocking\|continue\|warning" skills/kata-starting-milestones/SKILL.md | head -5`
Expect: References to non-blocking error handling pattern
  </verify>
  <done>
- Phase 5.5 added for GitHub Milestone creation
- Config reading uses established grep pattern
- Authentication check is non-blocking
- Idempotency check before creation
- Milestone title uses v${VERSION} format
- Milestone description from goals (truncated)
- Error handling warns but continues
- Completion display updated for GitHub status
  </done>
</task>

</tasks>

<verification>
After completing the task:

1. Verify config reading pattern:
```bash
grep 'GITHUB_ENABLED.*grep' skills/kata-starting-milestones/SKILL.md
```

2. Verify gh api milestone creation:
```bash
grep -A2 'gh api.*POST' skills/kata-starting-milestones/SKILL.md
```

3. Verify non-blocking error handling:
```bash
grep -c 'continue\|⚠' skills/kata-starting-milestones/SKILL.md
```
Expected: >= 2 (auth warning and API failure warning)

4. Verify idempotency check:
```bash
grep 'MILESTONE_EXISTS' skills/kata-starting-milestones/SKILL.md
```
</verification>

<success_criteria>
- [ ] GitHub Milestone creation step exists in skill
- [ ] Config read uses correct grep pattern for github.enabled
- [ ] gh auth status check is non-blocking
- [ ] Milestone existence checked before creation (idempotent)
- [ ] gh api POST includes title, state, description
- [ ] Description truncated to 500 chars
- [ ] All errors warn but don't block workflow
- [ ] Changes committed with appropriate message
</success_criteria>

<output>
After completion, create `.planning/phases/02-onboarding-and-milestones/02-02-SUMMARY.md`
</output>
